window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},window.Microsoft.Maps.initVenueMapsCode=function(){var e=Microsoft.Maps.Resources,i=window.Microsoft.Maps,c=i.Gimme,tt=i.Globals,k=i.Point,et=i.PixelReference,t=i.Events,b=i.LocationRect,o=i.Location,u=i.MapTypeId,h=i.LabelOverlay,s=i.Color,it=i.Polygon,ot=i.Infobox,ut=i.TileSource,nt=i.TileLayer,d=i.QuadKey,l=i.InternalNamespaceForDelay,v=l.Network,p=l.Quirks,rt=l.PRF,ft=Microsoft.Maps.InternalNamespaceForDelay.Debug,n={},r,y,a,f,w;n.VenueMapConstants={_strokeWeightNormal:"2",_strokeWeightHighlighted:"2",_log_FeatureName:"VenueMaps",_log_Action_LaunchVenueMap:"LaunchVenueMap",_log_Action_CloseVenueMap:"CloseVenueMap",_log_Action_SetFloor:"SetFloor",_log_Action_StoreClick:"StoreClick",_log_Action_FootprintClick:"FootprintClick",_log_Info_NullOrEmptyMetadata:"NullOrEmptyMetadata",_log_Info_InvalidMetadata:"InvalidMetadata",_log_Key_MapId:"mapId",_log_Key_MapType:"mapType",_log_Key_MapView:"mapView",_log_Key_Floor:"floor",_log_Key_YpId:"ypId",_log_Key_BusinessName:"businessName",_log_Key_TargetLod:"targetLod",viewHidden:"hidden",viewHalfImmersed:"halfImmersed",viewFullyImmersed:"fullyImmersed"},n.bind=function(n,t){return function(){return t.apply(n,arguments)}},n._callAsync=function(){var r=arguments[0],t,n,i;if(r){for(t=[],n=1,i=arguments.length;n<i;n++)t[n-1]=arguments[n];window.setTimeout(function(){r.apply(window,t)},1)}},n.addDOMElement=function(n,t,i,r,u){var f=document.createElement(n);return t&&(f.id=t),u&&f.appendChild(document.createTextNode(u)),i&&(f.className=i),r&&r.appendChild(f),f},n.measure=function(n){var t,i;if(!n)return{width:0,height:0};t={width:n.offsetWidth,height:n.offsetHeight};if(!t.width&&!t.height){var f=n.style.visibility,u=n.style.position,e=n.style.top,r=n.style.left;c(n).set_style("visibility","hidden").set_style("position","absolute").set_style("top","-1000px").set_style("left","-1000px"),i=!1,n.offsetParent||(document.body.appendChild(n),i=!0),t={width:n.offsetWidth,height:n.offsetHeight},i&&document.body.removeChild(n),c(n).set_style("visibility",f).set_style("position",u).set_style("top",e).set_style("left",r)}return t},n.is_in_DOM=function(n){var t=n;while(t!==null&&t!==document.body)t=t.parentNode;return t===document.body},n.guid=function(){function n(){return((1+Math.random())*65536|0).toString(16).substr(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},n.generateLinkToLSVPage=function(n,t){return tt.localDetailsUrl.replace("{0}",n).replace("{1}",t).replace("{2}","VENUEM")},n.validateMetadata=function(n){var u,f,e,i,r,t;if(n&&n.Floors&&n.DefaultFloor&&n.Footprint&&n.MapId&&n.Floors[n.DefaultFloor]){u=n.Floors;for(f in u){e={key:f,value:u[f]},i=e.value;if(i&&i.Name&&i.Transform&&i.LodRange&&n.Floors[i.Name]){if(i.Primitives)for(t=0;t<i.Primitives.length;t++){r=i.Primitives[t];if(!i.Primitives[t].X||!i.Primitives[t].Y||i.Primitives[t].X.length<3||i.Primitives[t].Y.length<3||i.Primitives[t].X.length!==i.Primitives[t].Y.length)return!1;if(i.Primitives[t].YpId&&!i.Primitives[t].Name)return!1;if(r.Id&&r.Id>99999)return!1}}else return!1}if(n.Footprint.Polygons&&n.Footprint.Polygons.length){for(t=0;t<n.Footprint.Polygons.length;t++)if(!n.Footprint.Polygons[t].X||!n.Footprint.Polygons[t].Y||n.Footprint.Polygons[t].X.length<3||n.Footprint.Polygons[t].Y.length<3||n.Footprint.Polygons[t].X.length!==n.Footprint.Polygons[t].Y.length)return!1}else return!1;return!0}return!1},n.convertMetadataV2ToV1=function(n){function ft(n){var i,r,u,t;if(arguments.length<2||typeof n!="string")return null;for(i=null,r=1,u=arguments.length;r<u;r++)t=arguments[r],typeof t=="string"&&t.replace(/\s/g,"").length>0&&(i=i?i+n+t:t);return i}function s(n){for(var t in n)if(n.hasOwnProperty(t))return n[t];return null}function nt(n){var t=n.longitudes,u=n.latitudes,f=t.length,i,r;n.closed&&f>1&&(i=t[0],r=u[0],(i!==t[f-1]||r!==u[f-1])&&(t.push(i),u.push(r)))}var t,f,b,h,g,p,it,w,e,tt,u,y,o,k,i,r;if(!n)return null;for(t={},f=n.address,f?(b=f.formattedAddress,t.Address=typeof b=="string"?b:ft(", ",f.addressLine,f.locality,f.adminDistrict,f.countryRegionCode)):t.Address=null,h=n.bbox,t.MinLongitude=h[1],t.MinLatitude=h[0],t.MaxLongitude=h[3],t.MaxLatitude=h[2],g=n.defaultFloor,v2DefaultFloorObject=n.floors[g||1],p=v2DefaultFloorObject.type,t.DefaultFloor=typeof p!="undefined"?p:s(v2DefaultFloorObject.name),it=t.Floors={},w=n.floors,e=1,tt=w.length;e<tt;e++){var c=w[e],rt=c.type,a=s(c.name);u=typeof rt!="undefined"?{Name:rt,DisplayName:a}:{Name:a,DisplayName:a},y=c.altTypes,typeof y!="undefined"&&(u.AltNames=y),u.Transform=[1,0,0,0,1,0,0,0,1],u.LodRange=[13,20],it[u.Name]=u;var et=u.Primitives=[],l=c.entities,d=l.length;while(d--)i=l[d],typeof i.name!="undefined"&&(r=i.geometry[0],o=typeof i.categoryOverride!="undefined"?i.categoryOverride:i.categoryName,typeof o=="object"&&(o=s(o)),nt(r),et.push({X:r.longitudes,Y:r.latitudes,YpId:i.ypid,Name:s(i.name),CatId:i.categoryId,CatName:o,Id:i.id}))}t.MapId=n.id,k=n.location,t.CenterLatitude=k[0],t.CenterLongitude=k[1],t.Name=s(n.name),t.PhoneNumber=n.phoneNumber,t.MapType=n.type,t.YpId=n.ypid,t.FloorHeader="Level";var v=t.Footprint={},ut=v.Polygons=[],l=n.floors[0].entities,e=l.length;while(e--)i=l[e],i.type==="Footprint"&&(r=i.geometry[0],nt(r),ut.push({X:r.longitudes,Y:r.latitudes}));return v.Transform=[1,0,0,0,1,0,0,0,1],v.LodRange=[13,20],t},n.populateViewForStyle=function(t,i){switch(i){case n.VEMapStyle.road:default:t.mapTypeId=u.road;break;case n.VEMapStyle.auto:t.mapTypeId=u.auto;break;case n.VEMapStyle.aerial:t.mapTypeId=u.aerial,t.labelOverlay=h.hidden;break;case n.VEMapStyle.hybrid:t.mapTypeId=u.aerial,t.labelOverlay=h.visible;break;case n.VEMapStyle.birdsEye:t.mapTypeId=u.birdseye,t.labelOverlay=h.hidden;break;case n.VEMapStyle.birdsEyeHybrid:t.mapTypeId=u.birdseye,t.labelOverlay=h.visible;break;case n.VEMapStyle.collinsBart:t.mapTypeId=u.collinsBart;break;case n.VEMapStyle.ordnanceSurvey:t.mapTypeId=u.ordnanceSurvey}},n.getMapStyle=function(t,i){var r="\x00";switch(t){case u.road:default:r=n.VEMapStyle.road;break;case u.auto:r=n.VEMapStyle.auto;break;case u.aerial:r=i===h.visible?n.VEMapStyle.hybrid:n.VEMapStyle.aerial;break;case u.birdseye:r=i===h.visible?n.VEMapStyle.birdsEyeHybrid:n.VEMapStyle.birdsEye;break;case u.collinsBart:r=n.VEMapStyle.collinsBart;break;case u.ordnanceSurvey:r=n.VEMapStyle.ordnanceSurvey}return r},n.optimalZoom=function(n,t,i){var p=t.getNorth(),w=t.getSouth(),v=t.getEast(),y=t.getWest(),s=n.getRootElement().clientWidth,e=n.getRootElement().clientHeight,r=n.getTargetZoom(),u=n.tryLocationToPixel(new o(p,y)),f=n.tryLocationToPixel(new o(w,v));if(u&&f&&s&&e&&r){var c=Math.abs(u.y-f.y),h=Math.abs(f.x-u.x),a=r+Math.log(i*e/c)*Math.LOG2E,l=r+Math.log(i*s/h)*Math.LOG2E;return Math.round(Math.min(a,l))}return 17},n.Directory={},n.BreadcrumbEventNames={locked:"locked",unlocked:"unlocked",breadcrumbsChanged:"breadcrumbschanged",pathNodeClicked:"pathnodeclicked",closed:"closed",groupSelectedItemChanged:"groupselecteditemchanged"},n.BreadcrumbManager=function(n,t,i,r,u,f,e){this._map=n,this._bounds=f,this._buildingName=t,this._selectedFloor=i[0],this._zoom=u,this._center=r,this._halfImmersedRange=e,this._floors=i,this._isMultiFloor=i.length>1,this._isDisposed=!1,this._added=!1,this._breadcrumb=null,this._mapStyleChangedHandler=null,this._viewChangedHandler=null,this._closeButtonHandler=null,this._selectionChangedHandler=null,this._componentAddedHandler=null,this._nodeChangedHandler=null,this._showWhenLoaded=!1,this._isLocked=!1,this._init()},n.BreadcrumbManager.prototype={show:function(){this._breadcrumb?(this._updateBreadcrumb(),this._captureMapEvents()):this._showWhenLoaded=!0},hide:function(){this._removeVenueFromBreadcrumb(),this._uncaptureMapEvents()},_raiseEvent:function(n,i){t.invoke(this,n,i)},set__floor:function(n){return this._selectedFloor!==n&&(this._selectedFloor=n,this._breadcrumb&&this._added&&this._isMultiFloor&&this._breadcrumb.selectGroupItem("floor",this._selectedFloor)),n},_dispose:function(){this._uncaptureMapEvents(),this._removeVenueFromBreadcrumb();var n=this._componentAddedHandler;n&&(t.removeHandler(n),this._componentAddedHandler=null),this._breadcrumb=null,this._isDisposed=!0},_captureMapEvents:function(){this._viewChangedHandler||(this._viewChangedHandler=t.addHandler(this._map.getMap(),"viewchangeend",n.bind(this,this._onViewChanged))),this._mapStyleChangedHandler||(this._mapStyleChangedHandler=t.addHandler(this._map,"stylechanged",n.bind(this,this._onStyleChanged)))},_uncaptureMapEvents:function(){t.removeHandler(this._viewChangedHandler),t.removeHandler(this._mapStyleChangedHandler),this._viewChangedHandler=null,this._mapStyleChangedHandler=null},_init:function(){var r,i,f,u;if(this._isDisposed)return;r=this._map.get_Breadcrumb(),r?(i=this._componentAddedHandler,i&&(t.removeHandler(i),this._componentAddedHandler=null),this._breadcrumb=r,this._showWhenLoaded&&(this.show(),delete this._showWhenLoaded)):this._componentAddedHandler||(f=n.bind,u=this._map,this._componentAddedHandler=t.addHandler(u.getMap(),"componentadded",f(this,this._init)))},_attachEventHandlers:function(){this._breadcrumb&&(this._closeButtonHandler=t.addHandler(this._breadcrumb,n.BreadcrumbEventNames.closed,n.bind(this,this._onCloseButtonClicked)),this._selectionChangedHandler=t.addHandler(this._breadcrumb,n.BreadcrumbEventNames.groupSelectedItemChanged,n.bind(this,this._onSelectionChanged)),this._nodeChangedHandler=t.addHandler(this._breadcrumb,n.BreadcrumbEventNames.pathNodeClicked,n.bind(this,this._onBreadcrumbNodeChanged)))},_removeEventHandlers:function(){this._breadcrumb&&(t.removeHandler(this._closeButtonHandler),t.removeHandler(this._selectionChangedHandler),t.removeHandler(this._nodeChangedHandler))},_onBreadcrumbNodeChanged:function(n){var t=n;t.pathNodeLevel==="building"?this._map.SetView({center:this._center,zoom:this._zoom},!0):t.pathNodeLevel==="floor"&&(this._breadcrumb.highlightCrumb(null),this._updateHighlight())},_onCloseButtonClicked:function(n){this._breadcrumb&&this._removeVenueFromBreadcrumb(),this._raiseEvent("closed",n)},_onSelectionChanged:function(n){if(this._breadcrumb){this._breadcrumb.highlightCrumb(null),this._updateHighlight();var t=n;t.groupName==="floor"&&t.newItem!==this._selectedFloor&&(this._selectedFloor=t.newItem,this._raiseEvent("floorchanged",t))}},_onViewChanged:function(){this._updateBreadcrumb(),this._updateHighlight()},_onStyleChanged:function(){this._updateBreadcrumb()},_updateHighlight:function(){var n=this._map.GetTargetZoomLevel();n===this._zoom?this._breadcrumb.highlightCrumb("building"):n>this._zoom&&this._breadcrumb.highlightCrumb(null)},_updateBreadcrumb:function(){this._breadcrumb&&(this._map.IsMercator()?this._updateVisibility():this._removeVenueFromBreadcrumb())},_updateVisibility:function(){if(this._breadcrumb){var n=this._map.GetTargetZoomLevel();n<this._halfImmersedRange.get_from()||!this._bounds.intersects(this._map.GetBounds())?this._removeVenueFromBreadcrumb():n>this._halfImmersedRange.get_to()?(this._isLocked||(this._breadcrumb.lockToLocation(this._center),this._isLocked=!0),this._addVenueToBreadcrumb(),this._breadcrumb.setVisibility("building",!0),this._isMultiFloor&&this._breadcrumb.setVisibility("floor",!0),this._breadcrumb.showCloseButton()):(this._isLocked||(this._breadcrumb.lockToLocation(this._center),this._isLocked=!0),this._addVenueToBreadcrumb(),this._breadcrumb.setVisibility("building",!0),this._isMultiFloor&&this._breadcrumb.setVisibility("floor",!1),this._breadcrumb.hideCloseButton())}},_addVenueToBreadcrumb:function(){this._breadcrumb&&!this._added&&(this._breadcrumb.addCrumb("element","building",this._buildingName,null,!0),this._isMultiFloor&&this._breadcrumb.addCrumb("group","floor",this._selectedFloor,this._floors,!0),this._breadcrumb.showCloseButton(),this._attachEventHandlers(),this._added=!0)},_removeVenueFromBreadcrumb:function(){this._breadcrumb&&this._added&&(this._breadcrumb.removeCrumb("building"),this._isMultiFloor&&this._breadcrumb.removeCrumb("floor"),this._breadcrumb.hideCloseButton(),this._breadcrumb.unlockFromLocation(),this._removeEventHandlers(),this._isLocked=!1),this._added=!1}},n.DoubleRange=function(n,t){this._fromValue=n,this._toValue=t},n.DoubleRange.prototype={_fromValue:0,_toValue:0,get_to:function(){return this._toValue},get_from:function(){return this._fromValue},get_range:function(){return this.get_to()-this.get_from()}},n.LocationPolygon=function(n,t,i,r){for(var p=n.length,y=new Array(p),e=i[3]*n[0]+i[4]*t[0]+i[5],l=e,f=i[0]*n[0]+i[1]*t[0]+i[2],c=f,h,s,a,v,u=0;u<p;u++)h=i[0]*n[u]+i[1]*t[u]+i[2],s=i[3]*n[u]+i[4]*t[u]+i[5],y[u]=new o(s,h),e<s&&(e=s),l>s&&(l=s),f>h&&(f=h),c<h&&(c=h);a=new o((e+l)/2,(f+c)/2),v=new b(a,c-f,e-l),this.latLongs=y,this.center=a,this.boundingBox=v,this.optimalZoom=function(n){var s=r.getRootElement().clientWidth,h=r.getRootElement().clientHeight,u=r.getTargetZoom(),t=r.tryLocationToPixel(new o(e,f)),i=r.tryLocationToPixel(new o(l,c));if(t&&i&&s&&h&&u){var y=Math.abs(t.y-i.y),p=Math.abs(i.x-t.x),a=u+Math.log(n*h/y)*Math.LOG2E,v=u+Math.log(n*s/p)*Math.LOG2E;return Math.round(Math.min(a,v))}return 18}},n.MapController=function(n){this._map=n,this._shapes={},this._layers={},this._mapEntities={},this._registerEvents()},n.MapController.prototype={_map:null,_layers:null,_shapes:null,_zoomAwareLines:null,_isDisposed:!1,_offscreenPoint:new k(-1e4,-1e4),getMap:function(){return this._map},IsMercator:function(){return this._map.isMercator()},GetBounds:function(){return this._map.getBounds()},get_Breadcrumb:function(){return this._map.getComponent("breadcrumb")},GetMapStyle:function(){var r=this._map.getMapTypeId(),i=this._map.getOptions(),t=i.labelOverlay;return n.getMapStyle(r,t)},SetMapStyle:function(t){if(t!==this.GetMapStyle()){var i={};n.populateViewForStyle(i,t),this._map.setView(i)}},SetView:function(n){this._map.setView(n)},GetMapWidth:function(){return this._map.getWidth()},GetMapHeight:function(){return this._map.getHeight()},GetTargetZoomLevel:function(){return this._map.getTargetZoom()},AddLayer:function(n,t){this._layers[n]||(t.layerId=n,this._map.entities.push(t),this._layers[n]=t)},RemoveLayer:function(n){this._layers[n]&&(this._map.entities.remove(this._layers[n]),delete this._layers[n])},GetShape:function(n){return this._shapes[n]},AddShapeById:function(n,t){this._addShape(n,t),this._shapes[n]=t},RemoveShapeById:function(n){if(n){var t=this.GetShape(n);t&&t.eroController&&t.eroController.detachFromShape(),this._removeShape(n),delete this._shapes[n]}},_mapEntities:null,_addShape:function(n,t){this._removeShape(n);var i=this._map.entities;i.push(t),this._mapEntities[n]=t},_removeShape:function(n){var i=this._mapEntities[n],t;i&&(t=i.parentCollection,t||(t=this._map.entities),t.remove(i),delete this._mapEntities[n])},get_MapContainer:function(){return this._map?this._map.getRootElement():null},AddPolygon:function(n,t,i,r,u){var f=this._addPolygon2(n,t,i,r,u);return this._shapes[n]=f,f},_addPolygon2:function(n,t,i,r,u){this._removeShape(n);var f=new it(t,{strokeThickness:i,strokeColor:r,fillColor:u}),e=this._map.entities;return e.push(f),this._mapEntities[n]=f,f},_viewChangeEndHandler:null,_imageryChangedHandler:null,_registerEvents:function(){this._viewChangeEndHandler||(this._viewChangeEndHandler=t.addHandler(this._map,"targetviewchanged",n.bind(this,this._map_ViewChanged))),this._imageryChangedHandler||(this._imageryChangedHandler=t.addHandler(this._map,"imagerychanged",n.bind(this,this._map_ImageryChanged)))},dispose:function(){if(this._isDisposed)return;this._unregisterEvents(),this._isDisposed=!0},_unregisterEvents:function(){this._viewChangeEndHandler&&(t.removeHandler(this._viewChangeEndHandler),this._viewChangeEndHandler=null),this._imageryChangedHandler&&(t.removeHandler(this._imageryChangedHandler),this._imageryChangedHandler=null)},_raiseEvent:function(n,i){t.invoke(this,n,i)},_map_ViewChanged:function(){this._raiseEvent("viewchanged",new n.MapControllerEventArgs)},_map_ImageryChanged:function(){this._raiseEvent("stylechanged",new n.MapControllerEventArgs)}},n.MapControllerEventArgs=function(n){this._keyCode=n},n.MapControllerEventArgs.prototype={_keyCode:0,get_key:function(){return this._keyCode}},n.MultiscaleTileSource=function(n,t){this._tileWidth=n,this._tileHeight=t},n.MultiscaleTileSource.prototype={_tileWidth:0,_tileHeight:0,get__tileWidth:function(){return this._tileWidth},get__tileHeight:function(){return this._tileHeight},isSame:function(n){return this.get__tileWidth()===n.get__tileWidth()&&this.get__tileHeight()===n.get__tileHeight()&&this.get_uriFormat()===n.get_uriFormat()&&this.get_numberOfTileServers()===n.get_numberOfTileServers()},createTileSource:function(){return new ut({width:this.get__tileWidth(),height:this.get__tileHeight(),uriFormat:this.get_uriFormat().replace("{{","{").replace("}}","}"),uriConstructor:n.bind(this,this.getTileUri)})}},n.MercatorModeTileSource=function(t){n.MultiscaleTileSource.apply(this,[n.MercatorModeTileSource._defaultTileSize$1,n.MercatorModeTileSource._defaultTileSize$1]),this._format$1=t,this._numberOfTileServers$1=i.Globals.venueMapsNumberOfMapTileServers||0;var u=i.Globals.venueMapsTileServerSubdomainsX||"",r=i.Globals.venueMapsTileServerSubdomainsY||"";this._subdomains$1=[u.split(","),r.split(",")],n.MercatorModeTileSource._xLength$1=this._subdomains$1.length,n.MercatorModeTileSource._yLength$1=this._subdomains$1[0].length},n.MercatorModeTileSource.prototype=new n.MultiscaleTileSource(0,0),r=n.MercatorModeTileSource.prototype,r._format$1="",r._numberOfTileServers$1=0,r._hasZoomRange$1=!1,r._minZoom$1=0,r._maxZoom$1=0,r.get_tileServerCount=function(){return this._numberOfTileServers$1},r._subdomains$1=null,r.get_hasZoomRange=function(){return this._hasZoomRange$1},r.set_hasZoomRange=function(n){return this._hasZoomRange$1=n,n},r.get_minZoom=function(){return this._minZoom$1},r.set_minZoom=function(n){return this._minZoom$1=n,n},r.get_maxZoom=function(){return this._maxZoom$1},r.set_maxZoom=function(n){return this._maxZoom$1=n,n},r.getTileUri=function(n){return this.get_hasZoomRange()&&(n.levelOfDetail<this.get_minZoom()||n.levelOfDetail>this.get_maxZoom())?null:this.getTileUriFromFormat(n,this.get_uriFormat())},r.getTileUriFromFormat=function(n,t){var u=null,i=d.fromTileId(n),r;return this.get_numberOfTileServers()===4?(r=i.charAt(i.length-1),u=t.replace("{{quadkey}}",i).replace("{{subdomain}}",(r%this.get_tileServerCount()).toString())):(r=this.tileCoordinatesToSubdomainNumber(n.x,n.y),u=t.replace("{{quadkey}}",i).replace("{{subdomain}}",r)),u},r.tileCoordinatesToSubdomainNumber=function(t,i){return this._subdomains$1[t%n.MercatorModeTileSource._xLength$1][i%n.MercatorModeTileSource._yLength$1]},r.get_uriFormat=function(){return this._format$1},r.set_uriFormat=function(n){return this._format$1=n,n},r.get_numberOfTileServers=function(){return this._numberOfTileServers$1},r.set_numberOfTileServers=function(n){return this._numberOfTileServers$1=n,n},y=n.MercatorModeTileSource,y._defaultTileSize$1=256,y._xLength$1=0,y._yLength$1=0,n.MapCruncherTileSource=function(t,i,r){n.MercatorModeTileSource.apply(this,[t]),this._bounds$2=i,this._lodRange$2=r,this.set_hasZoomRange(!1)},n.MapCruncherTileSource.prototype=new n.MercatorModeTileSource(""),a=n.MapCruncherTileSource.prototype,a._bounds$2=null,a._lodRange$2=null,a.getTileUri=function(t){var i="";return this._tileIsInBounds$2(t.x,t.y,t.levelOfDetail)&&(i=n.MercatorModeTileSource.prototype.getTileUri.apply(this,[t])),i},a._tileIsInBounds$2=function(t,i,r){if(!this._bounds$2)return!0;if(this._lodRange$2)if(!(this._lodRange$2.get_from()<=r&&this._lodRange$2.get_to()>=r))return!1;var u=n.TileSystem._tileXYToPixelXY(t,i),f={x:u.x+255,y:u.y+255},s=n.TileSystem.pixelXYToLatLong(u.x,u.y,r),o=n.TileSystem.pixelXYToLatLong(f.x,f.y,r),e=b.fromCorners(s,o);return e.intersects(this._bounds$2)},n.MetadataRequest=function(n){this._options=n},n.MetadataRequest.prototype={options:function(){return this._options},metadata:function(){return this._data},timedOut:function(){return this._timeout},execute:function(){var t=this._options.metadataUriFormat.replace("{0}",this._options.venueMapId);p.useXHR||(t+="&jsonp=microsoftMapsNetworkCallback&jsonso={jsono}"),v.getObjectAsync(t,n.bind(this,this._onWebRequestCompleted),null,this._options.timeout)},_onWebRequestCompleted:function(n,t){this._timeout=!t.success;if(t.success&&n&&typeof n.errorDetails=="undefined")try{this._data=n}catch(i){}else this._data=null;this._options.callback&&this._options.callback(this)}},n.TileSystem=function(){},f=n.TileSystem,f._clip=function(n,t,i){return Math.min(Math.max(n,t),i)},f._mapSize=function(n){return 256<<n},f.pixelXYToLatLong=function(t,i,r){var u=n.TileSystem._mapSize(r),e=n.TileSystem._clip(t,0,u-1)/u-.5,f=.5-n.TileSystem._clip(i,0,u-1)/u;return new o(90-360*Math.atan(Math.exp(-f*2*Math.PI))/Math.PI,360*e)},f._tileXYToPixelXY=function(n,t){return{x:n*256,y:t*256}},f._earthRadius=6378137,f._minLatitude=-85.05112878,f._maxLatitude=85.05112878,f._minLongitude=-180,f._maxLongitude=180,n.ToolTipHelper=function(t){var r=t,u=0,i=document.createElement("div");i.style.cssText="position:absolute;display:block;visibility:hidden;border:solid 1px black;padding:4px;background-color:#FFFFE0;z-index:20;white-space:nowrap;font-family:sans-serif",r.get_MapContainer().appendChild(i);var f=20,o=function(n){var i=r.GetMapWidth(),t=n+f;return t<0&&(t=0),t+u>i&&(t-=t+u-i),t},e=function(n){var i=r.GetMapHeight(),t=n+f;return t<0?t=0:t+40>i&&(t-=t+40-i),t};this.turnOff=function(){i.style.visibility="hidden"},this.turnOn=function(){i.innerHTML&&(i.style.visibility="visible")},this.setPosition=function(n,t){i.style.top=e(n)+"px",i.style.left=o(t)+"px"},this.updateContent=function(t){t?(i.style.zIndex=1e4,i.innerHTML=t,u=n.measure(i).width+10):i.innerHTML=""}},n.VEMapStyle={auto:"u",road:"r",aerial:"a",hybrid:"h",birdsEye:"o",birdsEyeHybrid:"b",collinsBart:"c",ordnanceSurvey:"s"},n.VenueMap=function(r){function nr(){ct||(ct=t.addHandler(h,"viewchanged",pr)),lt||(lt=t.addHandler(h,"stylechanged",cr))}function rr(){t.removeHandler(ct),t.removeHandler(lt),ct=null,lt=null}function ir(){l&&(l.hide(),t.removeHandler(ri),t.removeHandler(fi),l._dispose(),l=null)}function yi(){var r,i,f;if(!l){for(r=[],i=0;i<rt.length;i++)f=rt[i],r.push(f.displayName);l=new n.BreadcrumbManager(h,u.name,r,y.center,y.zoom,st,new n.DoubleRange(ni.zoom,y.zoom-1)),s&&l.set__floor(s.displayName),ri=t.addHandler(l,"floorchanged",gi),fi=t.addHandler(l,"closed",wi),l.show()}}function ar(){if(ii)return;u.popupHelper.dispose(),u.minipopupHelper.hide();var n=u.id;a=null,s=null,dt(),v&&(v.dispose(),v=null),w&&(t.removeHandler(or),w.dispose(),w=null),h&&(h.dispose(),h=null),u.directory&&(u.directory.removeFromDOM(),u.directory=null),tt&&vt(null),ii=!0}function vt(n){var i=nt.activeVenueMap;i!==n&&(nt.activeVenueMap=n,i&&i.detachFromBreadcrumb(),n&&n.attachToBreadcrumb(),t.invoke(b,"activevenuemapchanged",{oldVenueMap:i,newVenueMap:n}))}function pr(){d()}function hr(n){if(a&&a[n]){var t=a[n];return t.getEntity()}return null}function sr(n){if(a&&a[n]){var t=a[n];t.highlight()}}function lr(n){if(a&&a[n]){var t=a[n];t.unhighlight()}}function cr(){d()}function gi(n){var i=n,t=i.newItem;t!==s.displayName&&(wt(ci(t).name),d()),u.unselect()}function li(){var n=h.GetMapStyle(),t;n!=="r"&&n!=="a"&&n!=="h"&&(t="r",n==="o"?t="a":n==="b"&&(t="h"),h.SetMapStyle(t))}function gt(n){wt(n),d(),s&&l&&l.set__floor(s.displayName)}function si(){var n=null;return s&&(n=s.name),n}function ci(n){for(var r=n.toLowerCase(),i,t=0;t<u.floors.length;t++){i=u.floors[t];if(i.displayName.toLowerCase()===r)return i}throw Error.argument("floor","the given floor "+et+" does not exist");}function ei(n){for(var r=n.toLowerCase(),i,t=0;t<u.floors.length;t++){i=u.floors[t];if(ti(i,r))return i}throw Error.argument("floor","the given floor "+n+" does not exist");}function ti(n,t){var i,r;t=t.toLowerCase();if(n.name.toLowerCase()===t)return!0;i=n.altNames;if(typeof i!="undefined"){r=i.length;while(r--)if(i[r].toLowerCase()===t)return!0}return!1}function wt(r){var d,b,w,y,o,l,e;if(!r)throw Error.argumentNull("floor");if(s&&ti(s,r))return;d=s&&s.name,s=ei(r),u.popupHelper.hidePopup(),dt(),v&&v.dispose(),b=ut.replace("{0}",u.id).replace("{1}",s.name);if(f.MaxLatitude){var nt=f.MaxLatitude,g=f.MinLatitude,tt=f.MinLongitude,it=f.MaxLongitude;w=i.LocationRect.fromEdges(nt,tt,g,it)}else w=st;v=new n.VenueMapTileLayer("VenueMapTileLayer",h,b,w,new n.DoubleRange(s.zoomRange[0],s.zoomRange[1])),y=[];if(p.isShapeEventsSupported())for(o=0;o<s.primitives.length;o++)l=s.primitives[o],l.name&&(e=a[l.id],k.push(t.addHandler(e,"click",ki)),k.push(t.addHandler(e,"mouseover",vi)),k.push(t.addHandler(e,"mouseout",ai)),y.push(e));c=y,t.invoke(u,"floorchanged",{oldFloor:d,newFloor:r})}function oi(){tt||(tt=!0,li(),s||gt(u.defaultFloor),d(),nr()),vt(u)}function bi(){tt&&(tt=!1,u.popupHelper.hidePopup(),d(),rr(),vt(null))}function wi(){t.invoke(u,"close",null),u.dispose()}function di(n){h.SetView(y,!0),t.invoke(u,"footprintclick",n)}function ki(n){t.hasHandler(u,"click")?t.invoke(u,"click",n):u.handleMouseClick(n)}function vi(n){t.hasHandler(u,"mouseover")?t.invoke(u,"mouseover",n):u.handleMouseOver(n)}function ai(n){t.hasHandler(u,"mouseout")?t.invoke(u,"mouseout",n):u.handleMouseOut(n)}function pi(){return ht}function d(){var e=h.GetTargetZoomLevel(),r,i,f;if(e>=ni.zoom&&h.IsMercator()&&tt)if(e<y.zoom){v&&v.hide(),w&&w.show();if(c)for(i=0;i<c.length;i++)c[i].hide();u.popupHelper.hidePopup(),u.minipopupHelper.hide(),r=n.VenueMapConstants.viewHalfImmersed}else{v&&v.show(),w&&w.hide();if(c)for(i=0;i<c.length;i++)c[i].show();r=n.VenueMapConstants.viewFullyImmersed}else{v&&v.hide(),w&&w.hide();if(c)for(i=0;i<c.length;i++)c[i].hide();u.popupHelper.hidePopup(),u.minipopupHelper.hide(),r=n.VenueMapConstants.viewHidden}r!==ht&&(f=ht,ht=r,t.invoke(u,"viewchanged",{newView:r,oldView:f}))}function dt(){for(var n=0;n<k.length;n++)t.removeHandler(k[n]);k=[];if(c)for(n=0;n<c.length;n++)c[n].hide();c=null}var u=this,b=r.map,tt=!1,nt=b.getComponent("venueMaps"),ft,rt,et;nt||(nt={activeVenueMap:null},b.addComponent("venueMaps",nt));var f=r.metadata,pt=0,tr=n.guid(),it=null,h=new n.MapController(b),a={},ht=n.VenueMapConstants.viewHidden,at=0,ut=f.TileUriFormat,bt=function(t,i,r,u){var f=new n.LocationPolygon(t,i,r,b);u.center=f.center,u.bounds=f.boundingBox,u.optimalZoom=f.optimalZoom,u.locations=f.latLongs},fr=function(n,t){var r={},u=n.Polygons,i,t;for(r.polygons=[],i=0;i<u.length;i++)t={},bt(u[i].X,u[i].Y,n.Transform,t),r.polygons[i]=t;return r.zoomRange=n.LodRange,r},ur=function(n,t){var i={};return n.Id&&n.Id>0?i.id=n.Id+at*1e5:(i.id=pt.toString(),pt--),bt(n.X,n.Y,t,i),i.businessId=n.YpId,i.name=n.Name,n.CatId?(i.categoryId=n.CatId,i.categoryName=n.CatName):(i.categoryId=tr,i.categoryName=e.getString("L_VenueMaps_Other_Text")),i.description=n.Description,i},hi=function(t){var u=t,i={},o,s,f,r,e;i.name=u.Name,i.displayName=u.DisplayName,i.altNames=u.AltNames,i.zoomRange=u.LodRange,i.primitives=[];if(u.Primitives)for(o=u.Primitives,s=u.Transform,f=0;f<o.length;f++)r=ur(o[f],s),r.floor=i,e=new n.VenueMapPolygon(r,h),a[r.id]=e,r.highlight=e.highlight,r.unhighlight=e.unhighlight,i.primitives[f]=r;return i};ut||(ut=r.tileUriFormat,ut||(ut="http://embedmap.blob.core.windows.net/{0}/{1}/{{quadkey}}.png"));var ct=null,lt=null,ri=null,fi=null,st=null,v=null,c=null,s=null,l=null,ii=!1,ot=fr(f.Footprint),yr=new n.DoubleRange(13,15),vr=18,er=16,ui=17,wr=.9,k=[],yt=[];for(ft=0;ft<ot.polygons.length;ft++)yt=yt.concat(ot.polygons[ft].locations);var st=i.LocationRect.fromLocations(yt),kt=n.optimalZoom(b,st,.8),w=new n.VenueMapFootprint(h,ot,e.getString("L_VenueMaps_ToolTip_Text").replace("{0}",f.Name)),or=t.addHandler(w,"click",di),y={center:st.center,zoom:Math.max(Math.min(kt,vr),er)},ni={center:y.center,zoom:Math.max(Math.min(kt-1,yr.get_from()),0)};this.baseMap=b,this.supportedProjections=["r","a","h"],this.popupHelper=new n.PopupHelper(this),this.minipopupHelper=new n.MiniPopupHelper(this),this.directory=new n.Directory(this),this.name=f.Name,this.address=f.Address,this.phoneNumber=f.PhoneNumber,this.id=f.MapId,this.defaultFloor=f.DefaultFloor,this.type=f.MapType,this.floorHeader=f.FloorHeader,this.businessId=f.YpId,this.center=new o(f.CenterLatitude,f.CenterLongitude),this.footprint=ot,this.socialIds=f.SocialIds,rt=[];for(et in f.Floors)f.Floors.hasOwnProperty(et)&&(rt[at]=hi(f.Floors[et]),++at);delete at,delete pt,this.floors=rt,this.bestMapView=y.zoom<ui?{center:y.center,zoom:ui}:y,this.minimumZoomForTileLayer=y.zoom,this.setBestMapView=function(n,t,i,r){t||(t=.1);var u=n.optimalZoom(t);i&&(u=Math.max(u,i)),r&&(u=Math.min(u,r)),b.setView({center:n.center,zoom:u,animate:!0})},this.select=function(n){u.unselect(),n&&u.highlight(n.id),it=n},this.unselect=function(){it&&u.unhighlight(it.id),it=null},this.handleMouseOver=function(n){u.popupHelper.fetchPopupData(n),n!==it&&u.minipopupHelper.show(n),u.highlight(n.id);var t=document.getElementById(n.id);t&&g(t).add_class("dtrHighlighted")},this.handleMouseOut=function(n){n!==it&&u.unhighlight(n.id);var t=document.getElementById(n.id);t&&g(t).remove_class("dtrHighlighted"),u.minipopupHelper.hide()},this.handleMouseClick=function(n){u.select(n),u.popupHelper.showPopup(n),u.minipopupHelper.hide(),u.directory.select(n);var t=n.optimalZoom(.1);t>b.getZoom()&&b.setView({center:n.center,zoom:t,animate:!0})},this.detachFromBreadcrumb=ir,this.attachToBreadcrumb=yi,this.dispose=ar,this.getEntity=hr,this.highlight=sr,this.unhighlight=lr,this.setActiveFloor=gt,this.getActiveFloor=si,this.show=oi,this.hide=bi,this.getActiveView=pi},n.VenueMapFootprint=function(i,r,u){function ut(){t.removeHandler(e),e=null,c(i.get_MapContainer()).set_style("cursor",s);for(var r=0;r<f.length;r++)f[r].setOptions({strokeColor:g,strokeWeight:b,fillColor:d});h.turnOff()}function nt(n){var u,r;for(h.turnOn(),e=t.addHandler(i.getMap(),"mousemove",tt),u=n,it(),r=0;r<f.length;r++)f[r].setOptions({strokeWeight:ft,strokeColor:st,fillColor:et})}function it(){var n=c(i.get_MapContainer());s=n.get_style("cursor"),s==="pointer"&&(s="default"),n.set_style("cursor","pointer")}function tt(n){var t=i.getMap(),u=t.getWidth()/2+n.getX(),r=t.getHeight()/2+n.getY();h.setPosition(r,u)}function rt(n){t.invoke(ot,"click",n)}for(var ot=this,b=n.VenueMapConstants._strokeWeightNormal,ft=n.VenueMapConstants._strokeWeightHighlighted,g=n.VenueMapFootprint.footprintStrokeNormal,st=n.VenueMapFootprint.footprintStrokeHighlighted,d=n.VenueMapFootprint.footprintFillNormal,et=n.VenueMapFootprint.footprintFillHighlighted,v=r.polygons,o=v.length,y=new Array(o),s="default",f=new Array(o),l,e,a=0;a<o;a++)y[a]=n.guid();try{s=c(i.get_MapContainer()).get_style("cursor")}catch(ht){s="default"}var w=new Array(o),k=new Array(o),p=new Array(o),h=new n.ToolTipHelper(i);h.updateContent(u),l=!1,e=null,this.dispose=function(){this.hide()},this.show=function(){if(!l){for(var n=0;n<v.length;n++)f[n]=i.AddPolygon(y[n],v[n].locations,b,g,d),w[n]=t.addHandler(f[n],"mouseover",nt),k[n]=t.addHandler(f[n],"mouseout",ut),p[n]=t.addHandler(f[n],"click",rt);l=!0}},this.hide=function(){if(l){for(var n=0;n<v.length;n++)t.removeHandler(k[n]),t.removeHandler(w[n]),t.removeHandler(p[n]),i.RemoveShapeById(y[n]);e&&(t.removeHandler(e),e=null),h.turnOff()}l=!1}},n.VenueMapFootprint.footprintFillNormal=new s(51,0,0,255),n.VenueMapFootprint.footprintFillHighlighted=new s(51,0,0,255),n.VenueMapFootprint.footprintStrokeNormal=new s(154,255,255,255),n.VenueMapFootprint.footprintStrokeHighlighted=new s(255,0,0,0),n.VenueMapFootprint._lineStyle="solid",n.VenueMapFootprint._lineJoinMode="round",w={},i.VenueMaps=w,w.VenueMapFactory=function(t){var r=t.getComponent("venueMaps");r||(r={activeVenueMap:null},t.addComponent("venueMaps",r)),this.getActiveVenueMap=function(){return r.activeVenueMap},this.create=function(r){var e=function(n,t){t&&(t==="prod"||t==="dev"||t==="staging")||(t="default");var r=new RegExp(t+"=([^;]*)"),i=n.match(r);return i&&(i=i[1]),i||(i=n),i},s=function(n){callback=r.success,callback&&callback(n,r)},u=function(n){callback=r.error,callback&&callback(n,r)},f=e(i.Globals.venueMapsMetadataJsonpUrl,r.environment),o=e(i.Globals.venueMapsTileUrl,r.environment);t.getCredentials(function(i){if(i){f=f.replace("{credentials}",i);var e=new n.MetadataRequest({venueMapId:r.venueMapId,metadataUriFormat:f,timeout:3e4,callback:function(i){var c=r.venueMapId,h=i.options().venueMapId,f,e;c===h&&(f=n.convertMetadataV2ToV1(i.metadata()),e=i.timedOut(),e?u(3):f?n.validateMetadata(f)?s(new n.VenueMap({map:t,metadata:f,tileUriFormat:o})):u(2):u(1))}});e.execute()}else u(1)})},this.getNearbyVenues=function(r){var u=r.callback,f=r.location,e=r.radius;u&&(f&&e?t.getCredentials(function(t){if(t){var o=i.Globals.venueMapsNearbyUrl.replace("{location}",f.latitude+","+f.longitude).replace("{radius}",e).replace("{credentials}",t);v.getObjectAsync(o,function(t){n._callAsync(u,t,r)})}else n._callAsync(u,null,r)}):n._callAsync(u,null,r))}},n.VenueMapPolygon=function(i,r){var v=this,p=n.VenueMapConstants._strokeWeightNormal,nt=n.VenueMapConstants._strokeWeightHighlighted,a=n.VenueMapPolygon.polygonStrokeNormal,d=n.VenueMapPolygon.polygonStrokeHighlighted,y=n.VenueMapPolygon.polygonFillNormal,g=n.VenueMapPolygon.polygonFillHighlighted,l=p,e=a,o=y,f=!1,c=i.id,h=r,s=i,rt=i.locations,u=null,b=null,k=null,w=null;h.RemoveShapeById(c);var ut=function(){t.invoke(v,"mouseout",s)},tt=function(){t.invoke(v,"mouseover",s)},it=function(){t.invoke(v,"click",s)};this.getEntity=function(){return u},this.show=function(){f||(u=h.AddPolygon(c,rt,l,e,o),b=t.addHandler(u,"mouseover",tt),k=t.addHandler(u,"mouseout",ut),w=t.addHandler(u,"click",it),f=!0)},this.hide=function(){f&&(h.RemoveShapeById(c),t.removeHandler(b),t.removeHandler(k),t.removeHandler(w),f=!1)},this.highlight=function(){l=nt,e=d,o=g,u&&u.setOptions({strokeWeight:nt,strokeColor:d,fillColor:g})},this.unhighlight=function(){l=p,e=a,o=y,u&&u.setOptions({strokeWeight:p,strokeColor:a,fillColor:y})}},n.VenueMapPolygon.polygonStrokeNormal=new s(0,158,185,184),n.VenueMapPolygon.polygonStrokeHighlighted=new s(255,0,0,0),n.VenueMapPolygon.polygonFillNormal=new s(0,191,215,217),n.VenueMapPolygon.polygonFillHighlighted=new s(0,236,246,247),n.VenueMapPolygon._lineStyle="solid",n.VenueMapPolygon._lineJoinMode="round",n.VenueMapTileLayer=function(t,i,r,u,f){this._map=i,this._layerId=t,this._tileSource=new n.MapCruncherTileSource(r,u,f),this._layer=new nt({zIndex:n.VenueMapTileLayer.tileLayerZIndex,mercator:this._tileSource.createTileSource()})},n.VenueMapTileLayer.prototype={show:function(){this._added||(this._map.AddLayer(this._layerId,this._layer),this._added=!0)},hide:function(){this._added&&(this._map.RemoveLayer(this._layerId),this._added=!1)},dispose:function(){this.hide()}},n.VenueMapTileLayer.tileLayerZIndex=2,n.PopupHelper=function(t){function o(){f&&(f=!1,h.entities.remove(e))}function l(n){if(n&&n.SearchResponse&&n.SearchResponse.Query&&n.SearchResponse.Query.SearchTerms)var t=n.SearchResponse.Query.SearchTerms;else return;r[t].json=n,r[t].hasCompleted=!0,s()}function s(){var i;if(u){var c=u,s=r[c].json,o=r[c].primitive,l={id:u,polygon:t.getEntity(o.id),visible:!0,showPointer:!0,zIndex:3,title:o.name,description:o.description?"":"No information available."};o.businessId&&(l.titleClickHandler=function(t){window.open(n.generateLinkToLSVPage(o.businessId,o.name)),t.preventDefault()}),s.SearchResponse&&s.SearchResponse.Phonebook&&s.SearchResponse.Phonebook.Results&&(i=s.SearchResponse.Phonebook.Results[0],i&&(l.description=i.Address+", "+i.City+", "+i.StateOrProvince+" "+i.PostalCode+"<br>"+i.PhoneNumber)),e.setLocation(r[c].primitive.center),e.setOptions(l),f||(f=!0,h.entities.push(e)),u=null}}var h=t.baseMap,r={},e=new Microsoft.Maps.Infobox(new Microsoft.Maps.Location(0,0)),f=!1,u=null,c=function(n){var t=n.businessId,e=n.center.latitude,o=n.center.longitude,f;if(t){if(r[t]&&r[t].hasCompleted)return;var s=i.Globals.venueMapsEroServiceAppId,h=i.Globals.venueMapsEroServiceUrl,u="microsoftMapsVenueMapsPhonebookCallback";window[u]=function(n){l(n)},f=h.replace("{ypid}",t).replace("{query}",t).replace("{appid}",s).replace("{latitude}",e).replace("{longitude}",o).replace("{jsonp}",u).replace("{jsonso}",t),r[t]={},r[t].primitive=n,r[t].hasCompleted=!1,p.useXHR?v.getObjectAsyncCacheFriendly(f,window[u],t):v.getObjectAsyncCacheFriendly(f)}};this.fetchPopupData=c,this.showPopup=function(t){var i=t.businessId;i||(i=n.guid(),r[i]={hasCompleted:!0,primitive:t,json:{searchResponse:null}}),u=i,r[i]?r[i].hasCompleted&&s():c(t)},this.hidePopup=o,this.dispose=function(){o()}},n.MiniPopupHelper=function(n){function e(t){return t.floor.name==n.getActiveFloor()?f(t):!1}function f(n){var c=n.bounds.center.latitude-n.bounds.height/2,h=n.bounds.center.latitude+n.bounds.height/2,y=n.bounds.center.longitude-n.bounds.width/2,v=n.bounds.center.longitude+n.bounds.width/2,a=new Microsoft.Maps.Location(c,y),l=new Microsoft.Maps.Location(h,v),u=t.tryLocationToPixel(a),r=t.tryLocationToPixel(l);if(u&&r){var o=t.getWidth(),f=t.getHeight(),e={x:-o/2+i.left,y:-f/2+i.top},s={x:o/2-i.right,y:f/2-i.bottom};return!(u.x>s.x||u.y>s.y||r.x<e.x||r.y<e.y)}return!1}var t=n.baseMap,u=new Microsoft.Maps.Infobox(new Microsoft.Maps.Location(0,0),{title:""}),r=!1,i={top:10,bottom:10,left:10,right:10};this.show=function(i){if(e(i)){var f={visible:!0,showPointer:!1,showCloseButton:!1,zIndex:2,title:i.name,height:50,width:150,polygon:n.getEntity(i.id)};u.setLocation(i.center),u.setOptions(f),r||(r=!0,t.entities.push(u))}},this.hide=function(){r&&(t.entities.remove(u),r=!1)}},n.Directory=function(i){function oi(){var h,t,v,r;if(!vt){b=n.Directory.PrimitiveHelper.buildArray(i),s=new n.Directory.Renderer(i),u=document.createElement("div"),u.id="venuedirectory",o=n.addDOMElement("div","venuedirectory_div1",null,u,null),i.businessId?(h=n.addDOMElement("div","venuetitle","contactcardtitle",o,null),t=n.addDOMElement("a","venuetitleanchor",null,h,i.name),t.href=n.generateLinkToLSVPage(i.businessId,i.name),t.target="_blank"):n.addDOMElement("div","venuetitle","contactcardtitle",o,i.name),n.addDOMElement("div","address",null,o,i.address),v=n.addDOMElement("div","Phoneandyplinks","Phoneandyplinks",o,null),n.addDOMElement("div","directory","headingtext",o,e.getString("L_VenueMaps_Directory_Text")),ut=n.addDOMElement("div","categoriestogglebutton","categoriesbutton",o,null),g(ut).add_event("click",hi);var a=n.addDOMElement("div",null,"columnheadertable",o,null),c=n.addDOMElement("table",null,null,a,null),y=n.addDOMElement("tbody",null,null,c,""),f=n.addDOMElement("tr",null,null,y,null),l=n.addDOMElement("td",null,"venuecolumn",f,null);st=n.addDOMElement("span","sortalphabutton",null,l,e.getString("L_VenueMaps_SortByAlpha_Text")),r=n.addDOMElement("td",null,"levelcolumn",f,null),ot=n.addDOMElement("span","sortfloorbutton",null,r,e.getString("L_VenueMaps_SortByLevel_Text")),g(st).add_event("click",fi),g(ot).add_event("click",pi),it=n.addDOMElement("div","venuedirectory_div2",null,u,null),d=n.addDOMElement("div",null,null,it,null),vt=!0}}function ri(i,f,o){i&&vt&&!n.is_in_DOM(u)&&(k=i,h=f,l=o,et(nt()),ut.innerHTML=l===w.none?e.getString("L_VenueMaps_ShowCategories_Text"):e.getString("L_VenueMaps_HideCategories_Text"),h==c.alphabetical?(st.className="sortselected",ot.className="sortnormal"):(st.className="sortnormal",ot.className="sortselected"),k.appendChild(u),g(window.self).add_event("resize",ni),kt=t.addHandler(s,"click",si),at=t.addHandler(s,"mouseout",vi),ht=t.addHandler(s,"mouseover",yi),r&&ti(r))}function ai(){u&&u.parentNode&&(u.parentNode.removeChild(u),g(window.self).remove_event("resize",ni),t.removeHandler(kt),t.removeHandler(at),t.removeHandler(ht),kt=null,at=null,ht=null,r=null)}function li(n){if(!n||n<=0)return;n<100?(p=n,rt=null):(rt=n,p=null),dt()}function ti(n){if(n&&n.id)a(),y(n);else throw{name:"InvalidArgumentException",message:""};}function a(){if(r){var n=document.getElementById(r.id);n&&g(n).remove_class("dtrSelected")}r=null}function y(n){var t=document.getElementById(n.id);t&&(ci(t)||t.scrollIntoView(),g(t).add_class("dtrSelected")),r=n}function ci(n){if(k){var i=g(k).get_absolute_pos().y,u=i+k.offsetHeight,o=g(n),t=o.get_absolute_pos().y,r=t+n.offsetHeight,e=t>=i&&t<=u,f=r>=i&&r<=u;return e&&f}return!1}function dt(){var t,r,n;if(!rt&&!p)return;t=p?p*i.baseMap.getHeight():rt,r=o.offsetHeight,n=t-r,n>0&&(it.style.height=n+"px",it.style.overflowY="auto")}function ni(){var t=r;a(),dt(),t&&y(t)}function hi(n){var i=r,t=null;a(),l===w.byCategory?(l=w.none,t=e.getString("L_VenueMaps_ShowCategories_Text")):(l=w.byCategory,t=e.getString("L_VenueMaps_HideCategories_Text")),n.currentTarget.innerHTML=t,et(nt()),v.collapseAll(),ft.collapseAll(),i&&y(i)}function fi(){var n=r;a(),h=c.alphabetical,et(nt()),gt(),n&&y(n)}function pi(){var n=r;a(),h=c.floor,et(nt()),gt(),n&&y(n)}function yi(n){t.hasHandler(f,"mouseover")?t.invoke(f,"mouseover",n):f.handleMouseOver(n)}function vi(n){t.hasHandler(f,"mouseout")?t.invoke(f,"mouseout",n):f.handleMouseOut(n)}function si(n){t.hasHandler(f,"click")?t.invoke(f,"click",n):f.handleMouseClick(n)}function gt(){var t=document.getElementById("sortalphabutton"),n=document.getElementById("sortfloorbutton");h===c.alphabetical?(t.className="sortselected",n.className="sortnormal"):(t.className="sortnormal",n.className="sortselected")}function nt(){return l===w.none?h===c.alphabetical?ei():ui():(ii(),h===c.alphabetical?lt().get_root():ct().get_root())}function ii(){var n=v;h===c.alphabetical?(v=lt(),ft=ct()):(v=ct(),ft=lt()),n!==v&&n&&v.set_expanded_or_collapsed_selections(ft.get_expanded_or_collapsed_selections())}function et(n){if(d!==n){var t=d.parentNode;t.removeChild(d),t.appendChild(n),d=n}}function ei(){return wt||(wt=s.render(tt.sortAlphabetical(b))),wt}function ui(){return bt||(bt=s.render(tt.sortByFloor(b))),bt}function lt(){return pt||(pt=new n.Directory.GroupView(tt.group_Alpha(b),s)),pt}function ct(){return yt||(yt=new n.Directory.GroupView(tt.group_Floor(b),s)),yt}var f=this,u=null,k=null,o=null,it=null,vt=!1,b=null,s=null,h=null,l=null,d=null,wt=null,bt=null,pt=null,yt=null,v=null,ft=null,ut=null,st=null,ot=null,c=Microsoft.Maps.VenueMaps.DirectorySortOrder,w=Microsoft.Maps.VenueMaps.DirectoryGrouping,wi=n.Directory.CategoryViewState,tt=n.Directory.PrimitiveHelper,rt=null,p=null,r=null,kt,at,ht;if(!i)throw{name:"ArgumentNullException",message:"argument cannot be null"};this.handleMouseClick=function(n){var t=n.primitive;f.select(t),i.select(t),i.popupHelper.showPopup(t),i.minipopupHelper.hide()},this.handleMouseOut=function(n){var t=n.primitive;t&&t!==r&&t.unhighlight(),g(n.eventArgs.currentTarget).remove_class("dtrHighlighted"),i.minipopupHelper.hide()},this.handleMouseOver=function(n){var t=n.primitive;t&&(t.highlight(),i.popupHelper.fetchPopupData(t)),g(n.eventArgs.currentTarget).add_class("dtrHighlighted"),i.minipopupHelper.show(t)},this.select=ti,this.unselect=a,this.createUIElements=oi,this.addToDOM=ri,this.removeFromDOM=ai,this.setHeight=li,this.isInDOM=function(){return n.is_in_DOM(u)}},n.Directory.PrimitiveHelper=new function(){function r(t){var r=n(t),i=f(r);return u(i)}function n(n){for(var i=[],t=0;t<n.length;t++)i.push(n[t]);return i}function i(n,t){var r=n,u=t,i=r.name.localeCompare(u.name);return i||(i=r.floor.name.localeCompare(u.floor.name)),i}function t(n,t){var r=n,u=t,i=r.floor.name.localeCompare(u.floor.name);return i||(i=r.name.localeCompare(u.name)),i}function f(n){for(var r={},e,u=0;u<n.length;u++){var f=n[u],i=f.categoryId,o=f.categoryName,t;r[i]?t=r[i].tuples:(t=new Array(0),e={categoryId:i,categoryName:o,tuples:t},r[i]=e),t[t.length]=f}return r}function u(n){var t=new Array(0),u=n,i,r;for(i in u)r={key:i,value:u[i]},t[t.length]=r.value;return t.sort(function(n,t){var r=n,i=t;return r.categoryName.localeCompare(i.categoryName)}),t}this.buildArray=function(n){for(var f=[],u,i,t,r=0;r<n.floors.length;r++)for(u=n.floors[r],i=0;i<u.primitives.length;i++)t=u.primitives[i],t&&t.id&&t.name&&f.push(t);return f},this.buildHashTable=function(n){for(var f={},u,i,t,r=0;r<n.floors.length;r++)for(u=n.floors[r],i=0;i<u.primitives.length;i++)t=u.primitives[i],t&&t.id&&t.name&&(f[t.id]=t);return f},this.sortAlphabetical=function(t){var r=n(t);return r.sort(i),r},this.sortByFloor=function(i){var r=n(i);return r.sort(t),r},this.group_Alpha=function(n){for(var u=r(n),t=0;t<u.length;t++)u[t].tuples.sort(i);return u},this.group_Floor=function(n){for(var u=r(n),i=0;i<u.length;i++)u[i].tuples.sort(t);return u}},n.Directory.CategoryViewState={expanded:0,collapsed:1},Microsoft.Maps.VenueMaps.DirectorySortOrder={alphabetical:0,floor:1},Microsoft.Maps.VenueMaps.DirectoryGrouping={none:0,byCategory:1},n.Directory.GroupView=function(t,i){function v(n){n.preventDefault();var i=n.currentTarget,t=i.id;h(t)}function h(n){var t=r[n],i;i=l[n],t.visible?(i.removeChild(t.root),t.visible=!1):(i.appendChild(t.root),t.visible=!0)}for(var p=this,c=document.createElement("div"),a=c.appendChild(document.createElement("ul")),r={},l={},s,u=0;u<t.length;u++){var e=t[u],o=e.categoryId,y=e.categoryName,f=document.createElement("li");a.appendChild(f),s=n.addDOMElement("div",o,"categorylistitem",f,y),r[o]={root:i.render(e.tuples),visible:!1},l[o]=f,g(s).add_event("click",v)}this.get_root=function(){return c},this.get_expanded_or_collapsed_selections=function(){var t={},n;for(n in r)t[n]=r[n].visible;return t},this.set_expanded_or_collapsed_selections=function(n){var t,i;for(t in n)i=r[t],i.visible!==n[t]&&h(t)},this.collapseAll=function(){var r={},u,n,i;for(u in t)n=t[u],i=n.categoryId,r[i]=!1;p.set_expanded_or_collapsed_selections(r)}},n.Directory.Renderer=function(i){function o(n){t.invoke(r,"mouseover",{eventArgs:n,primitive:u[n.currentTarget.id]})}function e(n){t.invoke(r,"mouseout",{eventArgs:n,primitive:u[n.currentTarget.id]})}function f(n){n.preventDefault();var e=n.currentTarget.parentNode.parentNode.id,f=u[e];i.setActiveFloor(f.floor.name),i.setBestMapView(f,.1,i.minimumZoomForTileLayer),t.invoke(r,"click",{eventArgs:n,primitive:f})}var u=n.Directory.PrimitiveHelper.buildHashTable(i),r=this;this.render=function(t){for(var s=document.createElement("table"),a=n.addDOMElement("tbody",null,null,s,""),i=0;i<t.length;i++){var c=i%2,l=c?"directorytablerow2":"directorytablerow1",r=n.addDOMElement("tr",t[i].id,l,a,null),h=n.addDOMElement("td",null,"venuecolumn",r,null),u=n.addDOMElement("a",null,null,h,t[i].name);u.href="#",n.addDOMElement("td",null,"levelcolumn",r,t[i].floor.displayName),g(r).add_event("mouseenter",o).add_event("mouseleave",e),g(u).add_event("click",f)}return s}},Microsoft.Maps.VenueMaps.VenueMapTask=function(n){function u(){n.show(),n.baseMap.setView(n.bestMapView),n.directory.createUIElements(),n.directory.addToDOM(i,0,0)}function f(){n.dispose()}var r=this,i=document.createElement("div"),e=t.addHandler(r,"remove",f),o=t.addHandler(r,"activate",u);this.getTitle=function(){return n.name},this.getPanel=function(){return i}},delete window.Microsoft.Maps.initVenueMapsCode,l.Dynamic&&l.Dynamic.done("Microsoft.Maps.VenueMaps"),rt.end("Module initialized","Microsoft.Maps.VenueMaps",{module:"VenueMaps"})},Microsoft.Maps.Map&&Microsoft.Maps.initVenueMapsCode&&window.Microsoft.Maps.initVenueMapsCode(),window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},window.Microsoft.Maps.initTraffic=function(){function v(n,t){var e=this,u=n,i=null,f=t||r.trafficUriFormat;this.show=function(){e.getTileLayer(),u.entities.indexOf(i)===-1&&u.entities.push(i)},this.hide=function(){i&&u.entities.indexOf(i)!==-1&&u.entities.remove(i)},this.getTileLayer=function(){if(i===null){var n=new b({uriConstructor:f,width:256,height:256});i=new rt({mercator:n,opacity:.7})}return i}}function p(t,i,u){function l(n){return document.createTextNode(n)}function y(n){while(n&&n.firstChild)n.removeChild(n.firstChild)}var v=f.NavigationCommon,e=v.createElement,p=t,h=e("div",u.getClassName(),i),a,s,c,o;u.getDomElement=function(){return h},u.setMessage=function(n){y(c),c.appendChild(l(n))},v.addIgnoreEvents(h),this.dispose=function(){v.removeIgnoreEvents(h)},a=e("div","tlGroup",h),s=e("div","tlLegend",a),e("span","tlSlow",s).appendChild(l(n("L_TrafficLegendSlow_Text"))),e("span","tlFast",s).appendChild(l(n("L_TrafficLegendFast_Text"))),o=e("img","tlKey"),o.src=r.imagePath+"Traffic/tl_key.png",o.alt="",s.appendChild(o),c=e("div","tlMessage",a)}function e(n){this.setOptions(n)}function y(){l||(h=h||f.Overlays,h&&(h.registerOverlay("[TrafficLegendControl]",p),l=!0))}function w(t){function w(){vi(),hi();if(l||h){var n=f.getZoom();n<lt||(l&&n>=bt&&nr(),h&&cr()),e.show(f,ct),ft(),sr()}else e.show(f,!1),ti()}function ur(){if(h||l){if(s.areEqual(oi,f.getCenter())&&dt==f.getZoom()&&ht==f.getMapTypeId())return;g!=-1&&window.clearInterval(g),g=window.setInterval(ti,er),wi()?(pt={},window.setTimeout(w,200)):ft()}}function ai(){var n=f.getZoom();n<lt||w()}function ti(){g!=-1&&(window.clearInterval(g),g=-1),b!=-1&&(window.clearInterval(b),b=-1)}function sr(){(h||l)&&(b!=-1&&window.clearInterval(b),b=window.setInterval(ai,kt))}function vr(n){wt(k);var i=n.target,r=i.getInfobox(),t=i.incident;yt(t),y.push(r),k=t}function ar(){if(k){var t=k.pushpin;k.infoboxTimeout=window.setTimeout(rt(st,wt,k),500)}}function hr(n){var r=n.target,i=r.getPushpin(),t=i.incident;yt(t)}function lr(n){var r=n.target,i=r.getPushpin(),t=i.incident;wt(t)}function yt(n){n.infoboxTimeout&&(window.clearTimeout(n.infoboxTimeout),n.infoboxTimeout=0)}function wt(n){n&&(yt(n),y.remove(n.infobox))}function cr(){ot=new v(f,ir()),ot.show()}function ri(n){var e,s,h,t,r;si(n);if(f.getZoom()>=bt){e=et[n];if(e){y||(y=new d,f.entities.push(y)),s=e.length,h=f.getTheme();while(s--){t=e[s];if(li(t)){var c={width:22,height:18,icon:t.severity==4?rr:or},o=gi(t.point),i=new it(o,c);y.push(i),r=new tt(o,{title:di(t.type),description:yi(t),actions:ci(o),pushpin:i,showCloseButton:!1,width:350,height:250}),t.pushpin=i,t.infobox=r,i.incident=t,h?y.push(r):t.handlers=[u.addHandler(i,"mouseover",rt(st,vr)),u.addHandler(i,"mouseout",rt(st,ar)),u.addHandler(r,"mouseenter",rt(st,hr)),u.addHandler(r,"mouseleave",rt(st,lr))]}}}}}function rt(n,t){return function(){t&&t.apply(n,arguments)}}function ui(){var c=[],e=f.getBounds(),t=f.getZoom(),n=2,u,i,r,h,o;for(t>=bt&&t<8?n=7:t<8||(t<9?n=6:t<10?n=5:t<11&&(n=3)),u={north:at(e.getNorth(),n)+n,south:at(e.getSouth(),n),east:at(e.getEast(),n)+n,west:at(e.getWest(),n)},i=u.south;i<u.north;i+=n)for(r=u.west;r<u.east;r+=n)h=new s(Math.min(i+n,90),r+n),o=new s(i,r),c.push(new ut.fromLocations(h,o));return c}function ni(n){return[n.getSouth(),n.getWest(),n.getNorth(),n.getEast()].join(",")}function ir(){var n=r.trafficUriFormat,t="tc="+Math.floor(+new Date/(kt*.8));return n+(n.indexOf("?")==-1?"?":"&")+t}function ii(t){return t=t.replace("/Date(","").replace(")/",""),t=new Date(parseInt(t,10)),c.formatDate(t,n("L_TrafficPopupDateFormat_Text"))}function ci(t){return[{id:"trafficZoomIncident",label:n("L_TrafficPopupZoomToIncident_Text"),eventHandler:function(n){n.preventDefault(),f.setView({center:t,zoom:15})}},{id:"trafficCenterMap",label:n("L_TrafficPopupCenterMapHere_Text"),eventHandler:function(n){n.preventDefault(),f.setView({center:t})}}]}function yi(t){var f="trafficheader",u="trafficdata",e="traffictimedata",s="trafficlabel",r=":&nbsp;",i=[];return i.push(p(f,n("L_TrafficPopupSeverity_Text")+r)),i.push(p(u,ki(t.severity))),t.description&&(i.push(p(f,n("L_TrafficPopupDescription_Text")+r)),i.push(p(u,o.encodeHtml(t.description.replace("&amp;","&"))))),t.detour&&(i.push(p(f,n("L_TrafficPopupDetour_Text")+r)),i.push(p(u,o.encodeHtml(t.detour.replace("&amp;","&"))))),t.lane&&(i.push(p(f,n("L_TrafficPopupLane_Text")+r)),i.push(p(u,o.encodeHtml(t.lane.replace("&amp;","&"))))),t.start&&(i.push(p(s,n("L_TrafficPopupStartTime_Text")+r)),i.push(p(e,o.encodeHtml(ii(t.start))))),t.end&&(i.push(p(s,n("L_TrafficPopupEstEndTime_Text")+r)),i.push(p(e,o.encodeHtml(ii(t.end))))),i.join("")}function gi(n){var i=null,t=n.coordinates;return t&&t.length==2&&(i=new s(t[0],t[1])),i}function di(t){var r;switch(t){case i.construction:r="L_TrafficScheduledConstruction_Text";break;case i.other:r="L_TrafficOtherNews_Text";break;case i.congestion:r="L_TrafficCongestion_Text";break;case i.accident:r="L_TrafficAccident_Text";break;case i.disabledVehicle:r="L_TrafficDisabledVehicle_Text";break;case i.hazard:r="L_TrafficRoadHazard_Text";break;case i.alert:r="L_TrafficUnScheduledContruction_Text";break;case i.planned:r="L_TrafficPlannedEvent_Text";break;case i.massTransit:r="L_TrafficMassTransit_Text";break;case i.weather:r="L_TrafficWeather_Text";break;case i.misc:r="L_TrafficMiscellaneous_Text"}return r&&n(r)||""}function nr(){var i=ui(),r=i.length,u=bi(),t,n;while(r--)t=i[r],n=ni(t),fi(n)?function(t){f.getCredentials(function(i){var r=fr.replace("{bounds}",t).replace("{sev}",u).replace("{credentials}",i);nt.getObjectAsync(r,function(n,t){tr(n,t)},n,3e4)})}(n):ri(n)}function at(n,t){return n+=180,Math.floor(n-n%t-180)}function ki(t){var i=["L_TrafficSeverityMinor_Text","L_TrafficSeverityModerate_Text","L_TrafficSeveritySerious_Text"];return t=Math.min(Math.max(t-2,0),2),n(i[t])}function bi(){var n="",t=Math.round(f.getZoom());return t>8?t==9?n="3,4":t==10&&(n="2,3,4"):n="4",n}function p(n,t){return['<div class="',n,'">',t,"</div>"].join("")}function fi(n){var t=pt[n],r=new Date;return!t||r-t>kt}function pi(){var t=!0,n;return f.isMercator()||(n=f.getMode(),t=n&&n.canReprojectTileLayers&&n.canReprojectTileLayers()),t}function wi(){var n=!1,t=f.getZoom(),u=f.getMapTypeId(),r,i;u!=ht&&(u==a.birdseye||ht==a.birdseye)?n=!0:t==dt||t>10||(n=!0);if(!n&&t>lt){r=ui(),i=r.length;while(i--)if(fi(ni(r[i]))){n=!0;break}}return oi=f.getCenter(),ht=u,dt=t,n}function tr(n,t){if(!h&&!l||!n||n.statusCode!=200||!t||!t.success){ft(!0);return}var i=t.userData;vt=pt[i]=new Date,et[i]=n.resourceSets&&n.resourceSets[0].resources||[],ri(i),ft()}function hi(){ot&&ot.hide(),ot=null}function si(n){var r,u,t,i;if(n&&y){r=et[n];if(r){u=r.length;while(u--)t=r[u],i=t.pushpin,i&&(ei(t),y.remove(i),y.remove(i.getInfobox()),t.pushpin=null)}}}function vi(){var i,n,t;if(y){for(i in et){n=et[i],t=n&&n.length||0;while(t--)ei(n[t])}f.entities.remove(y),y=null}}function ei(n){var i=n.handlers,t;if(i){t=i.length;while(t--)u.removeHandler(i[t]);n.handlers=null}}function li(n){var t=!0;switch(n.type){case i.congestion:t=!1;break;case i.massTransit:t=n.severity!=1;break;case i.weather:t=n.severity>2}return t}function ft(t){var u,r,i;if(!ct||!h&&!l)return;u=f.overlays,r=u&&f.overlays.getNamedEntity("overlaysBR").getNamedEntity("trafficlegend");if(!r){window.setTimeout(ft,500);return}pi()?t?i=n("L_TrafficUnavailable_Text"):f.getZoom()<lt?i=n("L_TrafficZoomIn_Text"):vt&&(i=n("L_TrafficUpdated_Text")+" "+c.formatDate(vt,n("L_TrafficUpdatedTimeFormat_Text"))):i=n("L_TrafficNotAvailableInOblique_Text"),r.setMessage(i||"")}var st=this,f=t,ot,h,l,ct=!0,gt=r.imagePath+"/Traffic/",rr=gt+"poi_traffic_red.png",or=gt+"poi_traffic_yellow.png",et={},pt={},y,fr=r.trafficIncidentsJs,lt=r.trafficMinZoom,bt=r.trafficMinIncidentsZoom,er=r.trafficExpiry,kt=r.trafficRefresh,g=-1,b=-1,oi,dt,ht,vt,k;u.addHandler(f,"viewchangeend",ur),this.getIsOn=function(){return h||l},this.show=function(){h&&l||(h=l=!0,w())},this.hide=function(){(h||l)&&(h=l=!1,w())},this.showFlow=function(){h||(h=!0,w())},this.hideFlow=function(){h&&(h=!1,w())},this.showIncidents=function(){l||(l=!0,w())},this.hideIncidents=function(){l&&(l=!1,w())},this.showLegend=function(){ct=!0,w()},this.hideLegend=function(){ct=!1,w()}}var t=window.Microsoft.Maps,g=t.Resources,n=g.getString,r=t.Globals,f=t.InternalNamespaceForDelay,o=f.IOSec,nt=f.Network,h=f.Overlays,k=f.PRF,d=t.EntityCollection,u=t.Events,tt=t.Infobox,s=t.Location,ut=t.LocationRect,a=t.MapTypeId,it=t.Pushpin,rt=t.TileLayer,b=t.TileSource,i,c,l;typeof t.Traffic=="undefined"&&(t.Traffic={}),i={accident:1,congestion:2,disabledVehicle:3,massTransit:4,misc:5,other:6,planned:7,hazard:8,construction:9,alert:10,weather:11},c={formatDate:function(n,t){function r(n){return n<10?"0"+n:n.toString()}function h(n,t){for(var f=0,i=!1,u,r=0,e=n.length;r<e;r++){u=n.charAt(r);switch(u){case"'":i?t.push("'"):f++,i=!1;break;case"\\":i&&t.push("\\"),i=!i;break;default:t.push(u),i=!1}}return f}for(var i=[],o=/dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z/g,f,e=0;;){var c=o.lastIndex,u=o.exec(t),s=t.slice(c,u?u.index:t.length);e+=h(s,i);if(!u)break;if(e%2==1){i.push(u[0]);continue}switch(u[0]){case"dd":i.push(r(n.getDate()));break;case"d":i.push(n.getDate());break;case"MM":i.push(r(n.getMonth()+1));break;case"M":i.push(n.getMonth()+1);break;case"yyyy":i.push(n.getFullYear());break;case"yy":i.push(r(n.getFullYear()%100));break;case"y":i.push(n.getFullYear()%100);break;case"hh":f=n.getHours()%12||12,i.push(r(f));break;case"h":f=n.getHours()%12||12,i.push(f);break;case"HH":i.push(r(n.getHours()));break;case"H":i.push(n.getHours());break;case"mm":i.push(r(n.getMinutes()));break;case"m":i.push(n.getMinutes());break;case"ss":i.push(r(n.getSeconds()));break;case"s":i.push(n.getSeconds());break;case"tt":i.push(n.getHours()<12?"AM":"PM");break;case"t":i.push(n.getHours()<12?"A":"P")}}return i.join("")}},t.Traffic.TrafficLayer=v,e.prototype={_className:"TrafficLegend",getDomElement:function(){return null},getClassName:function(){return this._className},setOptions:function(n){if(n){var t=!1;typeof n.className=="string"&&(this._className=n.className,t=!0),t&&u.invoke(this,"entitychanged",{entity:this})}},toString:function(){return"[TrafficLegendControl]"}},e.show=function(n,t){var f,i,r;y(),f=n.overlays,f?(i=f.getNamedEntity("overlaysBR"),r="trafficlegend",t?i.getNamedEntity(r)||i.addNamedEntity(r,new e):i.removeNamedEntity(r)):u.addHandler(n,"overlayscreationstart",function(){e.show(n,t)})},l=!1,y(),t.Traffic.TrafficManager=w,delete window.Microsoft.Maps.initTraffic,f.Dynamic&&f.Dynamic.done("Microsoft.Maps.Traffic"),k.end("Module initialized","Microsoft.Maps.Traffic",{module:"Traffic"})},Microsoft.Maps.Map&&Microsoft.Maps.initTraffic&&window.Microsoft.Maps.initTraffic(),window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},window.Microsoft.Maps.initBingTheme=function(){var n=window.Microsoft.Maps,h=n.Globals,i=n.Events,r=n.Gimme,y=n.Map,o=n.Pushpin,u=n.Point,e=n.Polygon,a=n.Color,l=n.Location,s=n.Infobox,v=n.InfoboxType,p=r.Helper.contains,f=n.InternalNamespaceForDelay,t=n.EntityState,c=f&&f.PRF;(function(){n.Themes=n.Themes||{},n.Themes.BingTheme=function(){function lt(){f instanceof o?nt():f instanceof e&&ht(),f=null}function bi(n,t){it[n]=t}function wi(n,t,i,r){return n?n[i+tt(r)]||n[i]||n.defaultIcon:(at=h.bingThemeIconUrlFormat,at.replace("{iconStyle}",t).replace("{imageryStyle}",i).replace("{state}",tt(r)))}function tt(n){return n&t.selected?"_s":n&t.highlighted?"_h":""}function nt(){var r,i,n;f&&(r=f.trueEntity,i=f,f=null,r.setOptions({state:t.none}),i._shrink&&i._shrink.reverse(),i._shrink=null,y(i),n=r.getInfobox(),r.temporary&&(c.entities.remove(r),n&&c.entities.remove(n)),n&&y(n))}function vt(n){var o,u;if(f==n)return;lt(),f=n,o=n.trueEntity,o.setOptions({state:o.getState()|t.selected});var s=n.getWidth(),e=n.getHeight(),i=.5;n.iconData&&n.iconData.animatePins!==!1&&(n._shrink=r.Effects.Storyboard.create([n],{x:0,y:0,width:s,height:e,p:0},{x:(1-i)*s/2,y:(1-i)*e/2,width:i*s,height:i*e,p:1},function(t,i){n.overrideOptions=i,y(n)},300,null,null,ft),n._shrink.begin()),u=n.trueEntity.getInfobox(),u&&y(u)}function hi(n){var t=n.target;t.trueEntity.getInfobox()&&vt(t)}function si(n){et(n.target,!0)}function ci(n){et(n.target,!1)}function et(n,i){var r=n.trueEntity,u;i?r.setOptions({state:r.getState()|t.highlighted}):r.setOptions({state:r.getState()&~t.highlighted}),u=r.getInfobox(),u&&y(u),y(n)}function ai(n,i,r){var e=r.iconData,c=null;if(e){var l=st(),s=i.overrideOptions||{},a=s.p>.5,h=n.getZIndex()+e.zIndex,o=n.getState();o&t.selected&&i!=f?vt(i):o&t.selected||i!=f||nt(),o&t.selected&&a?h+=yi:o&t.highlighted&&(h+=vi),c={icon:wi(e.icons,e.iconStyle,l,o),typeName:"pushpin pin"+e.iconStyle+" "+l+" "+tt(o),anchor:new u(e.anchor.x-(s.x||0),e.anchor.y-(s.y||0)),width:s.width||e.width,height:s.height||e.height,textOffset:e.textOffset,text:a?"":n.getText()||"",id:n.getId(),draggable:n.getDraggable(),visible:n.getVisible(),useTransform3d:n.getUseTransform3d(),zIndex:h,state:n.getState(),location:n.getLocation()}}else c=ii(n);d(i,c)}function li(n,t){var s=n.getIcon(),e=(n.getTypeName()||"").split(" "),i,c=e.length,r,u,f;while(c--){u=e[c];if(it[u]){i=u;break}}return i||s&&s!=h.pushpinImageUrl||(i="bluepin"),f=it[i],r=new o(n.getLocation()),r.iconData=t.iconData=f,r}function ht(){var i,n;f&&(i=f.trueEntity,i.setOptions({state:t.none}),y(f),n=f.trueEntity.getInfobox(),n&&y(n)),f=null}function rr(n){var r,i;if(f==n)return;lt(),f=n,r=n.trueEntity,r.setOptions({state:r.getState()|t.selected}),i=n.trueEntity.getInfobox(),i&&y(i)}function fr(n){var t=n.target;t.trueEntity.getInfobox()&&rr(t)}function or(n){ut(n.target,!0)}function er(n){ut(n.target,!1)}function ut(n,i){var r=n.trueEntity,u;i?r.setOptions({state:r.getState()|t.highlighted}):r.setOptions({state:r.getState()&~t.highlighted}),u=n.trueEntity.getInfobox(),u&&y(u),n&&y(n)}function gi(n,t,i){return t?ki:i.getStrokeColor()}function di(n,t){var r=st();d(t,{strokeColor:gi(r,n.getState(),n),visible:n.getVisible(),strokeThickness:n.getStrokeThickness(),strokeDashArray:n.getStrokeDashArray(),fillColor:n.getFillColor(),locations:n.getLocations()})}function nr(n){var i=new e(n.getLocations());return i.pointerEvents=n.pointerEvents,i}function wt(n){rt.push(n)}function yt(n){var i=n.measure(),u,t;n.overrideOptions={width:oi,height:null,typeName:"Infobox2 hiddenInfobox"},y(n),u=n.measure(),n.overrideOptions&&n.overrideOptions.width&&(n.overrideOptions.width=Math.max(kt,Math.min(u.width,bt))),y(n),t=n.measure(),r.Effects.Storyboard.create([n],{width:i.width,height:i.height-18,p:0},{width:t.width,height:t.height,p:1},function(t,i){n.overrideOptions=i,y(n)},300,null,null,ft).begin()}function gt(n,i){var tt=n.getPushpin(),it=n.getPolygon(),e=i.overrideOptions||{},s=e.p>.5,o=e.p>.95,b=!1,w=36,k=-25,l=!1,g=null,nt=!1,c,y,h,a,p;o?(k=0,w=-2):!s&&e.height&&(w=54),c=tt||it,y=new u(k,w),c?(h=c.getState(),l=h!=t.none&&n.getVisible(),h&t.selected&&!i.overrideOptions?(i.overrideOptions={},window.setTimeout(function(){yt(i)},100)):h&t.selected||!i.overrideOptions||(i.overrideOptions=null)):(s=n.typeName&&n.typeName===v.mini?!1:!0,o=n.getShowPointer(),l=n.getVisible(),b=n.getShowCloseButton(),y=n.getOffset(),g=n.getWidth()),a={typeName:e.typeName||(s?"Infobox2":"MiniInfobox2"),title:n.getTitle(),width:e.width||g,height:!o&&e.height||null,description:n.getDescription(),titleAction:n.getTitleAction(),titleClickHandler:s?n.getTitleClickHandler():null,offset:y,zIndex:e?ir:tr,actions:n.getActions(),showPointer:o,showCloseButton:b,visible:l,htmlContent:n.getHtmlContent(),location:n.getLocation(),clip:nt},p=rt.length;while(p--)rt[p](n,i,a);d(i,a)}function ui(n){var u=(n.getTypeName()||"").split(" "),f=!0,i=u.length,r;while(i--)if(u[i]=="notheme"){f=!1;break}return f&&(r=new s(n.getLocation())),r}function fi(n,t){c=n,ct=t,t.showDualMapTypeSelector!==!1&&(t.showDualMapTypeSelector=!0),t.showBreadcrumb!==!1&&(t.showBreadcrumb=!0),r(c.getRootElement()).add_class("BingTheme"),ot(),i.addHandler(c,"click",ri),r(window).add_event("resize",w),i.addHandler(c,"resize",w),w(),i.addHandler(c,"imagerychanged",ei)}function ei(){y(c.entities)}function ri(n){n.mouseMoved||n.targetType!="map"||(nt(),ht())}function st(){switch(c.getImageryId()){case"Aerial":case"EnhancedBirdseye":case"NativeBirdseye":return"dark";default:return"light"}}function w(n){n=typeof n=="number"?n:0;var t=c.getComponent("breadcrumb");if(t!=null){if(n>50)return;b&&(i.removeHandler(b),b=null),setTimeout(function(){var u=r(c.getRootElement()).select(".pathContainer").get_relative_pos().x,i=r(c.getRootElement()).select(".NavBar_zoomControlContainer").get_relative_pos().x,f=i-u-30;u>0&&i>0?t.setWidth(f):w(n+1)},100)}else b||(b=i.addHandler(c,"componentadded",w))}function ot(){if(c.overlays){c.overlays.setOptions({className:c.overlays.getClassName()+" stylev2"});if(ct.showMapTypeSelector===!1){var n=c.overlays.get(0);n&&n.setOptions({className:n.getClassName()+" hidden"})}g&&i.removeHandler(g)}else g=i.addHandler(c,"overlayscreationstart",ot)}function ft(n){return r.Effects.Easing.Exponential.ease_in_out(n,4)}function y(n){i.invoke(n,"entitychanged",{entity:n})}function k(n){var i=n.entity,t;if(i.changing)return;t=i.trueEntity,t&&y(t)}function ii(n){var r={},t,i;for(t in n)i=n[t],typeof i=="function"&&t.indexOf("get")==0&&(t=t.charAt(3).toLowerCase()+t.substr(4),r[t]=i.call(n));return r}function d(n,t){var f=!1,a=t.location&&n.getLocation&&!l.areEqual(n.getLocation(),t.location),r=t.locations&&n.getLocations,o,c,e,i;if(r){o=n.getLocations(),c=t.locations,r=o.length!==c.length,e=o.length;while(!r&&e--)r=!l.areEqual(o[e],c[e])}for(i in t){var v="get"+i.substring(0,1).toUpperCase()+i.substring(1),s=typeof n[v]=="function"?n[v]():null,h=t[i];i=="anchor"||i=="textOffset"||i=="offset"?f=!u.areEqual(s,h):i=="strokeColor"?f=s.toHex()!=h.toHex():i!="location"&&(f=s!=h);if(f)break}if(f||a||r){n.changing=!0,f&&n.setOptions(t),a&&n.setLocation(t.location),r&&n.setLocations(t.locations),n.changing=!1;return}}function ti(n,t){var r,u,c=t.eventHandlers,h,f;n instanceof o?(r=li(n,t),u=pi):n instanceof e?(r=nr(n,t),u=ur):n instanceof s&&(r=ui(n,t),u=dt);if(r){r.trueEntity=n,r.pointerEvents=n.pointerEvents,r.themeReference=t;if(u)for(h in u)c.push(i.addHandler(r,h,u[h]));n.getState&&n.getInfobox&&(f=n.getState(),c.push(i.addHandler(n,"entitychanged",function(){var t=n.getState(),i=t!=f;f=t,i&&y(n.getInfobox())})))}return r}function ni(n,t,i){var u=t.appliedTheme,f=!1,r;return u!=p&&(u&&u._unhookFromEntity(n,t),t.appliedTheme=p,t.eventHandlers=[],t.proxyEntity=ti(n,t),f=!0),r=t.proxyEntity,r&&(i.updateEntity||f)&&(n instanceof e?di(n,r,t,i):n instanceof o?ai(n,r,t,i):n instanceof s&&gt(n,r,t,i)),r||n}function pt(n,t){var u=t.eventHandlers,r;if(u){r=u.length;while(r--)i.removeHandler(u[r])}}var p=this,b,sr=r("body"),g,c,ct,f=null,yi=2e3,vi=1e3,at=null,it={micro:{width:16,height:16,anchor:new u(8,8),iconStyle:0,zIndex:0},bluepin:{width:28,height:28,anchor:new u(14,14),textOffset:new n.Point(0,0),iconStyle:55,zIndex:1},locationpin:{width:29,height:29,anchor:new u(14,14),textOffset:new n.Point(0,0),iconStyle:"location",zIndex:2},userpin:{width:28,height:28,anchor:new u(14,14),textOffset:new n.Point(0,0),iconStyle:"user",zIndex:3}},pi={mouseover:si,mouseout:ci,click:hi,entitychanged:k},ki=new a(255,0,0,0),ur={mouseover:or,mouseout:er,click:fr,entitychanged:k},ir=3e3,tr=3100,oi="auto",kt=250,bt=400,rt=[],dt={entitychanged:k};p.registerInfoboxRenderHandler=wt,p._attachToMap=fi,p._preRenderEntity=ni,p._unhookFromEntity=pt,p.registerIconData=bi}})(),delete window.Microsoft.Maps.initBingTheme,f&&f.Dynamic&&f.Dynamic.done("Microsoft.Maps.Themes.BingTheme"),c&&c.end("Module initialized","Microsoft.Maps.Themes.BingTheme",{module:"BingTheme"})},Microsoft.Maps.Map&&Microsoft.Maps.initBingTheme&&window.Microsoft.Maps.initBingTheme(),window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},window.Microsoft.Maps.initAdvancedShapes=function(){function e(n){var u=this,t,r;e.baseConstructor.call(u,n);if(n&&n.bubble===!0){this._bubble=!0;function f(n){n&&n.eventName&&i.invoke(u,n.eventName,n)}t=["mousedown","mouseup","mouseover","mouseout","click","rightclick","dblclick"],r=t.length;while(r--)this._eventsHandlers.push([t[r],f])}}function o(n,t){n&&n.length&&(this._locationsArrays=n[0]&&typeof n[0].latitude=="number"?[n]:n),this.setOptions(t)}function l(n,t){this._locationRect=n,this.setOptions(t)}function nt(n){function e(n,i){var e=null,r=n[t],o,u;return r&&(o=r.harmony,o&&(u=r.path,u&&(e=u.nativeShape,o.removePath(u),r.path=null)),r.updateEntity=r.updateEntity||i.update,r.isDrawn=!1),f.isEventsSupported()&&e?{doms:[e]}:null}function i(n){var i=n[t];return i||(i={},n[t]=i),i}var u=n,r="cm"+h.getNext(),t=r+"_etr";this.shouldDraw=function(n,t){var f=n.getVisible()&&(t.linear||t.animationEnd||c.animateShapes),e,r,u;return f&&(e=i(n),r=e.boundingRect,(t.update||!r)&&(u=n.getRings(),e.boundingRect=r=u&&u.length>0?w.fromLocations(u[0]):null),f=r&&t.currentBounds.intersects(r)),f},this.update=function(n,t){var s=t.viewportSize,o=i(n),a,l,b,e,nt,it,ut,v,rt,et,ft,tt,y,w,k;t.update=o.updateEntity||t.update,o.updateEntity=!1,a=o.harmony,!a&&t.parentDom&&(l=t.parentDom.harmony,l||(l=p("div","position:absolute;width:"+s.width+"px;height:"+s.height+"px;left:"+-(s.width/2)+"px;top:"+-(s.height/2)+"px;"+c.safariRenderHack),t.parentDom.harmony=l,b=t.parentDom,b.firstChild?b.insertBefore(l,b.firstChild):b.appendChild(l)),a=f.getContext(l),l.className="MicrosoftMapDrawing",o.harmony=a),e=o.path,nt=!1,e&&g.areEqual(o.previousSize,s)||(a.setSize(s.width,s.height),o.previousSize=s,nt=!0),e||(e=a.createPath(),e.id=r+"path"+h.getNext(),o.path=e,t.update=!0),t.update&&(it=n.getStrokeColor(),e.strokeStyle=it.toHex(),e.strokeOpacity=it.getOpacity(),e.lineWidth=n.getStrokeThickness(),e.dashArray=n.getStrokeDashArray(),ut=n.getFillColor(),e.fillStyle=ut.toHex(),e.fillOpacity=ut.getOpacity());if(!t.linear||!o.points||nt){rt=n.getRings(),o.ringPoints=[],o.offsetLeft=t.parentOffsetLeft,o.offsetTop=t.parentOffsetTop,v=rt.length;while(v--)o.ringPoints[v]=u.tryLocationToPixel(rt[v])}if(!t.linear||t.animationEnd||t.update||nt){et=o.ringPoints,e.beginPath(),ft=o.offsetLeft-s.width/2,tt=o.offsetTop-s.height/2,v=et.length;while(v--){y=et[v];if(y&&y.length)for(w=y[0],e.moveTo(w.x-ft,w.y-tt),k=1;k<y.length;k++)w=y[k],e.lineTo(w.x-ft,w.y-tt)}e.data||e.moveTo(0,0),e.stroke(),o.isDrawn||(a.renderPath(e),o.isDrawn=!0)}return f.isEventsSupported()?{doms:[e.nativeShape],type:d.polygon}:null},this.remove=e,this.dispose=function(n){delete n[t]}}function rt(n){function e(n,i){var e=null,r=n[t],o,u;return r&&(o=r.harmony,o&&(u=r.path,u&&(e=u.nativeShape,o.removePath(u),r.path=null)),r.updateEntity=r.updateEntity||i.update,r.isDrawn=!1),f.isEventsSupported()&&e?{doms:[e]}:null}function r(n){var i=n[t];return i||(i={},n[t]=i),i}var i=n,u="cm"+h.getNext(),t=u+"_etr";this.shouldDraw=function(n,t){var u=n.getVisible()&&(t.linear||t.animationEnd||c.animateShapes),f,i;return u&&(f=r(n),i=f.boundingRect,(t.update||!i)&&(f.boundingRect=i=n.getEllipse()),u=i&&t.currentBounds.intersects(i)),u},this.update=function(n,t){var k=t.viewportSize,b=r(n),st,et,ht,e,at,pt,yt,nt;t.update=b.updateEntity||t.update,b.updateEntity=!1,st=b.harmony,!st&&t.parentDom&&(et=t.parentDom.harmony,et||(et=p("div","position:absolute;width:"+k.width+"px;height:"+k.height+"px;left:"+-(k.width/2)+"px;top:"+-(k.height/2)+"px;"+c.safariRenderHack),t.parentDom.harmony=et,ht=t.parentDom,ht.firstChild?ht.insertBefore(et,ht.firstChild):ht.appendChild(et)),st=f.getContext(et),et.className="MicrosoftMapDrawing",b.harmony=st),e=b.path,at=!1,e&&g.areEqual(b.previousSize,k)||(st.setSize(k.width,k.height),b.previousSize=k,at=!0),e||(e=st.createPath(),e.id=u+"path"+h.getNext(),b.path=e,t.update=!0),t.update&&(pt=n.getStrokeColor(),e.strokeStyle=pt.toHex(),e.strokeOpacity=pt.getOpacity(),e.lineWidth=n.getStrokeThickness(),e.dashArray=n.getStrokeDashArray(),yt=n.getFillColor(),e.fillStyle=yt.toHex(),e.fillOpacity=yt.getOpacity());if(!t.linear||!b.center||at){var w=t.parentOffsetLeft-k.width/2,v=t.parentOffsetTop-k.height/2,ot=n.getEllipse();nt=i.tryLocationToPixel(ot.center);var vt=i.tryLocationToPixel(new s(ot.getNorth(),ot.center.longitude-ot.width/2)),wt=i.tryLocationToPixel(new s(ot.getSouth(),ot.center.longitude+ot.width/2)),bt=vt.x<nt.x?Math.abs(nt.x-vt.x):Math.abs(wt.x-nt.x);b.center=nt;var it=.5522847498,ct=[nt.x-bt,nt.x,nt.x+bt],lt=[vt.y,nt.y,wt.y],y,a,l,o,rt,ut,tt,ft;y=ct[1],a=lt[0],l=ct[2],o=lt[1],rt=y+(l-y)*it,ut=a,tt=l,ft=o-(o-a)*it,e.beginPath(),e.moveTo(y-w,a-v),e.curveTo(rt-w,ut-v,tt-w,ft-v,l-w,o-v),y=l,a=o,l=ct[1],o=lt[2],rt=y,ut=a+(o-a)*it,tt=l+(y-l)*it,ft=o,e.curveTo(rt-w,ut-v,tt-w,ft-v,l-w,o-v),y=l,a=o,l=ct[0],o=lt[1],rt=y-(y-l)*it,ut=a,tt=l,ft=o+(a-o)*it,e.curveTo(rt-w,ut-v,tt-w,ft-v,l-w,o-v),y=l,a=o,l=ct[1],o=lt[0],rt=y,ut=a-(a-o)*it,tt=l-(l-y)*it,ft=o,e.curveTo(rt-w,ut-v,tt-w,ft-v,l-w,o-v),e.stroke(),b.isDrawn||(st.renderPath(e),b.isDrawn=!0)}return f.isEventsSupported()?{doms:[e.nativeShape],type:d.polygon}:null},this.remove=e,this.dispose=function(n){delete n[t]}}var t=window.Microsoft.Maps,ft=t.Globals,i=t.Events,w=t.LocationRect,s=t.Location,n=t.InternalNamespaceForDelay,h=n.IdGenerator,tt=n.PRF,it=t.EntityCollection,b=t.Polygon,c=n.Quirks,v=n.Common,k=n.CompositeMode,f=n.Harmony,g=n.Size,d=n.EventTargetType,ut=v.stopPropagation,p=v.createElement,a=v.extend,y,r,u;a(e,it),y=e.prototype,y.setOptions=function(n,t){var r=e.superClass.setOptions.call(this,n,!0),f,u;if(this._bubble&&n.bubble!==!1){f=this.getLength();while(f--)u=this.get(f),u.setOptions&&(r=u.setOptions(n,!0)||r)}return r&&!t&&i.invoke(this,"entitychanged",{entity:this}),r},y.toString=function(){return"[AdvancedShapes.EntityCollection]"},t.EntityCollection=e,a(o,b),r=o.prototype,r.setRings=function(n){this._locationsArrays=n,i.invoke(this,"entitychanged",{entity:this})},r.getRings=function(){return this._locationsArrays},r.setLocations=function(n){this._locationsArrays=[n],i.invoke(this,"entitychanged",{entity:this})},r.getLocations=function(){var n=this._locationsArrays;return n&&n.length?n[0]:null},r.setOptions=function(n,t){var r=o.superClass.setOptions.call(this,n,!0);return r&&!t&&i.invoke(this,"entitychanged",{entity:this}),r},r.toString=function(){return"[AdvancedShapes.Polygon]"},t.Polygon=o,a(l,b),u=l.prototype,u.setEllipse=function(n){this._locationRect=n,i.invoke(this,"entitychanged",{entity:this})},u.getEllipse=function(){return this._locationRect},u.setLocations=function(n){this._locationRect=w.fromLocations(n),i.invoke(this,"entitychanged",{entity:this})},u.getLocations=function(){var n=this._locationRect;return[n.getNorthwest(),new s(n.getNorth(),n.getEast()),n.getSoutheast(),new s(n.getSouth(),n.getWest())]},u.toString=function(){return"[AdvancedShapes.Ellipse]"},t.Ellipse=l,new function(){var n=[],t=[],i=function(i,r){var u=null,f;if(r instanceof o){f=n.length;while(f--)n[f]===i&&(u=t[f]);u||(u=new nt(i),n.push(i),t.push(u))}return u};k.registerEntityRenderer(i,{priority:0})},new function(){var n=[],t=[],i=function(i,r){var u=null,f;if(r instanceof l){f=n.length;while(f--)n[f]===i&&(u=t[f]);u||(u=new rt(i),n.push(i),t.push(u))}return u};k.registerEntityRenderer(i,{priority:0})},delete window.Microsoft.Maps.initAdvancedShapes,n.Dynamic&&n.Dynamic.done("Microsoft.Maps.AdvancedShapes"),tt.add("AdvancedShapes initialized")},Microsoft.Maps.Map&&Microsoft.Maps.initAdvancedShapes&&window.Microsoft.Maps.initAdvancedShapes(),window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},window.Microsoft.Maps.initDirectionsCode=function(){function wr(n){this._map=n,this._task=null,this._sessionState={}}function ft(t){function r(n){n&&n.disambiguation&&(i._disambiguation=n.disambiguation),i._uniqueId===null&&(i._uniqueId=ft._uniqueWaypointId++)}function u(t){if(t){var r=!1;t.address&&t.address.formattedAddress&&(t.latitude&&t.longitude&&((!i._location||i._location&&(i._location.latitude!==t.latitude||i._location.longitude!==t.longitude))&&(r=!0),i._location=new a(t.latitude,t.longitude),i._geoLocation=new a(t.latitude,t.longitude)),i._address!==t.address.formattedAddress&&(r=!0),i._shortAddress!==t.address.shortFormattedAddress&&(r=!0),i._shortAddress=t.address.shortFormattedAddress,i._address=t.address.formattedAddress,i._exactLocation=!0,i._inputType=t.inputType,r&&n.invoke(i,"changed",{waypoint:i})),t.disambiguation&&(i._inputType=t.inputType,i._disambiguation=t.disambiguation,i._location||(r=!0)),r&&i._geocoded()}}var i=this;i.setOptions=function(t){var u,f;t&&(u=!1,r(t),typeof t.address=="string"&&i._address!==t.address&&(i._address=t.address,i._disambiguation=null,u=!0),t.location&&!a.areEqual(t.location,i._location)&&(i._location=t.location,u=!0),t.geoLocation&&!a.areEqual(t.geoLocation,i._geoLocation)&&(i._geoLocation=t.geoLocation,u=!0),typeof t.isViapoint=="boolean"&&(i._isViapoint=t.isViapoint,u=!0),(t.pushpin&&t.pushpin instanceof lt||t.pushpin===null)&&(i._pushpin=t.pushpin,u=!0),typeof t.shortAddress=="string"&&(i._shortAddress=t.shortAddress,i._disambiguation=null,u=!0),typeof t.exactLocation=="boolean"&&(i._exactLocation=t.exactLocation,u=!0),typeof t.disambiguationContainer=="object"&&(i._disambiguationContainer=t.disambiguationContainer,u=!0),t.businessDetails&&(f=t.businessDetails,typeof f.businessName=="string"&&(i._businessName=f.businessName,u=!0),typeof f.phoneNumber=="string"&&(i._phoneNumber=f.phoneNumber,u=!0),typeof f.entityId=="string"&&(i._entityId=f.entityId,u=!0),typeof f.website=="string"&&(i._website=f.website,u=!0)),u&&n.invoke(i,"changed",{waypoint:i}))},i.clear=function(){i._address="",i._shortAddress="",i._locationIdentifier="",i._location=null,i._geoLocation=null,i._businessName="",i._phoneNumber="",i._exactLocation=!0,i._disambiguationContainer=null,i._disambiguation=null,i._entityId="",i._website="",i._inputType=null,i._isViapoint=i._isViapoint,n.invoke(i,"cleared",{waypoint:i})},i._updateWaypoint=function(n){n&&(n.failed||u(n))},i._reverseGeocoded=function(){n.invoke(i,"reverseGeocoded",{waypoint:this})},i._geocoded=function(){n.invoke(i,"geocoded",{waypoint:this})},r(t),i.setOptions(t)}function vu(t,i){function s(n,t,i,r,u){i.visible=!1,i.id=n;var e=new hf(t,i),o=new ui;return o.init(f,e,t,r,u),e.ZoomAwarePolyline=ui,e}function e(n){var t,i=u.getOptions();return t=n===rt.walk?u.cloneOptions(i.walkingPolylineOptions):n===rt.ferry||n===rt.bus||n===rt.train||n===rt.airline||n===rt.other?u.cloneOptions(i.transitPolylineOptions):u.cloneOptions(i.drivingPolylineOptions)}var r=this,f=t,u=i;r._displayedRoutes={},r.updateRouteOnMapControl=function(n,t,i){for(var tt=n.length,f,k,s,d,y,nt,h,b,l,c,v=0;v<tt;v++){f=n[v];if(r._displayedRoutes[f.legKey])continue;for(k=f.subLegs.length,s=0;s<k;s++)if(!r._displayedRoutes[f.subLegs[s].subLegKey]){var a=f.subLegs[s].routePath,w=[],g=u.getOptions().routeMode;if(g!==o.transit)p.decodeRoute(a,!0),d=g===o.walking?rt.walk:rt.auto,w[0]=r.addPolyline(f.subLegs[s].subLegKey,a,e(d),t,f.legKey,f.subLegs[s].subLegKey);else for(p.decodeRoute(a,!1),y=wt._splitTransitRoutes(f.itineraryItems,a),nt=y.length,h=0;h<nt;h++){if(f.itineraryItems[h].startPathIndex===f.itineraryItems[h].endPathIndex)continue;b=f.itineraryItems[h].iconType,l=null,f.itineraryItems[h]&&f.itineraryItems.length===y.length&&(l=e(b),i&&(c=l.strokeColor.clone(),c.a=c.getOpacity()<.5?c.a+80:c.a-80,l.strokeColor=c)),w[w.length]=r.addPolyline(f.subLegs[s].subLegKey+"_"+h,y[h],l,t,f.legKey,f.subLegs[s].subLegKey)}}}},r.clearRoute=function(t){var c,u,o,h,l,e,a,s;if(t)for(r._removeAllTemporaryRoutes(),c=t.length,u=0;u<c;u++){o=r._displayedRoutes;for(h in o){l=o[h];if(l.subLegKey===t[u]||l.parentLegKey===t[u]){for(e=l.polylines,a=e.length,s=0;s<a;s++)f.entities.remove(e[s]),n.invoke(this,"polylineRemoved",{polyline:e[s]});delete r._displayedRoutes[h]}}}else{o=r._displayedRoutes;for(h in o)for(e=o[h].polylines,c=e.length,u=0;u<c;u++)f.entities.remove(e[u]),n.invoke(this,"polylineRemoved",{polyline:e[u]});r._displayedRoutes={}}},r._removeAllTemporaryRoutes=function(){var e=r._displayedRoutes,u,i,t,o,n;for(u in e){i=e[u];if(i.temporaryRoute){for(t=i.polylines,o=t.length,n=0;n<o;n++)f.entities.remove(t[n]);delete r._displayedRoutes[u]}}},r.addPolyline=function(t,i,f,e,o,h){for(var p=i.decodedLatitudes.length,w=new Array(p),v,c,y,l=0;l<p;l++)w[l]=new a(i.decodedLatitudes[l],i.decodedLongitudes[l]);return v=s(u.PolylinePrefixId+t,w,f,i.decodedRegions,i.zoomLevels.split(",")),r._displayedRoutes[h]?(y=r._displayedRoutes[h].polylines,y[y.length]=v):(c=new fr,c.polylines=[],c.parentLegKey=o,c.polylines[0]=v,c.subLegKey=h,c.temporaryRoute=e,r._displayedRoutes[h]=c),n.invoke(this,"polylineAdded",{polyline:v,tempararyPolyline:e}),v},r.dispose=function(){r.clearRoute(null,!1)}}function iu(n,o,s,h){function nt(n){return d?t._convert24HourTo12Hour(n):n}function tt(n){return n?i.getString("L_TimePM_Text"):i.getString("L_TimeAM_Text")}function rt(){var u=y(w),f=u.innerHTML,r=t.getDateFromStringInSupportedFormat(f,c.TransitDateFormat),i=n.getOptions().transitOptions.transitTime;i instanceof Date||(i=new Date),r&&(i=new Date(r.getFullYear(),r.getMonth(),r.getDate(),i.getHours(),i.getMinutes(),i.getSeconds())),n.setOptions({transitOptions:{transitTime:i}}),h&&h(i)}function k(i){var r=n.getOptions().transitOptions.transitTime,e,u,f;r instanceof Date||(r=new Date),e=r.getHours()>=12^i,p&&(p.innerHTML=tt(e)),u=parseInt(a.value,10),d&&(u=t._convert12HourTo24Hour(u,e)),u<0||u>23?a.value=nt(r.getHours()).toString():r.setHours(u),f=parseInt(v.value,10),f<0||f>59?v.value=r.getMinutes().toString():r.setMinutes(f),n.setOptions({transitOptions:{transitTime:r}}),h&&h(r)}var d=c.TransitTimeUse12Hour,it=n._getPrefixId(),w=it+o,l=n.getOptions().transitOptions.transitTime,g,a,v,p;l instanceof Date||(l=new Date),f("label",w,"transitDateContainer transitDateTimeBox transitCalendarOpener",s,t.getDateInSupportedFormat(l)),g=b==="ja-jp",nr.InitCalendar(w,l,g,r(self,rt)),a=f("input","hourInput","transitDateTimeBox transitTimeBox",s,""),a.value=nt(l.getHours()).toString(),a.setAttribute("type","text"),a.setAttribute("maxlength",2),a.setAttribute("size",2),f("label","","transitTimeSeperator",s,":"),v=f("input","minuteInput","transitDateTimeBox transitTimeBox",s,null),v.value=(l.getMinutes()<10?"0":"")+l.getMinutes().toString(),v.setAttribute("type","text"),v.setAttribute("maxlength",2),v.setAttribute("size",2),p=null,d&&(p=e("amPmSwitch","transitDateTimeBox",s),p.innerHTML=tt(l.getHours()>=12),u(p).add_event("click",r(self,function(){k(!0)}))),u(a).add_event("change",k),u(v).add_event("change",k)}function oi(n,i){function u(n){var i=r._state.getOptions(),u=i.transitOptions,t;if(i.routeMode!==o.transit)return;n||(n={});switch(u.timeType){case et.departure:default:n.limit="D";break;case et.arrival:n.limit="A";break;case et.lastAvailable:n.limit="LT"}t=u.transitTime,t instanceof Date||(t=new Date),n.time=""+t.getFullYear()+(t.getMonth()+1<10?"0":"")+(t.getMonth()+1)+(t.getDate()<10?"0":"")+t.getDate()+(t.getHours()<10?"0":"")+t.getHours()+(t.getMinutes()<10?"0":"")+t.getMinutes(),n.sri=i.routeIndex,n.maxr=r._state.getOptions().maxRoutes,c.TransitAdvancedOptions&&(n.opt=i.routeOptimization)}function f(n){var u="",t=n.getDisambiguationResult(),i;return t?(t.dependentLocation.latitude||t.dependentLocation.longitude)&&(u=t.dependentLocation.latitude.toFixed(l)+","+t.dependentLocation.longitude.toFixed(l)):(i=r._state.getPreviousWaypoint(n._uniqueId),i&&i.getLocation()&&(u=i.getLocation().latitude.toFixed(l)+","+i.getLocation().longitude.toFixed(l))),u}var r=this;r._map=n,r._state=i,r.generateGetDirectionsLink=function(n,t,i){for(var f={},e="",l=t.length,c=!1,o,s,h,u=0;u<l;u++)u>0&&(e+="~"),o=t[u],e+=r._getStopPointParam(o),o.getLocation()||o.getDisambiguationResult()||(c=!0);for(f.w=e,e="",u=0;u<n.length;u++)u>0&&(e+="|"),s=n[u],e+=s[0].toString()+"~"+s[1].toString();return f.d=e,e="",r._addRouteOptionsLink(f,!0),c&&(f.bb=r._generateMapBoundingBoxLink(),r.addUserLocation(f)),typeof VEShell!="undefined"&&(h=r._getQueryParam(null,null),h&&(f.q=h)),r._addPermalinkAdditionalParams(f,i),f},r.generateNearbyArterialsLink=function(n,t){var i={},u=n.latitude.toFixed(l)+","+n.longitude.toFixed(l)+",";return i.w=u,i.m="8",r._addPermalinkAdditionalParams(i,t),i},r.generateReverseGeocodeLink=function(n,t){var i={},u;return i.m="7",u=n.latitude.toFixed(l)+","+n.longitude.toFixed(l)+",",i.w=u,r._addPermalinkAdditionalParams(i,t),i},r.generateGetTransitScheduleLink=function(n,t){var i={m:"9",stopIds:n.join(","),transitType:2};return u(i),r._addPermalinkAdditionalParams(i,t),i},r.generateResolveWaypointLink=function(n,t,i,u,e){var o={},h,s;return o.w="a."+n.getAddress(),i?t?o.prew=t.latitude.toFixed(l)+","+t.longitude.toFixed(l):o.start="1":(h=n._uniqueId===r._state.stoppoints[0]._uniqueId,o.start=h?"1":"0",h||(s=f(n),s&&(o.prew=s))),o.bb=r._generateMapBoundingBoxLink(),r.addUserLocation(o),u<0||(o.si=u),r._addPermalinkAdditionalParams(o,e),o},r.addUserLocation=function(){},r._addPermalinkAdditionalParams=function(n){var f="",e=t.parseQueryString().form,o,s,u,r;e&&(n.FORM=e);for(o in n)f+=n[o].toString();for(s=f.length,u=0,r=0;r<s;r++)u+=f.charCodeAt(r);ni.useXHR||(n.jsonso="d"+u,n.jsonp="microsoftMapsNetworkCallback"),n.mkt=b,w.ishttpsenabled&&(n.s="1")},r._getStopPointParam=function(n){var t="",i;return n.isViapoint()&&(t+="v."),i=n.getLocation(),i?(t+=i.latitude.toFixed(l),t+=",",t+=i.longitude.toFixed(l),r._state.getOptions().routeMode!==o.transit&&n._locationIdentifier&&(t+=",",t+=n._locationIdentifier)):t+="a."+n.getAddress(),t},r._generateMapBoundingBoxLink=function(){var t="",n;return r._map&&(n=r._map.getBounds(),t+=n.getNorth().toFixed(l)+","+n.getEast().toFixed(l),t+="~",t+=n.getSouth().toFixed(l)+","+n.getWest().toFixed(l)),t},r._addRouteOptionsLink=function(n,t){var i=r._state.getOptions(),f,e;switch(i.routeMode){case o.walking:n.mode="W";break;case o.transit:n.mode="T";break;case o.driving:default:n.mode="D"}f="",i.routeMode===o.driving?(f+=i.routeOptimization+"~",f+=i.avoidTraffic?"1":"0",f+="~0~",n.rtop=f):r._state.getOptions().routeMode===o.transit&&u(n),t&&(n.u=r._state.getOptions().distanceUnit===tt.miles?"0":"1"),i.routeAvoidance!==s.none&&(e=i.routeAvoidance,(e&s.avoidExpressTrain)===s.avoidExpressTrain&&(e|=s.avoidBulletTrain),n.av=e)},r._getQueryParam=function(n,t){var s="",o=r._state.getAllWaypoints(),i,f,u,e;return o&&(i=o[0],f=i.getAddress(),!f&&i.getLocation()&&(f=wi.replace("{0}",i.getLocation().latitude.toFixed(l)).replace("{1}",i.getLocation().longitude.toFixed(l))),u=o[o.length-1],e=u.getAddress(),!e&&u.getLocation()&&(e=wi.replace("{0}",u.getLocation().latitude.toFixed(l)).replace("{1}",u.getLocation().longitude.toFixed(l))),n&&t&&(i._uniqueId===n._uniqueId?f=wi.replace("{0}",t.latitude.toFixed(l)).replace("{1}",t.longitude.toFixed(l)):u._uniqueId===n._uniqueId&&(e=wi.replace("{0}",t.latitude.toFixed(l)).replace("{1}",t.longitude.toFixed(l)))),s=f+"~"+e),s}}function ot(i){function rt(n){for(var f=0;f<n.length;f++){var u=n[f].transitLine,r=or,i=sr;u&&(u.lineColor&&(r=u.lineColor),u.lineTextColor&&(i=u.lineTextColor),r===or&&i!==sr&&(r=t.getLuminance(i)<rf?yr:ar),r!==or&&i===sr&&(i=t.getLuminance(r)<of?yr:ar),Math.abs(t.getLuminance(r)-t.getLuminance(i))<50&&(r=ar,i=yr),u.lineColor=r,u.lineTextColor=i)}}function ut(){var n=c.DefaultMode;return typeof VEShell!="undefined"&&typeof r.sessionState.defaultRouteMode=="string"&&(n=r.sessionState.defaultRouteMode),n}function d(n){var i=r.routes[n].routeLegs,u;if(!i||!i.length)return;for(r.summary[n].northEast=i[0].summary.northEast,r.summary[n].southWest=i[0].summary.southWest,u=1;u<i.length;u++){var t=i[u].summary,o=r.summary[n].northEast.latitude>t.northEast.latitude?r.summary[n].northEast.latitude:t.northEast.latitude,s=r.summary[n].southWest.latitude<t.southWest.latitude?r.summary[n].southWest.latitude:t.southWest.latitude,f=r.summary[n].northEast.longitude>t.northEast.longitude?r.summary[n].northEast.longitude:t.northEast.longitude,e=r.summary[n].southWest.longitude<t.southWest.longitude?r.summary[n].southWest.longitude:t.southWest.longitude;r.summary[n].northEast=new a(o,f),r.summary[n].southWest=new a(s,e)}r.updateBoundingBoxWithBuffer(r.summary[n].northEast,r.summary[n].southWest)}function v(n){if(n==null)return null;var t={};for(key in n)t[key]=typeof n[key]!="object"||n[key]instanceof Date||n[key]instanceof a||n[key]instanceof Microsoft.Maps.Color||n[key]instanceof Array||key==="itineraryContainer"?n[key]&&n[key].clone?n[key].clone():n[key]:v(n[key]);return t}function h(n){var t;return t=typeof f[n]=="object"?v(f[n]):f[n]}function g(n,t){if(!t||typeof t!="object")return;n==null&&(n=t),typeof t.routeIndex=="undefined"&&(typeof t.transitOptions!="undefined"||typeof t.routeMode!="undefined")&&(t.routeIndex=0);for(key in t)typeof t[key]!="undefined"&&(typeof n[key]!="object"||n[key]==null||n[key]instanceof Date||n[key]instanceof a||key==="itineraryContainer"||typeof t[key]!="object"||t[key]instanceof Date||t[key]instanceof a?((typeof n[key]==typeof t[key]||typeof n[key]=="undefined"||n[key]==null)&&((key==="routeMode"&&n[key]!==t[key]||key==="avoidTraffic"&&n[key]!==t[key]||key==="routeOptimization"&&n[key]!==t[key]||key==="routeAvoidance"&&n[key]!==t[key]||key==="timeType"&&n[key]!==t[key]||key==="distanceUnit"&&n[key]!==t[key])&&(key==="routeMode"&&r.stoppoints.length>2&&t[key]===o.transit?t[key]=n[key]:p()),key==="routeIndex"&&typeof t[key]=="number"?r.routes&&r.routes.length>0&&(t[key]>r.routes.length-1&&(t[key]=0),r.currentRouteLegs=r.routes[t[key]].routeLegs):key==="maxRoutes"&&(typeof t[key]!="number"||t[key]>gu||t[key]<1)?t[key]=n[key]:key==="timeType"&&b!=="ja-jp"&&t[key]===et.lastAvailable?t[key]=n[key]:key!=="routeAvoidance"||b==="ja-jp"||t[key]<s.avoidExpressTrain?key==="routeOptimization"&&b!=="ja-jp"&&(t[key]===st.minimizeMoney||t[key]===st.minimizeTransfers||t[key]===st.minimizeWalking)&&(t[key]=n[key]):t[key]=n[key],n[key]=t[key]),key==="transitTime"?(!t[key]instanceof Date&&(n[key]=null),p()):key==="itineraryContainer"&&(n[key]=t[key])):g(n[key],t[key]))}function p(){r.summary=null,r.currentRouteLegs.length=0,r.routes=null}var r=this,e,nt,k,y,f;r.saveUserLocationEnabled=!1,r.stoppoints=[],r.inlineImagesCache=[],r.currentRouteLegs=[],r.summary=null,r.isLandingPage=!1,r.routes=null,r.sessionState=i,ot._uniquePrefixId++,e=ot._uniquePrefixId,r.TransitStepPinPrefixId=pf+e+"_",r.SteppinPrefixId=yu+e+"_",r.StoppointPinPrefixId=vf+e+"_",r.DisambiguationPinPrefixId=yf+e+"_",r.PolylinePrefixId=af+e+"_",r.ItineraryPrefixId=kf+e+"_",nt="0",r.distanceUnitFromCookie="",k=r.distanceUnitFromCookie?r.distanceUnitFromCookie===yi?tt.miles:tt.kilometers:c.DistanceUnitMiles?tt.miles:tt.kilometers,y={routeAvoidance:s.none,avoidTraffic:bu,routeOptimization:st.shortestTime,routeMode:ut(),routeIndex:0,maxRoutes:3,transitOptions:{transitTime:null,timeType:et.departure,showTransitStopSchedule:null,scheduleName:null},routeDraggable:!0,distanceUnit:k,itineraryContainer:null,waypointPushpinOptions:{height:48,width:44,anchor:new it(38,41),textOffset:new it(-10,4),draggable:c.WaypointDragging,hoverIcon:w.directionsImagePath+"pins/POI_flag_hover.png",icon:w.directionsImagePath+"pins/POI_flag_start.png",visible:ht?!1:!0},middleWaypointIcon:w.directionsImagePath+"pins/POI_flag_middle.png",lastWaypointIcon:w.directionsImagePath+"pins/POI_flag_end.png",stepPushpinOptions:{width:14,height:14,visible:!1,anchor:new it(6,7),draggable:!1,icon:w.directionsImagePath+"pins/POI_step.png"},viapointPushpinOptions:{height:27,width:27,anchor:new it(13,13),draggable:!0,visible:ht?!1:!0,icon:w.directionsImagePath+"pins/POI_dd-via-large.png"},drivingPolylineOptions:{strokeColor:new Microsoft.Maps.Color(vr,gr,uu,eu),strokeThickness:hr},walkingPolylineOptions:{strokeColor:new Microsoft.Maps.Color(vr,pu,nf,wu),strokeThickness:hr,strokeDashArray:"5 4"},transitPolylineOptions:{strokeColor:new Microsoft.Maps.Color(vr,gr,uu,eu),strokeThickness:hr},autoUpdateMapView:!0,autoDisplayDisambiguation:!0,displayStepWarnings:!0,displayTrafficAvoidanceOption:!0,displayPreItineraryItemHints:!0,displayPostItineraryItemHints:!0,displayManeuverIcons:!0,displayDisclaimer:!1,displayWalkingWarning:!0,displayRouteSelector:!0,disambiguationPushpinOptions:{hoverIcon:w.directionsImagePath+"pins/poi_desktop_default_selected.png",icon:w.directionsImagePath+"pins/poi_desktop_default.png",width:28,height:28,visible:ht?!1:!0,anchor:new it(14,14),textOffset:new it(0,5)},displayRouteModeOptions:!1,displayWaypointDisambiguation:!1,displayLandingPage:!1},f=v(y),r.cloneOptions=v,r.resetDirectionState=function(n){var i,t;n?(n.removeAllWaypoints&&r._removeAllStoppoints(),n.resetRequestOptions&&(i=r.getRenderOptions(),f=v(y),r.setOptions(null,i)),n.resetRenderOptions&&(t=r.getRequestOptions(),f=v(y),r.setOptions(t,null))):(f=v(y),r._removeAllStoppoints()),p()},r.getOptions=function(){return f},r.getRenderOptions=function(){return{displayRouteModeOptions:f.displayRouteModeOptions,displayWaypointDisambiguation:f.displayWaypointDisambiguation,displayLandingPage:f.displayLandingPage,disambiguationPushpinOptions:h("disambiguationPushpinOptions"),itineraryContainer:f.itineraryContainer,waypointPushpinOptions:h("waypointPushpinOptions"),stepPushpinOptions:h("stepPushpinOptions"),middleWaypointIcon:f.middleWaypointIcon,lastWaypointIcon:f.lastWaypointIcon,viapointPushpinOptions:h("viapointPushpinOptions"),drivingPolylineOptions:h("drivingPolylineOptions"),walkingPolylineOptions:h("walkingPolylineOptions"),transitPolylineOptions:h("transitPolylineOptions"),autoDisplayDisambiguation:f.autoDisplayDisambiguation,displayStepWarnings:f.displayStepWarnings,displayPreItineraryItemHints:f.displayPreItineraryItemHints,displayPostItineraryItemHints:f.displayPostItineraryItemHints,displayManeuverIcons:f.displayManeuverIcons,displayRouteSelector:f.displayRouteSelector,displayTrafficAvoidanceOption:f.displayTrafficAvoidanceOption,displayWalkingWarning:f.displayWalkingWarning,displayDisclaimer:f.displayDisclaimer,autoUpdateMapView:f.autoUpdateMapView}},r.getRequestOptions=function(){return{routeIndex:f.routeIndex,routeMode:f.routeMode,routeAvoidance:f.routeAvoidance,routeOptimization:f.routeOptimization,avoidTraffic:f.avoidTraffic,distanceUnit:f.distanceUnit,maxRoutes:f.maxRoutes,transitOptions:h("transitOptions"),routeDraggable:f.routeDraggable}},r.setOptions=function(){for(var i,r=0;r<arguments.length;r++)i=arguments[r],i&&typeof i=="object"&&(typeof i.singleton!="undefined"&&(y.singleton=i.singleton),g(f,i))},r.saveSessionRouteMode=function(){typeof VEShell!="undefined"&&typeof f.routeMode=="string"&&(r.sessionState.defaultRouteMode=f.routeMode)},r.updateBoundingBoxWithBuffer=function(n,t){var r=nu*(n.latitude-t.latitude),i=nu*(n.longitude-t.longitude);n.latitude+=r,t.latitude-=r,n.longitude+=i,t.longitude-=i},r.addStoppoint=function(t,i){i===undefined?this.stoppoints[this.stoppoints.length]=t:this.stoppoints.splice(i,0,t),n.invoke(this,"waypointAdded",{waypoint:t})},r.updateRouteModeAndUnitBasedOnRouteResult=function(n){if(n)switch(n.requestedRouteMode){case 2:f.routeMode=o.walking;break;case 4:f.routeMode=o.transit;break;default:f.routeMode=o.driving}n.distanceUnit&&(f.distanceUnit=n.distanceUnit===yi?tt.miles:tt.kilometers)},r.removeModifiedLegs=function(n){for(var u=0,e=[],l,s,c,i,h,o,f,t=0;t<r.currentRouteLegs.length;t++){for(l=!1,i=0;i<r.stoppoints.length-1;i++){s=r.stoppoints[i];if(s.isViapoint())continue;o=u+"~"+s._uniqueId+"~"+r.getNextWaypoint(s._uniqueId)._uniqueId;if(r.routes[u].routeLegs[t].legKey===o){l=!0;break}}l||(f=r.routes[u].routeLegs[t].legKey,e[e.length]=f,r.removeLeg(f),t--)}if(n&&n.length>0)for(t=0;t<r.currentRouteLegs.length;t++){for(c=!1,i=0;i<n.length;i++){h=n[i],o=u+"~"+r.stoppoints[h[0]]._uniqueId+"~"+r.stoppoints[h[1]]._uniqueId;if(r.routes[u].routeLegs[t].legKey===o){c=!0;break}}c&&(f=r.routes[u].routeLegs[t].legKey,e[e.length]=f,r.removeLeg(f),t--)}return e},r.getUnavailableRouteWaypointIndexes=function(){for(var a=0,h=[],c,n,i,l,e,t,o,s,f,u=0;u<r.stoppoints.length-1;u++){c=!1,n=r.stoppoints[u];if(n.isViapoint())continue;i=r.getNextWaypoint(n._uniqueId);if(r.routes)for(l=r.routes[a].routeLegs,e=0;e<l.length;e++){t=l[e],o=t.subLegs.length;if(t.legKey===a+"~"+n._uniqueId+"~"+i._uniqueId&&n.getLocation()&&i.getLocation()&&t.subLegs[0].actualStart.latitude===n.getLocation().latitude&&t.subLegs[0].actualStart.longitude===n.getLocation().longitude&&t.subLegs[o-1].actualEnd.latitude===i.getLocation().latitude&&t.subLegs[o-1].actualEnd.longitude===i.getLocation().longitude&&(!r.getAllViaInLeg||o===r.getAllViaInLeg(n._uniqueId).length+1)){c=!0;break}}if(!c){for(s=new Array(2),s[0]=u,f=u+1;f<r.stoppoints.length;f++)if(r.stoppoints[f]._uniqueId===i._uniqueId){s[1]=f;break}h[h.length]=s}}return h},r.getStoppointIndex=function(n){for(var t=0;t<r.stoppoints.length;t++)if(n===r.stoppoints[t]._uniqueId)return t;return-1},r.getStoppointByIndex=function(n){for(var t=0;t<r.stoppoints.length;t++)if(t===n)return r.stoppoints[t];return null},r.getAllStoppointIds=function(){for(var t=[],n=0;n<r.stoppoints.length;n++)t[n]=r.stoppoints[n]._uniqueId;return t},r.getAllWaypoints=function(){for(var t=[],n=0;n<r.stoppoints.length;n++){if(r.stoppoints[n].isViapoint())continue;t[t.length]=r.stoppoints[n]}return t},r.getViaCount=function(){var t=0,i,n;if(r.stoppoints)for(i=r.stoppoints.length,n=0;n<i;n++)r.stoppoints[n].isViapoint()&&t++;return t},r.removeEmptyWaypoints=function(){var e=!1,i,t,f;if(r.stoppoints.length>2)for(i=0;i<r.stoppoints.length;i++){t=r.stoppoints[i];if(t){f=u.Helper.index_of(r.stoppoints,t);if(t.isViapoint()&&e){f<0||(r.stoppoints.splice(f,1),n.invoke(r,"waypointRemoved",{waypoint:t})),i--;continue}!i||t.getAddress()||t.getLocation()?e=!1:(f<0||(r.stoppoints.splice(f,1),n.invoke(r,"waypointRemoved",{waypoint:t})),i--,e=!0)}}r.removeModifiedLegs(null)},r.getStoppointById=function(n){for(var t=0;t<r.stoppoints.length;t++)if(r.stoppoints[t]._uniqueId===n)return r.stoppoints[t];return null},r.getPreviousStopPoint=function(n){for(var i=null,t=1;t<r.stoppoints.length;t++)r.stoppoints[t]._uniqueId===n&&(i=r.stoppoints[t-1]);return i},r.getPreviousWaypoint=function(n){for(var f=null,u=!1,i,t=0;t<r.stoppoints.length;t++){i=r.stoppoints[t];if(i._uniqueId===n){u=!0;break}i.isViapoint()||(f=r.stoppoints[t])}return u?f:null},r.getNextStoppoint=function(n){for(var i=null,t=0;t<r.stoppoints.length-1;t++)r.stoppoints[t]._uniqueId===n&&(i=r.stoppoints[t+1]);return i},r.getNextWaypoint=function(n){for(var f=null,e=!1,t,u,i=0;i<r.stoppoints.length-1;i++)if(r.stoppoints[i]._uniqueId===n){for(t=i+1;t<r.stoppoints.length;t++){u=r.stoppoints[t];if(!u.isViapoint()){f=r.stoppoints[t];break}}e=!0;break}return e?f:null},r.getRouteLegByLegKey=function(n){for(var t=0;t<r.currentRouteLegs.length;t++)if(r.currentRouteLegs[t].legKey===n)return r.currentRouteLegs[t];return null},r.removeStoppoint=function(t,i){for(var e=!1,s=-1,f,o,u=0;u<r.stoppoints.length;u++){f=r.stoppoints[u],e=f.isViapoint();if(f._uniqueId===t){r.stoppoints.splice(u,1),n.invoke(r,"waypointRemoved",{waypoint:f});break}e||(s=u)}if(!e&&i)for(u=s+1;u<r.stoppoints.length;u++)if(r.stoppoints[u].isViapoint())o=r.stoppoints[u],r.stoppoints.splice(u,1),n.invoke(r,"waypointRemoved",{waypoint:o}),u--;else break;r.removeModifiedLegs(null)},r.reverseWaypoints=function(){var t,n,i;for(r.removeAllViaPoint&&r.removeAllViaPoint(),t=r.stoppoints.length,n=0;n<t-1;n++)i=r.stoppoints[t-1],r.stoppoints.splice(t-1,1),r.stoppoints.splice(n,0,i)},r.addInlineImages=function(n){if(n)for(var t in n)r.inlineImagesCache[t]=n[t]},r.addRoutes=function(n,t){var h,u,i;if(!t||t.length===0)return;if(f.routeMode===o.transit||!r.routes)for(n||f.routeMode!==o.transit||(n=[],n[0]=[0,1]),r.routes=new Array(t.length),i=0;i<t.length;i++)r.routes[i]={},r.routes[i].routeLegs=[];for(h=f.routeIndex,(r.stoppoints.length>2||r.routes&&h>=r.routes.length)&&r.setOptions({routeIndex:0}),r.currentRouteLegs=r.routes[f.routeIndex].routeLegs,u=0;u<t.length;u++)for(i=0;i<t[u].routeLegs.length;i++){var c=n[i],l=c[0],s=c[1],e=t[u].routeLegs[i];e.legKey=u+"~"+r.stoppoints[l]._uniqueId+"~"+r.stoppoints[s]._uniqueId,e.startWaypointLocation=r.stoppoints[l].getLocation(),e.endWaypointLocation=r.stoppoints[s].getLocation(),r.addLegAndUpdateWaypoints(t[u].routeLegs[i],u),f.routeMode===o.transit&&rt(t[u].routeLegs[i].itineraryItems)}},r.addLegAndUpdateWaypoints=function(n,t){var v,l,s,u,f,h;r.summary||(r.summary=new Array(0)),r.summary[t]||(r.summary[t]={},r.summary[t].distance=0,r.summary[t].time=0,r.summary[t].timeWithTraffic=0),r.summary[t].distance+=n.summary.distance,r.summary[t].time+=n.summary.time,r.summary[t].timeWithTraffic+=n.summary.timeWithTraffic;for(var p=n.legKey.split("~"),c=0,i=0,i=0;i<r.stoppoints.length;i++){if(r.stoppoints[i]._uniqueId===parseInt(p[1])){r.routes[t].routeLegs.splice(c,0,n);break}r.stoppoints[i].isViapoint()||c++}for(v=0;i<r.stoppoints.length-1;i++){n.subLegs[v++].subLegKey=t+"~"+r.stoppoints[i]._uniqueId+"~"+r.stoppoints[i+1]._uniqueId;if(!r.stoppoints[i+1].isViapoint())break}for(l=n.subLegs[0].subLegKey.split("~")[1],s=r.getStoppointById(parseInt(l)),s.setOptions({location:new a(n.subLegs[0].actualStart.latitude,n.subLegs[0].actualStart.longitude)}),s._locationIdentifier=n.subLegs[0].startLocationIdentifier,i=0;i<n.subLegs.length;i++){var y=n.subLegs[i].subLegKey.split("~")[2],e=r.getStoppointById(parseInt(y)),o=e.getAddress();o&&(u=n.itineraryItems,u.length>0&&(f=u[u.length-1].formattedText,f=f.replace(new RegExp("<WaypointName>.*</WaypointName>","gi"),"<WaypointName>"+o+"</WaypointName>"),f=f.replace(new RegExp("<EndLocation>.*</EndLocation>","gi"),"<EndLocation>"+o+"</EndLocation>"),u[u.length-1].formattedText=f)),h={location:new a(n.subLegs[i].actualEnd.latitude,n.subLegs[i].actualEnd.longitude)},e.isViapoint()&&(h.address=n.subLegs[i].endDescription),e.setOptions(h),e._locationIdentifier=n.subLegs[i].endLocationIdentifier}d(t)},r.removeLeg=function(n){for(var f=parseInt(n.split("~")[0]),t,e,i=0;i<r.currentRouteLegs.length;i++){t=r.currentRouteLegs[i];if(t.legKey===n){r.summary[f].distance-=t.summary.distance,r.summary[f].time-=t.summary.time,r.summary[f].timeWithTraffic-=t.summary.timeWithTraffic,e=u.Helper.index_of(r.currentRouteLegs,t),e<0||r.currentRouteLegs.splice(e,1),d(f);break}}},r.persistResolvedWaypoint=function(n,t){var e={failed:!1,invalidCredentials:!1},u,f,i;if(n[bi]){u=n[bi][0];if(u&&u.length===t.length)for(f=0;f<r.stoppoints.length;f++)for(i=0;i<t.length;i++)r.stoppoints[f]._uniqueId===t[i]&&u[i]&&(u[i].failed?e.failed=!0:u[i].invalidCredentials?e.invalidCredentials=!0:r.stoppoints[f]._updateWaypoint(u[i]))}return e},r.validateAndUpdateWhatOnlyWaypointDisambiguation=function(){var u,t,e;if(!this.stoppoints.length)return;for(u=this.stoppoints[0],t=1;t<this.stoppoints.length;t++){var n=this.stoppoints[t],f=n.getDisambiguationResult(),i=f?f.dependentLocation:null,r=u.getLocation();f&&n._inputType===ru.whatOnly&&i&&(!r||i.latitude.toFixed(l)!==r.latitude.toFixed(l)||i.longitude.toFixed(l)!==r.longitude.toFixed(l))&&(e=n.getAddress(),n.clear(),n.setOptions({address:e})),u=n}},r._getPrefixId=function(){var n="";return f.itineraryContainer&&f.itineraryContainer.id?(n=f.itineraryContainer.id,f.singleton||(n+=e+"_")):n=r.ItineraryPrefixId,n},r._removeAllStoppoints=function(){while(r.stoppoints.length){var t=r.stoppoints[r.stoppoints.length-1];r.stoppoints.pop(t),n.invoke(r,"waypointRemoved",{waypoint:t})}p()},r.dispose=function(){p(),r._removeAllStoppoints(),f=null,y=null,r.inlineImagesCache=null}}function ii(s,c,v){function ei(){var t=!1,n;return typeof VEShell!="undefined"&&(n=VEShell.TaskHost.get_activeTask(),n&&(t=n._isPermalinkRequest&&!n._isBackButtonRequest)),t}function rr(t){var i=t.waypoint;d.push(n.addHandler(i,"changed",r(p,or))),d.push(n.addHandler(i,"reverseGeocoded",r(p,sr))),ci(i),n.invoke(it,"waypointAdded",{waypoint:i})}function hr(t){var i=t.waypoint;kt(i),n.invoke(it,"waypointRemoved",{waypoint:i}),i.dispose()}function or(n){var t=n.waypoint;tt&&!b&&(ut.clearRoute(null,!1),k&&(k._removePushpins(y.SteppinPrefixId),k._removePushpins(y.StoppointPinPrefixId),k._removePushpins(y.TransitStepPinPrefixId),k.createPushpins(y.getAllWaypoints())),tt._waypointChanged(t)),ci(t),rt!==-1&&y.isRoutableLatLongAvailableForAllStopPoints&&y.isRoutableLatLongAvailableForAllStopPoints()&&ui(y.stoppoints)}function ci(n){n._address&&!n._location&&y.getOptions().displayLandingPage?ri.resolveWaypoint(g,n,null,-1,null,p._permalinkHelper):!n._address&&n._location&&ri.reverseGeocode(g,n._location,r(p,li),r(p,li),n,p._permalinkHelper)}function li(n,t){var i="",u="",r;n&&(i=n.formattedAddress,u=n.shortFormattedAddress),i||(r=t.getLocation(),i=r.latitude.toFixed(l)+","+r.longitude.toFixed(l),u=i),t.setOptions({address:i,shortAddress:u}),t._reverseGeocoded()}function sr(n){var t=n.waypoint;b&&b.updateReverseGeocodedText(t),tt&&tt.updateReverseGeocodedText(t)}function et(t,i){var r=!1;return n.hasHandler(it,t)&&(n.invoke(it,t,i),r=i.handled),r}function er(n){et("mouseEnterStep",n)||(b&&b._onMouseEnterStepUnhandled(n),k&&y.getOptions().routeMode!==o.transit&&k.displayStepPushpin(n.location,n.stepNumber))}function bi(n){et("mouseLeaveStep",n)||(b&&b._onMouseLeaveStepUnhandled(n),k&&y.getOptions().routeMode!==o.transit&&k.hideStepPushpin())}function ur(n){!et("itineraryStepClicked",n)&&g&&(g.setView({center:n.location,zoom:16}),y.getOptions().routeMode!==o.transit&&k&&k.displayStepPushpin(n.location,n.stepNumber))}function fr(n){ct&&window.clearTimeout(ct),ct=window.setTimeout(r(p,function(){ct=null;if(!et("mouseEnterRouteSelector",n)&&g){ut.clearRoute(null,!1);var t=y.routes[n.routeIndex].routeLegs;ut.updateRouteOnMapControl(t,!0,!1),ut.updateRouteOnMapControl(y.currentRouteLegs,!0,!0),k&&k.createTransitStepPushpins&&k.createTransitStepPushpins(t)}}),ku)}function lr(n){if(ct){window.clearTimeout(ct),ct=null;return}if(!et("mouseLeaveRouteSelector",n)&&g){ut.clearRoute(null,!1),ut.updateRouteOnMapControl(y.currentRouteLegs,!1,!1);var t=y.currentRouteLegs;k&&k.createTransitStepPushpins&&k.createTransitStepPushpins(t)}}function wr(n){et("routeSelectorClicked",n)||(y.setOptions({routeIndex:n.routeIndex}),p._setViewPortForSelectedRoute(),typeof VEShell!="undefined"&&VEShell.Logging.get_instance().logSubmit(n.containerElement.id),ti())}function dr(t){b.createRouteSelectorItem&&!et("beforeRouteSelectorRender",t)&&b.createRouteSelectorItem(t.containerElement,t.routeLeg,t.routeIndex),delete t.handled,n.invoke(it,"afterRouteSelectorRender",t)}function gr(t){et("beforeStepRender",t)||b.createSingleItineraryStep(t.step,t.prevStep,t.stepIndex,t.routeLegIndex,t.containerElement,t.lastStep),delete t.handled,n.invoke(it,"afterStepRender",t)}function pr(t){!et("beforeWaypointRender",t)&&b._createNewWaypoint&&b._createNewWaypoint(t.waypoint,t.containerElement),delete t.handled,n.invoke(it,"afterWaypointRender",t)}function ar(t){et("beforeSummaryRender",t)||(b._directionsPanel.appendChild(t.containerElement),b.createRouteSummary(t.summary,t.routeLegIndex,t.containerElement)),delete t.handled,n.invoke(it,"afterSummaryRender",t)}function wt(i,u,f,e){if(!y.getOptions().displayLandingPage)return;yt(),ni(),tt?tt.dispose():(tt=new gi(g,k,p._permalinkHelper,y),d.push(n.addHandler(it,"beforeDisambiguationRender",tt._createWaypointDisambiguation)),d.push(n.addHandler(tt,"updateDirections",r(p,p.setDirections))),d.push(n.addHandler(tt,"optionsChanged",r(p,function(n){if(!n.clearResultsPage&&b)p.setDirections();else if(n.refreshLandingPage||b)n.clearResultsPage&&!n.refreshLandingPage?(yt(),vt(),tt.createLandingPushpins(),tt._setFocus()):wt(!0,!0,"");else return})))),i&&(vt(),tt.createLandingPushpins()),tt._createLandingPage(f,e),t._reRenderDirectionsPanel(y._getPrefixId()),n.invoke(it,"landingPageUpdated",{updateHistory:u}),window.setTimeout(tt._setFocus,100)}function vr(t){t.failed?(p._setViewPortForSelectedRoute(),p.setDirections()):(y.getViaCount()>0&&y.setOptions({avoidTraffic:!1}),y.setOptions({routeIndex:0}),p.setDirections()),n.invoke(it,"dragDropCompleted",{})}function yr(n){yi(n.cordinates)}function st(t,r){var s=y.getOptions(),u=s.routeMode,e,f;if(t===h.invalidCredentials)message=i.getString("L_InvalidCredentials_Text");else if(t===h.tooFar)message=i.getString("L_DirectionsTripLengthTooLong_Text"),u===o.walking?message=i.getString("L_WalkingDirectionsTripLengthTooLong_Text"):u===o.transit&&(message=i.getString("L_TransitTripLengthTooLong_Text"));else if(t===h.timeout||t===h.cacheMiss||t===h.searchServiceFailed||t===h.unknownError)message=i.getString("L_RouteErrorServerBusy_Text"),u===o.walking?message=i.getString("L_WalkingRouteErrorServerBusy_Text"):u===o.transit&&(message=i.getString("L_TransitRouteErrorServerBusy_Text"));else if(t!==h.success)switch(u){case o.driving:message=i.getString("L_DrivingDirectionNotAvailable_Text");break;case o.walking:message=i.getString("L_WalkingDirectionNotAvailable_Text");break;case o.transit:message=i.getString("L_TransitDirectionNotAvailable_Text")}t===h.waypointDisambiguation?message=i.getString("L_WaypointDisambiguationError_Text"):t===h.emptyWaypoint?message=i.getString("L_EmptyWaypointError_Text"):t===h.atleastTwoWaypointsRequired?message=i.getString("L_AtleastTwoWaypointsRequiredError_Text"):t===h.firstOrLastStoppointIsVia?message=i.getString("L_FirstOrLastStoppointIsViaError_Text"):t===h.exceedMaxWaypointLimit&&(message=i.getString("L_ExceedMaxWaypointLimitError_Text").replace("{0}",gt));if(u===o.transit)switch(t){case h.dataSourceNotFound:case h.cannotFindNearbyRoad:message=i.getString("L_TransitNotAvailableWarning_Text");break;case h.noSolution:message=i.getString("L_TransitDirectionNoSolution_Text");break;case h.exceedMaxWaypointLimit:message=i.getString("L_ExceedMaxTransitWaypointLimitError_Text");break;case h.noAvailableTransitTrip:message=i.getString("L_TransitDirectionNoAvailableTransitTrip_Text");break;case h.outOfTransitBounds:message=i.getString("L_TransitDirectionOutOfTransitBounds_Text");break;case h.transitStopsTooClose:case h.walkingBestAlternative:message=i.getString("L_TransitDirectionTooClose_Text")}message&&typeof gi!="undefined"&&wt(!0,!0,message,t),t!==h.success&&(e=!1,f={},t===h.waypointDisambiguation&&(e=pi(r),e?n.invoke(it,"disambiguationAdded",{waypoint:r,waypointIndex:y.getStoppointIndex(r._uniqueId)}):f.waypoint=r),e||(f.responseCode=t,f.message=message,n.invoke(it,"directionsError",f)))}function pi(t){var l=!1,h=y.getOptions(),f,s,i;if(h.autoDisplayDisambiguation&&t){var c=t.getDisambiguationContainer(),o=y._getPrefixId(),a=h.routeMode;c||(si.createDirectionPanel(h.itineraryContainer,o,a),c=u("#"+o+fi).element()),f={waypoint:t,containerElement:c},et("beforeDisambiguationRender",f)?l=f.handled:(lt||(lt=new tu(g,k,!0,!0,y,p._permalinkHelper),d.push(n.addHandler(lt,"selected",r(p,wi)))),s=f.containerElement,i=null,s&&(i=u("#"+o+"DisambiguationContainer").element(),i?i.innerHTML="":i=e(o+"DisambiguationContainer","MicrosoftMap dd_disambgContainer",s)),lt.addDisambiguationControl(i,t),l=!0)}return l}function wi(n){var i,t,r;et("disambiguationSuggestionSelected",n)||(i=n.waypoint,t=u("#"+y._getPrefixId()+"DisambiguationContainer").element(),t&&t.parentNode&&t.parentNode.removeChild(t),r=n.newWaypointOptions,i.clear(),i.setOptions(r),p.setDirections())}function ii(){var i=!0,t,n;if(y.getAllWaypoints().length<2)return st(h.atleastTwoWaypointsRequired),!1;for(t=y.stoppoints.length,n=0;n<t;n++)if(!y.stoppoints[n].getLocation()&&!y.stoppoints[n].getAddress())return st(h.emptyWaypoint,y.stoppoints[n]),!1;if(y.stoppoints[0].isViapoint()||y.stoppoints[t-1].isViapoint())return st(h.firstOrLastStoppointIsVia),!1;for(y.validateAndUpdateWhatOnlyWaypointDisambiguation(),count=y.stoppoints.length,n=0;n<count;n++)if(!y.stoppoints[n].getLocation()){if(y.stoppoints[n].getDisambiguationResult())return st(h.waypointDisambiguation,y.stoppoints[n]),!1;break}return!0}function nr(i,r){var a,u,s,c,e,o,f,l;t.toggleTaskProgressIndicator(!1,y._getPrefixId()),a=!0,u=h.success,r&&r.success&&i?(s=r.userData,c=s[0],y.removeModifiedLegs(c),e=y.persistResolvedWaypoint(i,s[1]),e.invalidCredentials?u=h.invalidCredentials:e.failed&&(u=h.searchServiceFailed),ii()&&(y.saveUserLocationEnabled&&DirectionsShell.DirectionShellUtility.storeAnonymousLocations(y.stoppoints),o=i.routeResults,o&&(f=o[0],f.routeResponseCode===h.success?(a=!1,y.addInlineImages(f.inlineImageCache),y.addRoutes(c,f.routes),y.updateRouteModeAndUnitBasedOnRouteResult(f),l=y.getOptions().routeIndex,(y.stoppoints.length>2||y.routes&&l>=y.routes.length)&&y.setOptions({routeIndex:0}),p._setViewPortForSelectedRoute(),ti(),dt.end("Directions Completed","setDirections"),n.invoke(it,"directionsUpdated",{routeSummary:y.summary,route:y.routes})):(u=f.routeResponseCode,f.invalidCredentials&&(u=h.invalidCredentials))))):u=r&&!r.success?h.timeout:h.unknownError,u!==h.success&&st(u),rt=-1}function ir(n,i){var r,u;t.toggleTaskProgressIndicator(!1,y._getPrefixId()),r=h.success,i&&i.success&&n?(u=n.TransitInfoByStopId&&n.TransitInfoByStopId[0],di(u)):r=i&&!i.success?h.timeout:h.unknownError,r!==h.success&&st(r),rt=-1}function ki(){p.setDirections()}function ni(){u("#"+y._getPrefixId()+tr).set_html("")}function di(n){function ut(n,t,i){for(var e=rt(t,i),u,f=0;f<r.childNodes.length;f++){u=r.childNodes[f];if(u.departure&&u.departure.getTime()>e.departure.getTime()){n.insertBefore(e,u);return}}n.appendChild(e)}function rt(n,i){var l=t._parseCustomDateTime(i.departure),o=f("tr"),r,s,h,c,v,a;return o.departure=l,r=f("td",null,null,o),c=n.AbbreviatedName,c.length>7?(s=e(null,null,r),h=e(null,"dd_schSubTitle",r),r.colSpan=2):(s=r,r.className="dd_schCell1",h=f("td",null,"dd_schSubTitle",o)),v=u(s).add_class("dd_stopTitle"),s.appendChild(document.createTextNode(n.AbbreviatedName)),h.appendChild(document.createTextNode(i.headsign)),t._isTransitTrainLineAgencyId(n.AgencyId)&&t._addTransitTrainLineLinkElements(h,"MSAF","dd_schTransitBuyTickets"),a=f("td",null,"dd_stopTime",o),a.appendChild(document.createTextNode(t._getFormattedTime(l))),o}function st(n){f("span",b+"MessageContainer","dd_messageContainer",r,n)}var b=y._getPrefixId(),r,it,et,k,w,s,v,o,c,a,d,l,nt;yt(),ni(),tt&&tt.dispose(),r=u("#"+b+tr).element(),it=y.getOptions().transitOptions.scheduleName||i.getString("L_TransitDefaultTitle_Text"),e(null,"dd_stopHeader",r).appendChild(document.createTextNode(it)),et=e(null,null,r),k=e(null,"dd_calendarContainer",r),iu(y,"ScheduleTime",k,null),u(t._addInputElement(b+"UpdateSchedule","button goButton",k,i.getString("L_TransitUpdateSchedule_Text"),"Submit","")).add_event("click",ki),w=e(null,"dd_schHeader",r),e(null,"dd_schHeaderRoutes",w).appendChild(document.createTextNode(i.getString("L_TransitScheduleRoutes_Text"))),e(null,"dd_schHeaderDeparts",w).appendChild(document.createTextNode(i.getString("L_TransitScheduleDeparts_Text")));var ft=f("table",null,null,r),ot=f("tbody",null,null,ft),p=h.success,g=!1;for(s=0;s<n.length;s++){v=n[s],p==h.success&&(p=v.responseCode),o=v.scheduleTimeInfo;if(o)for(c=0;c<o.length;c++)for(a=o[c],d=a.Line,l=0;l<a.Trips.length;l++)nt=a.Trips[l],g=!0,ut(ot,d,nt);o&&g||st(i.getString("L_TransitScheduleUnavailable_Text"))}return p}function ti(){g&&(dt.start("resultPage-Route"),ut.clearRoute(null,!1),ut._removeAllTemporaryRoutes(),ht&&n.invoke(it,"beforeRouteRender",{}),ut.updateRouteOnMapControl(y.currentRouteLegs,!1,!1),k&&k.createAllPushpins(y.currentRouteLegs,y.stoppoints),dt.end("Directions-route","resultPage-Route"));var i=y.getOptions();!ht&&i.itineraryContainer&&(dt.start("resultPage-itinerary"),typeof wt!="undefined"&&wt(!1,!1,""),yt(),ni(),b=pt.getNewResultsPage(g,k,p._permalinkHelper,y),d.push(n.addHandler(b,"updateDirections",r(p,p.setDirections))),d.push(n.addHandler(b,"mouseEnterStep",r(p,er))),d.push(n.addHandler(b,"mouseLeaveStep",r(p,bi))),d.push(n.addHandler(b,"itineraryStepClicked",r(p,ur))),d.push(n.addHandler(b,"beforeStepRender",r(p,gr))),d.push(n.addHandler(b,"beforeWaypointRender",r(p,pr))),d.push(n.addHandler(b,"beforeSummaryRender",r(p,ar))),d.push(n.addHandler(b,"beforeRouteSelectorRender",r(p,dr))),d.push(n.addHandler(b,"mouseEnterRouteSelector",r(p,fr))),d.push(n.addHandler(b,"mouseLeaveRouteSelector",r(p,lr))),d.push(n.addHandler(b,"routeSelectorClicked",r(p,wr))),d.push(n.addHandler(b,"setMapView",r(p,function(){p._setViewPortForSelectedRoute()}))),b.createResultsPage(),t._reRenderDirectionsPanel(y._getPrefixId()),dt.end("Directions-itinerary","resultPage-itinerary"),n.invoke(it,"itineraryUpdated",{}))}function ui(n){var u=y.getOptions(),t;if(u.autoUpdateMapView&&!(vi||ht)&&!ei()){var r=[],f=n.length,i=!0;for(t=0;t<f;t++)if(n[t]&&n[t].getLocation())r[t]=n[t].getLocation();else{i=!1;break}i&&yi(r)}}function yi(n){var e,o,h,t,i,u,r,f,s;if(!g)return;e=n.length;if(e)if(e===1)o=n[0],h={center:new a(o.latitude,o.longitude),zoom:cf},g.setView(h);else{for(t=n[0].clone(),i=new a(t.latitude,t.longitude),f=1;f<e;f++)u=n[f].latitude,r=n[f].longitude,t.latitude>u&&(t.latitude=u),t.longitude>r&&(t.longitude=r),i.latitude<u&&(i.latitude=u),i.longitude<r&&(i.longitude=r);y.updateBoundingBoxWithBuffer(i,t),s=hi.fromEdges(i.latitude,t.longitude,t.latitude,i.longitude),g.setView({bounds:s})}else return}function vt(){g&&(ut.clearRoute(null,!1),k&&k.removeAllPushpins())}function kt(t){var i=d.length;while(i--)t&&d[i].target===t&&(n.removeHandler(d[i]),d.pop(d[i])),t||n.removeHandler(d[i]);t||(d=[])}function yt(){b&&(b.dispose(),kt(b),b=null)}var p=this,it=c,y=new ot(v),g=s,at,ut,bt;p.options=null,p._eros=null;var tt=null,b=null,ct=null,lt=null;p._permalinkHelper=new oi(g,y);var rt=-1,d=[],k=null;g&&(typeof br!="undefined"&&(at=new br(g)),typeof ai!="undefined"&&(k=new ai(g,y,at),d.push(n.addHandler(k,"disambiguationPushpinsAdded",r(p,yr)))),ut=new vu(g,y),typeof kr!="undefined"&&(bt=new kr(k,ut,y,g,p._permalinkHelper,at),d.push(n.addHandler(bt,"dropCompleted",r(p,vr))))),d.push(n.addHandler(y,"waypointAdded",r(p,rr))),d.push(n.addHandler(y,"waypointRemoved",r(p,hr))),p.setDirections=function(){var s,o,i,e,u,f;nt.isRequestCompleted(rt)||nt.abortRequest(rt),u=y.getOptions(),ii()?(dt.start("setDirections"),p.clearDisplay(),f=y.getUnavailableRouteWaypointIndexes(),f.length>0&&y.stoppoints.length>=2?t.getCredentials(g,r(p,function(n){s=p._permalinkHelper.generateGetDirectionsLink(f,y.stoppoints,n),o=t.convertPermalinkDictionaryToPermalink(s),i=w.directionsService+o;var u=[];u[0]=f,u[1]=y.getAllStoppointIds(),e=r(p,nr),t.toggleTaskProgressIndicator(!0,y._getPrefixId()),rt=nt.getObjectAsync(i,e,u,cr,t.GetUniqueNetworkRequestId(i)),ui(y.stoppoints)})):(ti(),dt.end("Directions Completed-cache","setDirections"),n.invoke(it,"directionsUpdated",{routeSummary:y.summary,route:y.routes}))):u.transitOptions.showTransitStopSchedule&&u.transitOptions.showTransitStopSchedule.length?t.getCredentials(g,r(p,function(n){var f=u.transitOptions.showTransitStopSchedule;p.clearDisplay(),s=p._permalinkHelper.generateGetTransitScheduleLink(f,n),o=t.convertPermalinkDictionaryToPermalink(s),i=w.directionsService+o,e=r(p,ir),t.toggleTaskProgressIndicator(!0,y._getPrefixId()),rt=nt.getObjectAsync(i,e,null,cr,t.GetUniqueNetworkRequestId(i))})):tt||vt()},p._setViewPortForSelectedRoute=function(n){var r=y.getOptions(),t,i;g&&y.summary&&(r.autoUpdateMapView||n)&&!ei()&&(t=y.summary[r.routeIndex],t&&(i=hi.fromEdges(t.northEast.latitude,t.southWest.longitude,t.southWest.latitude,t.northEast.longitude),g.setView({bounds:i})))},p.clearDisplay=function(){vt(),yt()},p.resetDirections=function(n){p.clearDisplay(),y.resetDirectionState(n)},p.addWaypoint=function(n,t){if(n instanceof ft){var i=y.getOptions();(y.stoppoints.length<gt||i.routeMode===o.transit)&&(y.stoppoints.length<2||i.routeMode!==o.transit)?(y.addStoppoint(n,t),nt.isRequestCompleted(rt)||(nt.abortRequest(rt),p.setDirections())):st(h.exceedMaxWaypointLimit)}},p.removeWaypoint=function(n,t){var i=null;i=typeof n=="number"?y.getStoppointByIndex(n):n,i instanceof ft&&(nt.isRequestCompleted(rt)?y.removeStoppoint(i._uniqueId,t):(nt.abortRequest(rt),y.removeStoppoint(i._uniqueId,t),p.setDirections()))},p.setOptions=function(n,t){nt.isRequestCompleted(rt)?y.setOptions(n,t):(nt.abortRequest(rt),y.setOptions(n,t),p.setDirections())},p.setRenderOptions=function(n){p.setOptions(null,n)},p.setRequestOptions=function(n){p.setOptions(n,null)},p.getNearbyArterials=function(n,t,i,r){n instanceof a&&t&&ri.getNearbyArterialsResults(g,n,t,i,r,p._permalinkHelper)},p.reverseGeocode=function(n,t,i,r){n instanceof a&&t&&ri.reverseGeocode(g,n,t,i,r,p._permalinkHelper)},p._getState=function(){return y},p.dispose=function(){vt(),rt!=-1&&(nt.abortRequest(rt),rt=-1),lt&&(lt.dispose(),lt=null),b&&(b.dispose(),b=null),tt&&(tt.dispose(),tt=null),kt(null),g&&(at&&(at.dispose(),at=null),k&&k.dispose(),ut.dispose(),bt&&bt.dispose()),y&&(y.dispose(),y=null)}}function tu(o,s,h,c,l,v){function tt(o){var h=o.getDisambiguationResult(),a=h.locationSuggestions.length>0,ot=a?h.locationSuggestions.length:h.businessSuggestions.length,l,s,tt,et,k,ct,v,d;if(b){b.innerHTML="",lt&&(l="",l=vi?i.getString("L_DisambiguationGeneralMessageb2b_Text").replace("{0}",o.getAddress()):ht?o._uniqueId===g.stoppoints[0]._uniqueId?i.getString("L_DisambiguationMessageFromMbing_Text"):i.getString("L_DisambiguationMessageToMbing_Text"):i.getString("L_DisambiguationGeneralMessage_Text"),ot>1?f("span",p+"DisambiguationMessage2"+o._uniqueId,"headerText",b,l):ot>0?f("span",p+"DisambiguationMessage"+o._uniqueId,"headerText",b,l):f("span",p+"DisambiguationMessage"+o._uniqueId,"headerText",b,h.headerText));var it=e(p+"DisambiguationChoicesPanel"+o._uniqueId,"",b),pt=f("ul","","",it,""),c=0;for(h.businessSuggestions.length>0&&(c=h.businessSuggestions[0].index),s=0;s<ot;s++)tt=f("li",p+"DisambiguationAddress_"+o._uniqueId+"_"+s,"",pt,""),et="dd_DisambgStepLetter",s+1+c<10||(et+=" dd_TwoDigitsDisambgPushPin"),f("span",p+"DisambiguationPushpin_"+o._uniqueId+"_"+s,et,tt,(c+1+s).toString()),k=e(p+"DisambiguationAddressContainer"+o._uniqueId,a?"dd_LocDisambgAddressContainer":"dd_BizDisambgAddressContainer",tt),ct=t._addAnchorElementWithEncodeOption(p+"DisambiguationAddressLink"+o._uniqueId+s,"",k,a?h.locationSuggestions[s].formattedSuggestion:h.businessSuggestions[s].name,"",!1),u(ct).add_event("click",r(w,st),!1),a||(f("div","","",k,h.businessSuggestions[s].address),h.businessSuggestions[s].isApproximate&&f("div","","disambgLocationApprox",k,i.getString("L_ApproximateLocation_Text"))),v=u(tt),v.add_event("mouseenter",r(w,vt),!0).add_event("mouseleave",r(w,yt),!0),v.set_attr("WaypointUniqueId",o._uniqueId).set_attr("SuggestionsIndex",s.toString()),v.select("*").set_attr("WaypointUniqueId",o._uniqueId).set_attr("SuggestionsIndex",s.toString());h.businessSuggestions.length>0&&(c>0&&ut(!0,it,o._uniqueId,!1,c-su),h.hasMoreSuggestions&&(c>0&&f("span","","",it,"|"),ut(!1,it,o._uniqueId,!c,c+su)))}rt&&y&&y.createDisambiguationPushpin&&(y.removeDisambiguationPushpins(o),y.createDisambiguationPushpin(o),nt=n.addHandler(y,"selected",r(w,ft))),ii&&ii.makeDummyRequest&&(d={},d.query=o.getAddress(),d.queryType=a?"L":"B",ii.makeDummyRequest(at,!0,d))}function yt(n){it(n.target,!1)}function vt(n){it(n.target,!0)}function ut(n,t,f,e,o){var s=d(n?p+"DisambiguationPreviousLink":p+"dd_DisambgNextLink",n?"dd_DisambgPreviousLink":e?"dd_DisambgNextLinkFirstPage":"dd_DisambgNextLink",t,n?i.getString("L_Previous_Text"):i.getString("L_Next_Text"),"#");s.setAttribute("StartingIndex",o),s.setAttribute("WaypointUniqueId",f),u(s).add_event("click",r(w,ot),!1)}function it(n,t){var e=u(n),f=p+"DisambiguationPushpin",o=p+"DisambiguationAddress",i=e.get_attr("WaypointUniqueId"),r=parseInt(e.get_attr("SuggestionsIndex"));t?u("#"+f+"_"+i+"_"+r).add_class("dd_DisambgStepLetterHover"):u("#"+f+"_"+i+"_"+r).remove_class("dd_DisambgStepLetterHover"),y&&y.displayHoverPushpin(g.DisambiguationPinPrefixId+i+"_"+r,t)}function st(n){var i;n.preventDefault();var t=n.target,u="",r=-1;k(n.target.getAttribute("shapeId"))?(k(n.target.getAttribute("WaypointUniqueId"))&&(t=t.parentNode),u=t.getAttribute("WaypointUniqueId").toString(),r=t.getAttribute("SuggestionsIndex")):(i=t.getAttribute("shapeId").split("_"),u=i[1],r=parseInt(i[2])),ft({waypointId:parseInt(u),suggestionsIndex:parseInt(r)})}function ft(t){var e=t.suggestionsIndex,o=t.waypointId,f=null,u=g.getStoppointById(parseInt(o)),r,i;u&&(r=u.getDisambiguationResult(),r&&r.locationSuggestions&&r.locationSuggestions.length>0?(i=r.locationSuggestions[e],f={address:i.suggestion,location:new a(i.location.latitude,i.location.longitude),geoLocation:new a(i.location.latitude,i.location.longitude)}):(i=r.businessSuggestions[e],f={address:i.address,location:new a(i.location.latitude,i.location.longitude),geoLocation:new a(i.location.latitude,i.location.longitude),businessDetails:{website:i.website,phoneNumber:i.phoneNumber,businessName:i.name,entityId:i.entityId}})),y&&y.removeDisambiguationPushpins&&y.removeDisambiguationPushpins(u),n.invoke(w,"selected",{waypoint:u,newWaypointOptions:f})}function ot(n){n.preventDefault();var i=n.target.getAttribute("WaypointUniqueId"),u=g.getStoppointById(parseInt(i)),t=n.target.getAttribute("StartingIndex");t<0&&(t=0),ri.resolveWaypoint(ct,u,r(w,et),t,null,v)}function et(n){rt&&y&&y.removeDisambiguationPushpins&&y.removeDisambiguationPushpins(n),tt(n)}var w=this,nt,y=s,lt=h,rt=c,g=l,ct=o,at=v,p=g._getPrefixId(),b=null;w.addDisambiguationControl=function(n,t){b=n,tt(t)},w.dispose=function(){y&&y.removeDisambiguationPushpins&&y.removeDisambiguationPushpins(),n.removeHandler(nt),nt=null}}function ai(t,i,u){function l(n){var t=f._state.cloneOptions(f._state.getOptions().stepPushpinOptions);return t.id=f._state.SteppinPrefixId+n,t.visible=!0,t}function p(n){var r=f._state.stoppoints,u=!1,e=!1,t,i;return r&&r.length>1&&(u=r[r.length-1]._uniqueId===n._uniqueId,e=!u&&r[0]._uniqueId!==n._uniqueId),t=f._state.getOptions(),i=si.getDefaultWaypointOption(f._state,n),i.id=f._state.StoppointPinPrefixId+n._uniqueId,u&&t.lastWaypointIcon&&(i.icon=t.lastWaypointIcon),e&&t.middleWaypointIcon&&(i.icon=t.middleWaypointIcon),i}function w(n){var t=f._state.cloneOptions(f._state.getOptions().viapointPushpinOptions);return t.id=f._state.StoppointPinPrefixId+n._uniqueId,t}function b(n){var t=n.target;t.setOptions({icon:t._hoverIcon})}function k(n){var t=n.target;t.setOptions({icon:t._originalIcon})}function v(t){n.invoke(f,"drag",t)}function y(t){n.invoke(f,"drop",t)}function h(t){var r=e.length;while(r--){var i=e[r].target,i=i instanceof lt||i instanceof ei?i:i.getPushpin(),u=i._uniqueId?i._uniqueId:i.getId();t&&u.indexOf(t)!==0||(n.removeHandler(e[r]),e.pop(e[r]))}}var f=this,e,a,s;f._map=t,f._state=i,e=[],f._handlers=e,a=u,s=null,f.createAllPushpins=function(n,t){f.removeAllPushpins(),f.createPushpins(t),f._state.getOptions().routeMode===o.transit&&f.createTransitStepPushpins&&f.createTransitStepPushpins(n)},f.displayStepPushpin=function(n,t){if(s){s.setLocation(n);var i=l(t);s.setOptions(i)}else s=new lt(n,l(t)),f._map.entities.push(s)},f.hideStepPushpin=function(){s&&s.setOptions({visible:!1})},f.createPushpins=function(t){for(var u,l,p,i,o,h,s=0;s<t.length;s++){u=t[s];if(!u.getLocation())continue;l=f._state.StoppointPinPrefixId+u._uniqueId,p=f._getEntityById(l),p||(i=u.getPushpin(),i?i.setLocation(u.getLocation()):(o=f.getDefaultOptions(u),i=new lt(u.getLocation(),o),o.hoverIcon&&(i._hoverIcon=o.hoverIcon,f._attachHoverBehavior(i))),i._uniqueId=l,f._map.entities.push(i),c.WaypointDragging&&typeof ir!="undefined"&&i.getDraggable()&&typeof ir!="undefined"&&(h=new ir(i,f._map,a),e.push(n.addHandler(h,"drag",r(f,v))),e.push(n.addHandler(h,"drop",r(f,y)))))}},f.displayHoverPushpin=function(n,t){var i=f._getEntityById(n);i&&i.setOptions({icon:t?i._hoverIcon:i._originalIcon})},f.removeAllPushpins=function(){f._removePushpins("")},f._attachHoverBehavior=function(t){t._hoverIcon&&(t._originalIcon=t.getIcon(),e.push(n.addHandler(t,"mouseover",r(f,b))),e.push(n.addHandler(t,"mouseout",r(f,k))))},f._removePushpins=function(n){var e,u,i,r;for(h(n),e=f._map.entities,u=0;u<e.getLength();u++)i=e.get(u),i&&(i instanceof lt||i instanceof ei)&&(i.getId&&i.getId()||i._uniqueId)&&(r=i._uniqueId?i._uniqueId:i.getId(),(n&&r.indexOf(n)===0||!n&&(r.indexOf(f._state.SteppinPrefixId)===0||r.indexOf(f._state.StoppointPinPrefixId)===0||r.indexOf(f._state.DisambiguationPinPrefixId)===0||r.indexOf(f._state.TransitStepPinPrefixId)===0))&&(t.entities.remove(i),u--,r.indexOf(f._state.SteppinPrefixId)===0&&(s=null)))},f._isLightColorPopupRequired=function(){var n=!1,t=f._map.getImageryId();switch(t){case"Aerial":case"EnhancedBirdseye":case"NativeBirdseye":n=!0;break;default:n=!1}return n},f.getDefaultOptions=function(n){return n.isViapoint()?w(n):p(n)},f._getEntityById=function(n){for(var r=f._map.entities,u=r.getLength(),t,i=0;i<u;i++){t=r.get(i);if(t&&(t._uniqueId&&t._uniqueId===n||t.getId&&t.getId()===n))return t}return null},f.getPushpin=function(n){var t=f._state.StoppointPinPrefixId+n._uniqueId;return f._getEntityById(t)},f.dispose=function(){h(""),f._removePushpins(""),s=null}}function kr(u,f,e,s,c,l){function dt(t){var u=v.getOptions(),i;u.routeMode!==o.transit&&!t.tempararyPolyline&&u.routeDraggable&&(i=new bt(it,t.polyline,ft,v),y.push(n.addHandler(i,"dragMove",r(b,ii))),y.push(n.addHandler(i,"dragEnd",r(b,ti))))}function kt(t){var i=y.length,r,u;while(i--)y[i]instanceof bt&&(r=y[i].target,u=r.getPolyline(),t.polyline.getId()===u.getId()&&(n.removeHandler(y[i]),y.pop(y[i]),r.dispose()))}function ni(n){if(v.getOptions().routeMode===o.transit||!v.routes||v.routes.length===0){d=!0;return}var t=parseInt(n.id),u=v.getPreviousStopPoint(t),r=v.getNextStoppoint(t),i=v.getStoppointById(t);et(n.location,i,u,r)}function ri(n){var i=parseInt(n.id),t=v.getStoppointById(i),u,r;(!v.routes||v.routes.length===0)&&t?(t.clear(),t.setOptions({location:n.location})):(u=v.getPreviousStopPoint(i),r=v.getNextStoppoint(i),ot(n.location,t,u,r))}function ii(n){var u=n.location,f=n.polyline,e=f.getId().split("_")[1],t=e.split("~"),r=v.getStoppointById(parseInt(t[1])),i=v.getStoppointById(parseInt(t[2]));et(u,null,r,i)}function ti(n){var u=n.location,f=n.polyline,e=f.getId().split("_")[1],t=e.split("~"),r=v.getStoppointById(parseInt(t[1])),i=v.getStoppointById(parseInt(t[2]));ot(u,null,r,i)}function et(n,i,u,f){var o,e;d||(rt=0);if(dr>0&&rt>=dr)return;o=k(i);if(!d){if(o&&v.getViapointCountInLeg(u)>=ou)return;ut=null}++rt,d=!0,e=[],e[0]=pt(i,u,f,o),e[1]=++gt,e[2]=n,e[3]=i&&v.stoppoints[0]._uniqueId===i._uniqueId,e[4]=o,t.getCredentials(it,r(b,function(o){var c=st.generateDragAndDropStopPointLink(i,u,f,n,!0,null,o),l=t.convertPermalinkDictionaryToPermalink(c),s=w.directionsService+l,h=r(b,at);nt.getObjectAsync(s,h,e,-1,t.GetUniqueNetworkRequestId(s))}))}function at(n,t){var f,y,et,st,ot,l,w,c,tt,r,i,a,h,s,e,ft;--rt,f=t.userData,y=f[1];if(y<lt)return;lt=y;if(d&&t&&t.success&&n){l=f[0];if(!k(n.subLegs)){w=n.subLegs[0],c=w.length,ut=f[2];var ht=f[4],b=[],u=[],ct=!ht||c===1?c:c-1,nt=v.getOptions();for(i=0;i<l.length;i++)i<ct?b[b.length]=l[i]:u[u.length]=l[i];for(g.clearRoute(b,!0),tt=v.cloneOptions(nt.routeMode===o.walking?nt.walkingPolylineOptions:nt.drivingPolylineOptions),i=0;i<c;i++)r=w[i],p.decodeRoute(r.routePath,!0),r.routePath.decodedRegions=wt(r.routePath.decodedLatitudes.length),r.routePath.zoomLevels=it.getZoom().toString(),e=y+"_"+i,ft=g.addPolyline(e,r.routePath,tt,!0,null,e);for(et=u.length,i=0;i<et;i++){if(g._displayedRoutes[u[i]])continue;for(st=v.currentRouteLegs.length,a=0;a<st;a++)for(h=v.currentRouteLegs[a],ot=h.subLegs.length,s=0;s<ot;s++){e=h.subLegs[s].subLegKey;if(e!==u[i])continue;ft=g.addPolyline(u[i],h.subLegs[s].routePath,tt,!1,h.legKey,e)}}yt(w,f[3])}}}function yt(n,r){for(var o=0,h=0,y=r?n[0].startDescription:n[0].endDescription,a,c=v.currentRouteLegs.length,s,e,f,l,u=0;u<c;u++)for(s=v.currentRouteLegs[u],a=s.subLegs.length,e=0;e<a;e++)f=s.subLegs[e],g._displayedRoutes[f.subLegKey]&&f.summary&&(o+=f.summary.distance,h+=f.summary.time);for(c=n.length,u=0;u<c;u++){if(u>=2)break;k(n[u].summary)||(o+=n[u].summary.distance,h+=n[u].summary.time)}l=i.getString("L_DragSummaryToolTip_Text").replace("{0}",y).replace("{1}",o.toFixed(1)).replace("{2}",v.getOptions().distanceUnit===tt.miles?i.getString("L_DistanceUnitMilesShortText_Text"):i.getString("L_DistanceUnitKm_Text")).replace("{3}",t._getDurationFormattedTime(h)),ft.setToolTip(l)}function ot(n,i,u,f){ft.setVisibility(!1);if(!d)return;d=!1;if(!i&&v.getViapointCountInLeg(u)>=ou)return;var l=!i||i.isViapoint(),s=null,h=null;l?(s=u.isViapoint()?v.getPreviousWaypoint(u._uniqueId):u,h=f.isViapoint()?v.getNextWaypoint(f._uniqueId):f):(s=v.getPreviousWaypoint(i._uniqueId),h=v.getNextWaypoint(i._uniqueId));var o=[],e=[],c=v.getOptions();!i||i.isViapoint()?e[e.length]=c.routeIndex+"~"+s._uniqueId+"~"+h._uniqueId:(s&&(e[e.length]=c.routeIndex+"~"+s._uniqueId+"~"+i._uniqueId),h&&(e[e.length]=c.routeIndex+"~"+i._uniqueId+"~"+h._uniqueId)),o[0]=e,o[1]=n,o[2]=i?i._uniqueId:"",u&&(o[3]=u._uniqueId),o[4]=++ct,t.toggleTaskProgressIndicator(!0,v._getPrefixId()),!l&&i&&n&&(i._geoLocation=new a(n.latitude,n.longitude)),t.getCredentials(it,r(b,function(e){var c=st.generateDragAndDropStopPointLink(i,u,f,n,!1,ut,e),l=t.convertPermalinkDictionaryToPermalink(c),s=w.directionsService+l,h=r(b,vt);nt.getObjectAsync(s,h,o,cr,t.GetUniqueNetworkRequestId(s))}))}function vt(i,r){var l=r.userData,it=l[4],f,c,y,s,tt,e,u,g,p,k;if(it<ct||d)return;t.toggleTaskProgressIndicator(!1,v._getPrefixId());if(r&&r.success&&i){var b=l[0],w=l[1],nt=i.routeResults;if(nt){f=nt[0];if(f.routeResponseCode===h.success){c=l[2];if(v.getOptions().routeMode===o.transit){c&&(s=v.getStoppointById(c),s.clear(),s._geoLocation=new a(w.latitude,w.longitude)),v.addInlineImages(f.inlineImageCache),v.addRoutes(null,f.routes),v.setOptions({routeIndex:0}),n.invoke(this,"dropCompleted",{failed:!1});return}if(f.routes[0].routeLegs.length!==b.length){n.invoke(this,"dropCompleted",{failed:!0});return}for(y=b.length,u=0;u<y;u++)v.removeLeg(b[u]);for(c?(s=v.getStoppointById(c),s.clear(),s._geoLocation=new a(w.latitude,w.longitude)):typeof v.addNewViapoint!="undefined"&&v.addNewViapoint(l[3]),y=f.routes.length,e=0;e<y;e++)for(tt=f.routes[e].routeLegs.length,u=0;u<tt;u++)g=b[u],p=f.routes[e].routeLegs[u],p.legKey=g,k=g.split("~"),p.startWaypointLocation=v.getStoppointById(parseInt(k[1])).getLocation(),p.endWaypointLocation=v.getStoppointById(parseInt(k[2])).getLocation(),v.addLegAndUpdateWaypoints(f.routes[e].routeLegs[u],e)}}n.invoke(this,"dropCompleted",{failed:!1})}else r&&!r.success?n.invoke(this,"dropCompleted",{failed:!0}):n.invoke(this,"dropCompleted",{failed:!0})}function pt(n,t,i,r){var a=r||n.isViapoint(),e=null,s,f;e=a?i.isViapoint()?v.getNextWaypoint(i._uniqueId):i:v.getNextWaypoint(n._uniqueId);for(var o=[],c=k(t)?n._uniqueId:t._uniqueId,l=k(e)?n._uniqueId:e._uniqueId,h=c,u=0;u<v.stoppoints.length;u++){f=v.stoppoints[u];if(f._uniqueId===c)break}for(s=v.getOptions(),u=u+1;u<v.stoppoints.length;u++){f=v.stoppoints[u],o[o.length]=s.routeIndex+"~"+h+"~"+f._uniqueId,h=f._uniqueId;if(f._uniqueId===l)break}return o}function wt(n){var u=[],i=[],r=new ci(it.getBounds(),null,null),t;for(r.indexes=new Array(n),t=0;t<n;t++)r.indexes[t]=t;return i[i.length]=r,u[u.length]=i,u}var b=this,it=s,v=e,ht=u,g=f,st=c,y=[],d=!1,gt=0,ct=0,lt=0,rt=0,ut=null,ft=l;y.push(n.addHandler(ht,"drag",r(b,ni))),y.push(n.addHandler(ht,"drop",r(b,ri))),y.push(n.addHandler(g,"polylineAdded",r(b,dt))),y.push(n.addHandler(g,"polylineRemoved",r(b,kt))),b.dispose=function(){var t=y.length;while(t--)n.removeHandler(y[t]);y=[]}}function br(n){function u(){if(i){var n={visible:!1,offset:new it(pr,pr*-1),htmlContent:""};t=new ei(i.getCenter(),n),i.entities.push(t)}}var r=this,i=n,t=null;u(),r.setLocation=function(n){t.setLocation(n)},r.setVisibility=function(n){t.setOptions({visible:n})},r.setToolTip=function(n){t.setOptions({htmlContent:'<div id="MicrosoftMapsDragToolTip" class="dd_DirectionsDragToolTip">'+n+"</div>"}),r.setVisibility(!0)},r.dispose=function(){i&&i.entities.remove(t)}}function ir(t,u,f){function d(){a=!0,e.push(n.addThrottledHandler(c,"mousemove",r(s,b),100)),p=c.getWidth(),y=c.getHeight()}function nt(n){if(a){var t=n.entity;w(!0),v.setLocation(t.getLocation())}}function tt(t){var i,r;a=!1,i=e.length;while(i--)if(e[i].eventName==="mousemove"){n.removeHandler(e[i]),e.pop(e[i]);break}r=t.entity,w(!1)}function rt(n){if(n){var t=n.target;v.setLocation(t.getLocation()),v.setToolTip(i.getString("L_DragToolTip_Text"))}}function g(){a||v.setVisibility(!1)}function b(n){if(a){var u=n.getX()+p/2,f=n.getY()+y/2,t=0,i=0;u<50?t=Math.min(50-u,25):u>p-50&&(t=Math.max(p-50-u,-25)),f<50?i=Math.min(50-f,25):f>y-50&&(i=Math.max(y-50-f,-25)),t||i?(l=new it(t,i),h===-1&&(h=window.setInterval(r(s,k),250))):(l=new it(0,0),window.clearInterval(h),h=-1)}}function k(){var n,i,t;a&&(l.x||l.y)?(n=c.tryLocationToPixel(o.getLocation()),n&&(i=c.tryPixelToLocation(new it(n.x-l.x,n.y-l.y)),o.setLocation(i),t={center:c.getCenter(),centerOffset:l,animate:!1},c.setView(t),w(!0))):h!==-1&&(window.clearInterval(h),h=-1)}function w(i){var u=o._uniqueId?o._uniqueId:o.getId(),r={id:u.split("_")[1],location:t.getLocation()};i?n.invoke(s,"drag",r):n.invoke(s,"drop",r)}var s=this,o=t,c=u,a=!1,p,y,l,h,e=[],v=f;e.push(n.addHandler(o,"dragstart",r(s,d))),e.push(n.addThrottledHandler(o,"drag",r(s,nt),250)),e.push(n.addHandler(o,"dragend",r(s,tt))),e.push(n.addHandler(o,"mouseover",r(s,rt))),e.push(n.addHandler(o,"mouseout",r(s,g))),s.getPushpin=function(){return o},s.dispose=function(){var t=e.length;while(t--)n.removeHandler(e[t]);e=[],h!==-1&&(window.clearInterval(h),h=-1)}}function at(n,t,i,r){cc_sb_ie?n.attachEvent("on"+t,i):n.addEventListener(t,i,r)}function cu(n){return cc_sb_ie?event.srcElement:n.target}function au(n){cc_sb_ie?event.returnValue=!1:n.preventDefault()}function er(n){cc_sb_ie?n.cancelBubble=!0:n.stopPropagation()}function nr(){}function lf(t){function f(t){t.preventDefault();var i=t.target.getAttribute("mode").toString();if(i===o.transit&&r.stoppoints.length>2||i===r.getOptions().routeMode)return;r.setOptions({routeMode:i}),r.saveSessionRouteMode(),typeof VEShell!="undefined"&&t.currentTarget&&VEShell.Logging.get_instance().logSubmit(t.currentTarget.id),n.invoke(h,"modeChanged",{mode:i})}var h=this,r=t,s=t._getPrefixId()+di;h.createModeSwitchingIcons=function(n){var v=0,w=null,y=r.getOptions(),a=e("","modeSwitchInnerContainer",w),h,t,l;c.DrivingDirectionsEnabled&&(h=d(s+"SwitchToCar","modeSwitch "+(y.routeMode===o.driving?"carModeSwitchSelected":"carModeSwitch"),a,"","#"),h.title=i.getString("L_CarModeToolTip_Text"),h.setAttribute("mode",o.driving),u(h).add_event("click",f),v++);if(c.TransitDirectionsEnabled){var p="transitModeSwitch",g="transitModeSwitchDisabled",k="transitModeSwitchSelected",nt=i.getString("L_TransitModeToolTip_Text");if(b==="en-gb")var p="tubeModeSwitch",g="tubeModeSwitchDisabled",k="tubeModeSwitchSelected",nt=i.getString("L_TubeModeToolTip_Text");t=d(s+"SwitchToTransit","modeSwitch "+p,a,"","#"),r.stoppoints.length>2?u(t).swap_class(p,g):y.routeMode===o.transit&&u(t).swap_class(p,k),t.title=nt,t.setAttribute("mode",o.transit),u(t).add_event("click",f),v++}c.WalkingDirectionsEnabled&&(l=d(s+"SwitchToWalking","modeSwitch "+(y.routeMode===o.walking?"walkingModeSwitchSelected":"walkingModeSwitch"),a,"","#"),l.title=i.getString("L_WalkingModeToolTip_Text"),l.setAttribute("mode",o.walking),u(l).add_event("click",f),v++),v<1||n.appendChild(a),r.saveSessionRouteMode()},h.dispose=function(){u("#"+s+"SwitchToCar").remove_event("click",f),u("#"+s+"SwitchToTransit").remove_event("click",f),u("#"+s+"SwitchToWalking").remove_event("click",f)}}function sf(h){function p(n){var r=y("hourInput"),i=y("minuteInput"),t=y("amPmSwitch");r&&(r.disabled=n),i&&(i.disabled=n),t&&(t.disabled=n)}function rt(t){var r=l.getOptions().transitOptions,i=null;t.selectedIndex?t.selectedIndex===1?(p(!1),i=et.arrival):t.selectedIndex===2&&(p(!0),i=et.lastAvailable):(p(!1),i=et.departure),i&&r.timeType!==i&&l.setOptions({transitOptions:{timeType:i}}),n.invoke(v,"optionsChanged",{updateDirections:!1})}function it(){n.invoke(v,"optionsChanged",{updateDirections:!1})}function ft(n){var s=e(a+"WalkingOptionsDiv","collapsibleRouteOptions routeOptionsContainer",n),o=f("fieldset","","routeOptions",s,""),u=t._addCheckBox(a+"RoundTrip",o,i.getString("L_DirectionsMenuRoundtrip_Text"),!1,r(v,w));v.addCollapsibleHeader(null,i.getString("L_RouteOptions_Text"),u,!1)}function ut(n){var o=l.getOptions(),y=e(a+"CarOptionsDiv","",n),u=f("fieldset","","routeOptions",y,""),h=(o.routeAvoidance&s.avoidLimitedAccessHighway)===s.avoidLimitedAccessHighway||(o.routeAvoidance&s.minimizeLimitedAccessHighway)===s.minimizeLimitedAccessHighway,c=i.getString("L_AvoidHighways_Text");b==="en-gb"&&(c=i.getString("L_AvoidMotorways_Text")),t._addCheckBox(a+"AvoidHighways",u,c,h,r(v,k)),h=(o.routeAvoidance&s.avoidToll)===s.avoidToll||(o.routeAvoidance&s.minimizeToll)===s.minimizeToll,t._addCheckBox(a+"AvoidTolls",u,i.getString("L_AvoidTolls_Text"),h,r(v,tt)),t._addCheckBox(a+"RoundTrip",u,i.getString("L_DirectionsMenuRoundtrip_Text"),!1,r(v,w)),v.addCollapsibleHeader(null,i.getString("L_RouteOptions_Text"),u,!1)}function w(t){var u=t.target,f,i,r,e;!u.checked&&l.stoppoints.length>2&&(f=l.stoppoints[l.stoppoints.length-1],l.removeStoppoint(f._uniqueId,!0)),i=l.getAllWaypoints(),r=l.getOptions().routeMode===o.transit?lr:gt,u.checked&&i.length<r&&(e=l.addRoundTripWapoint()),n.invoke(v,"optionsChanged",{updateDirections:!0})}function k(t){var r=t.target,i=l.getOptions().routeAvoidance;(i&s.avoidLimitedAccessHighway)===s.avoidLimitedAccessHighway&&(i=i-s.avoidLimitedAccessHighway),(i&s.minimizeLimitedAccessHighway)===s.minimizeLimitedAccessHighway&&(i=i-s.minimizeLimitedAccessHighway),r.checked&&(i=i|s.avoidLimitedAccessHighway),l.setOptions({routeAvoidance:i}),n.invoke(v,"optionsChanged",{updateDirections:!0})}function tt(t){var r=t.target,i=l.getOptions().routeAvoidance;(i&s.avoidToll)===s.avoidToll&&(i=i-s.avoidToll),(i&s.minimizeToll)===s.minimizeToll&&(i=i-s.minimizeToll),r.checked&&(i=i|s.avoidToll),l.setOptions({routeAvoidance:i}),n.invoke(v,"optionsChanged",{updateDirections:!0})}function nt(o){var ft=l.getOptions().transitOptions,at=null,tt=f("fieldset",a+"TransitCollapsible","routeOptions",o,""),lt=e("","optionPickerContainer",tt),y=f("select",a+"TransitDepartArrive","transitDateTimeBox transitDepartArrive",lt,""),h,ht,nt,ot,k,d,w,b;f("option","","departArriveOption",y,i.getString("L_TransitOptionDepartAt_Text")),f("option","","departArriveOption",y,i.getString("L_TransitOptionArriveBy_Text")),c.LastTrainOption&&f("option","","lastTrainOption",y,i.getString("L_TransitOptionLastTrain_Text")),ft.timeType===et.arrival?y.selectedIndex=1:ft.timeType===et.departure?y.selectedIndex=0:ft.timeType===et.lastAvailable&&(y.selectedIndex=2),u(y).add_event("change",r(v,function(){rt(y)})),iu(l,"TransitDate",tt,it);if(c.TransitAdvancedOptions){var p=l.getOptions(),ut=e(a+"TransitAdvancedOptionsContainer","transitAdvancedOptionsContainer",tt),ct=e(a+"TransitSortByDiv","",ut);f("span",a+"TransitSortByLabel","transitAdvancedOptionsLabel",ct,i.getString("L_TransitSortByLabel_Text")),h=f("select",a+"TransitSortBy","transitSortBySelectBox",ct,""),f("option","","",h,i.getString("L_TransitSortByOptionMinimizeTime_Text")),f("option","","",h,i.getString("L_TransitSortByOptionMinimizeMoney_Text")),f("option","","",h,i.getString("L_TransitSortByOptionMinimizeTransfers_Text"));switch(p.routeOptimization){case st.shortestTime:h.selectedIndex=0;break;case st.minimizeMoney:h.selectedIndex=1;break;case st.minimizeTransfers:h.selectedIndex=2}u(h).add_event("change",r(v,function(){var i=l.getOptions().routeOptimization;switch(h.selectedIndex){case 0:i=st.shortestTime;break;case 1:i=st.minimizeMoney;break;case 2:i=st.minimizeTransfers}l.setOptions({routeOptimization:i}),n.invoke(v,"optionsChanged",{updateDirections:!0})})),ht=e(a+"ExcludeAirLineDiv","",ut),nt=t._addInputElement(a+"ExcludeAirLine","",ht,"","checkbox",""),f("label",a+"AirLineLabel","",ht,i.getString("L_TransitExcludeAirLineLabel_Text")),nt.checked=p.routeAvoidance&s.avoidAirline,nt.setAttribute("defaultChecked",nt.checked),ot=e(a+"ExcludeExpressDiv","",ut),k=t._addInputElement(a+"ExcludeExpressTrain","",ot,"","checkbox",""),f("label",a+"ExpressLabel","",ot,i.getString("L_TransitExcludeExpressLabel_Text")),k.checked=p.routeAvoidance&s.avoidExpressTrain,k.setAttribute("defaultChecked",k.checked),d=e(a+"BulletTrainDiv","transitBulletTrainDiv",ut),w=t._addInputElement(a+"IncludeBulletTrainRadio","",d,"fewestTime","radio","bulletTrainRadio"),f("label",a+"IncludeBulletTrainLabel","",d,i.getString("L_TransitIncludeBulletTrain_Text")),w.checked=!(p.routeAvoidance&s.avoidBulletTrain),w.setAttribute("defaultChecked",w.checked),w.disabled=p.routeAvoidance&s.avoidExpressTrain,b=t._addInputElement(a+"ExcludeBulletTrainRadio","",d,"fewestTransfer","radio","bulletTrainRadio"),f("label",a+"ExcludeBulletTrainLabel","",d,i.getString("L_TransitExcludeBulletTrain_Text")),b.checked=p.routeAvoidance&s.avoidBulletTrain,b.setAttribute("defaultChecked",b.checked),b.disabled=p.routeAvoidance&s.avoidExpressTrain,g(nt,k,w,b)}v.addCollapsibleHeader(at,"",tt,!1)}function g(t,i,f,e){u(t).add_event("click",r(v,function(){var r=l.getOptions().routeAvoidance;(r&s.avoidAirline)===s.avoidAirline&&(r=r-s.avoidAirline),t.checked&&(r=r|s.avoidAirline),l.setOptions({routeAvoidance:r}),n.invoke(v,"optionsChanged",{updateDirections:!0})})),u(i).add_event("click",r(v,function(){var r=l.getOptions().routeAvoidance;(r&s.avoidExpressTrain)===s.avoidExpressTrain&&(r=r-s.avoidExpressTrain),i.checked?(r=r|s.avoidExpressTrain,f.disabled=!0,e.disabled=!0):(f.disabled=!1,e.disabled=!1),l.setOptions({routeAvoidance:r}),n.invoke(v,"optionsChanged",{updateDirections:!0})})),u(f).add_event("click",r(v,function(){var i=l.getOptions().routeAvoidance;(i&s.avoidBulletTrain)===s.avoidBulletTrain&&(i=i-s.avoidBulletTrain),l.setOptions({routeAvoidance:i}),n.invoke(v,"optionsChanged",{updateDirections:!0})})),u(e).add_event("click",r(v,function(){var i=l.getOptions().routeAvoidance;(i&s.avoidBulletTrain)!==s.avoidBulletTrain&&(i=i|s.avoidBulletTrain),l.setOptions({routeAvoidance:i}),n.invoke(v,"optionsChanged",{updateDirections:!0})}))}var v=this,l=h,a=l._getPrefixId();v.showRouteOptionsForCurrentMode=function(n,t){var r=y(a+"optionsContainer"),i=e(a+"optionsContainer","optionsContainer",null);r?(r.parentNode.removeChild(r),n.insertBefore(i,y(a+"RouteSettingsDiv"))):n.appendChild(i);switch(l.getOptions().routeMode){case o.driving:case null:ut(i);break;case o.transit:nt(t);break;case o.walking:ft(i)}return i},v.addCollapsibleHeader=function(n,r,f,o){var s,h,a,c;o?(s=l.getOptions(),h=s.routeMode,s.OptionsControlExpandedState=s.OptionsControlExpandedState||{},s.OptionsControlExpandedState[h]==="undefined"&&(s.OptionsControlExpandedState[h]=!1),n||(n=e("","directionsSettingExpanderClosed routeOptionsHeader",null),a=d("optionsHeader","",n,r,"#"),u(a).add_event("click",function(n){n.preventDefault()})),f.parentNode.insertBefore(n,f),t.toggleInline(u(f)),c=function(){var e=u(n),o=y("optionsHeader");e.has_class("directionsSettingExpanderClosed")?(e.swap_class("directionsSettingExpanderClosed","directionsSettingExpanderOpen"),o.innerHTML=t.htmlEncode(i.getString("L_HideOptions_Text"))):(e.swap_class("directionsSettingExpanderOpen","directionsSettingExpanderClosed"),o.innerHTML=t.htmlEncode(i.getString("L_ShowOptions_Text"))),t.toggleInline(u(f))},u(n).add_event("click",function(){c(),s.OptionsControlExpandedState[h]=!s.OptionsControlExpandedState[h]}),s.OptionsControlExpandedState[h]&&c()):u(f).set_attr("display","block")},v.dispose=function(){}}var i=Microsoft.Maps.Resources,vi=!1,ht=!1,v=window.Microsoft.Maps,hu,o,tt,s,st,et,ru,c,yt,kt,li,h,ut,fr,ci,t,d,f,e,k,ti,y,r,si,pt,ct,ri,p,ui,wt,wf,bt,gi,rr;v.Directions=v.Directions||{},DirectionPublicNamespace=v.Directions;var u=v.Gimme,w=v.Globals,it=v.Point,n=v.Events,hi=v.LocationRect,a=v.Location,pi=v.Color,lt=v.Pushpin,ei=v.Infobox,hf=v.Polyline,vt=v.InternalNamespaceForDelay;vt.Directions=vt.Directions||{};var fu=vt.Directions,nt=vt.Network,te=vt.Size,dt=vt.PRF,ni=vt.Quirks,gt=w.directionsMaxWaypoints||25,b=ni.useXHR?Windows.ApplicationModel.Resources.Core.ResourceManager.current.defaultContext.languages[0].toLowerCase():w.locale.toLowerCase();typeof hu=="undefined"&&(hu={}),o={driving:"driving",transit:"transit",walking:"walking"},v.Directions=v.Directions||{},v.Directions.RouteMode=o,tt={kilometers:0,miles:1},v.Directions=v.Directions||{},v.Directions.DistanceUnit=tt,s={none:0,minimizeLimitedAccessHighway:1,minimizeToll:2,avoidLimitedAccessHighway:4,avoidToll:8,avoidExpressTrain:16,avoidAirline:32,avoidBulletTrain:64},v.Directions=v.Directions||{},v.Directions.RouteAvoidance=s,st={shortestTime:0,shortestDistance:1,minimizeMoney:2,minimizeTransfers:3,minimizeWalking:4},v.Directions=v.Directions||{},v.Directions.RouteOptimization=st,et={departure:"departure",arrival:"arrival",lastAvailable:"lastAvailable"},v.Directions=v.Directions||{},v.Directions.TimeType=et,ru={unknown:0,whereOnly:1,whatAndWhere:2,whatOnly:3},c={WaypointDragging:!0,DefaultMode:o.driving,DistanceUnitMiles:!1,DrivingDirectionsEnabled:!0,WalkingDirectionsEnabled:!0,TransitDirectionsEnabled:!1,TrafficAwareDirections:!1,LastTrainOption:!1,TransitAdvancedOptions:!1,TransitTimeUse12Hour:!1,TransitShowRouteCost:!1,TransitShowDistanceUnitSetting:!0,TransitDateFormat:"m/d/yyyy",RadixPointDecimal:!0},b==="ja-jp"&&(c.DrivingDirectionsEnabled=!1,c.WalkingDirectionsEnabled=!1,c.TransitDirectionsEnabled=!0,c.TrafficAwareDirections=!1,c.LastTrainOption=!0,c.TransitAdvancedOptions=!0,c.TransitShowRouteCost=!0,c.TransitShowDistanceUnitSetting=!1,c.WaypointDragging=!1,c.DefaultMode=o.transit,c.DistanceUnitMiles=!0,c.TransitDateFormat="yyyy/m/d"),b==="en-ca"&&(c.TransitDirectionsEnabled=!0),b==="en-us"&&(c.TransitDirectionsEnabled=!0,c.TrafficAwareDirections=!0,c.DistanceUnitMiles=!0),b==="fr-ca"&&(c.TrafficAwareDirections=!0),b==="en-gb"&&(c.TransitDirectionsEnabled=!0,c.TrafficAwareDirections=!0,c.DistanceUnitMiles=!0,c.TransitDateFormat="d/m/yyyy"),yt=b.substring(0,2),(yt==="fr"||yt==="de"||yt==="es"||yt==="it"||yt==="pt"||yt==="nb"||yt==="nl"||yt==="sv")&&(c.RadixPointDecimal=!1),kt=b.substring(3),(kt==="us"||kt==="in"||kt==="au"||kt==="ca"||kt==="es")&&(c.TransitTimeUse12Hour=!0),(kt==="in"||kt==="fr")&&(c.TransitDateFormat="d-m-yyyy"),DirectionPublicNamespace.DirectionsManager=wr,directionsManagerPrototype=DirectionPublicNamespace.DirectionsManager.prototype,directionsManagerPrototype._getTask=function(){return this._task||(this._task=new ii(this._map,this,this._sessionState)),this._task},directionsManagerPrototype.calculateDirections=function(){this._getTask().setDirections()},directionsManagerPrototype.setMapView=function(){this._getTask()._setViewPortForSelectedRoute(!0)},directionsManagerPrototype.clearDisplay=function(){this._getTask().clearDisplay()},directionsManagerPrototype.resetDirections=function(n){this._getTask().resetDirections(n)},directionsManagerPrototype.addWaypoint=function(n,t){this._getTask().addWaypoint(n,t)},directionsManagerPrototype.removeWaypoint=function(n,t){this._getTask().removeWaypoint(n,t)},directionsManagerPrototype.getNearbyMajorRoads=function(n,t,i,r){this._getTask().getNearbyArterials(n,t,i,r)},directionsManagerPrototype.reverseGeocode=function(n,t,i,r){this._getTask().reverseGeocode(n,t,i,r)},directionsManagerPrototype.getMap=function(){return this._map},directionsManagerPrototype.getRouteResult=function(){return this._getTask()._getState().routes},directionsManagerPrototype.getAllWaypoints=function(){return this._getTask()._getState().stoppoints},directionsManagerPrototype.getRenderOptions=function(){return this._getTask()._getState().getRenderOptions()},directionsManagerPrototype.getRequestOptions=function(){return this._getTask()._getState().getRequestOptions()},directionsManagerPrototype.setRenderOptions=function(n){this._getTask().setRenderOptions(n)},directionsManagerPrototype.setRequestOptions=function(n){this._getTask().setRequestOptions(n)},directionsManagerPrototype.dispose=function(){this._getTask().dispose(),this._task=null};var ne=102,vr=182,gr=51,uu=51,eu=255,pu=51,nf=51,wu=255,bu=!1,ku=400,hr=4,du=5280,tf=1e3,nu=.15,gu=6,or=new pi(1,204,204,204),sr=new pi(1,17,17,17),yr=new pi(1,0,0,0),ar=new pi(1,230,230,230),rf=204,di="_LPanel",fi="_RPanel",tr="_SPanel",yu="veDDstep$",vf="DDWaypointPushpin$",yf="DDDisambiguationPushpin$",ki=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],pf="veTransitStep$",af="DDRouteSublegPolyline$",dr=3,cr=15e3,le=1.60934,fe=100,lr=2,he="DDStart",ee="DDEnd",ve="DDAddToTrip",oe="DDNewRequest",gf="RouteOptions",bi="resolvedWaypoints",ur="NearbyArterials",se=100,su=5,re=4e3,ou=10,cf=15,ie=400,ff="du",yi="mi",uf="km",lu="reverseGeocodeResults",ue="Maps",ce=!0,we=250,pe=35,ke=20,be="solid",ae="6,4",pr=25,wi="{0}_{1}",of=128,ef="DD_SL",kf="MicrosoftMapsDirections_",l=6,bf="DDStart",df="DDEnd",ye='routes="',rt={none:0,other:1,auto:2,ferry:3,walk:4,bus:5,train:6,airline:7,tube:8};DirectionPublicNamespace.IconType=rt,li={none:0,unknown:1,departStart:2,departIntermediateStop:3,departIntermediateStopReturning:4,arriveFinish:5,arriveIntermediateStop:6,turnLeft:7,turnRight:8,turnBack:9,uTurn:10,turnToStayLeft:11,turnToStayRight:12,bearLeft:13,bearRight:14,keepToStayLeft:15,keepToStayRight:16,keepToStayStraight:17,keepLeft:18,keepRight:19,keepStraight:20,take:21,takeRampLeft:22,takeRampRight:23,takeRampStraight:24,keepOnRampLeft:25,keepOnRampRight:26,keepOnRampStraight:27,merge:28,continueRoute:29,roadNameChange:30,enterRoundabout:31,exitRoundabout:32,turnRightThenTurnRight:33,turnRightThenTurnLeft:34,turnRightThenBearRight:35,turnRightThenBearLeft:36,turnLeftThenTurnLeft:37,turnLeftThenTurnRight:38,turnLeftThenBearLeft:39,turnLeftThenBearRight:40,bearRightThenTurnRight:41,bearRightThenTurnLeft:42,bearRightThenBearRight:43,bearRightThenBearLeft:44,bearLeftThenTurnLeft:45,bearLeftThenTurnRight:46,bearLeftThenBearRight:47,bearLeftThenBearLeft:48,rampThenHighwayRight:49,rampThenHighwayLeft:50,rampToHighwayStraight:51,enterThenExitRoundabout:52,bearThenMerge:53,turnThenMerge:54,bearThenKeep:55,transfer:56,wait:57,takeTransit:58,walk:59,transitDepart:60,transitArrive:61},DirectionPublicNamespace.Maneuver=li,h={success:0,unknownError:1,cannotFindNearbyRoad:2,tooFar:3,noSolution:4,dataSourceNotFound:5,cacheMiss:6,noAvailableTransitTrip:7,transitStopsTooClose:8,walkingBestAlternative:9,outOfTransitBounds:10,timeout:11,waypointDisambiguation:12,hasEmptyWaypoint:13,exceedMaxWaypointLimit:14,atleastTwoWaypointsRequired:15,firstOrLastStoppointIsVia:16,searchServiceFailed:17,invalidCredentials:18},DirectionPublicNamespace.RouteResponseCode=h,ut={info:0,minor:1,moderate:2,major:3,ccZoneEnter:4,ccZoneExit:5},DirectionPublicNamespace.StepWarningStyle=ut,fr=function(){},fr.prototype={parentLegKey:null,subLegKey:null,polylineIds:null,temporaryRoute:!1},ci=function(n,t,i){this.boundingRectangle=n,this.childRegions=i,this.indexes=t},ft.prototype={_address:"",_shortAddress:"",_location:null,_geoLocation:null,_businessName:"",_phoneNumber:"",_exactLocation:!0,_uniqueId:null,_isViapoint:!1,_disambiguation:null,_disambiguationContainer:null,_entityId:null,_locationIdentifier:null,_website:null,_inputType:null,_pushpin:null,isViapoint:function(){return this._isViapoint},getPushpin:function(){return this._pushpin},getAddress:function(){return this._address},getShortAddress:function(){return this._shortAddress},getLocation:function(){return this._location},getGeoLocation:function(){return this._geolocation},isExactLocation:function(){return this._exactLocation},getDisambiguationResult:function(){return this._disambiguation},getDisambiguationContainer:function(){return this._disambiguationContainer},getBusinessDetails:function(){var n={};return this._businessName&&(n.businessName=this._businessName),this._phoneNumber&&(n.phoneNumber=this._phoneNumber),this._website&&(n.website=this._website),this._entityId&&(n.entityId=this._entityId),n},dispose:function(){}},ft._isBusinessWaypoint=function(n){var t=n.getBusinessDetails();return t.entityId||t.businessName&&n.getAddress()},ft._uniqueWaypointId=1,v.Directions=v.Directions||{},v.Directions.Waypoint=ft,t=function(){},t.RemoveDomElement=function(n){var t=y(n);t&&t.parentNode&&t.parentNode.removeChild(t)},t.removeBehavior=function(n){var t,r,i;if(n&&window.Sys&&window.Sys.UI&&window.Sys.UI.Behavior){t=Sys.UI.Behavior.getBehaviors(n);if(t&&t.length>0)for(r=t.length,i=0;i<r;i++)t[i].dispose()}},t.getCredentials=function(n,t){t("")},t.toggleTaskProgressIndicator=function(n,t){typeof VEShell!="undefined"&&VEShell.App.get_taskHost().toggleTaskProgressIndicator(n,t+fi)},t.toggleInline=function(n){n.set_style({display:n.get_style("display")!=="none"?"none":"block"})},d=t.addAnchorElement=function(n,i,r,u,f){return t._addAnchorElementWithEncodeOption(n,i,r,u,f,!0)},t._addAnchorElementWithEncodeOption=function(n,i,r,u,f,e){var o=document.createElement("a");return n&&(o.id=n),o.href=f,i&&(o.className=i),o.innerHTML=e?t.htmlEncode(u):u,k(r)||r.appendChild(o),o},f=t.addDOMElement=function(n,t,i,r,u){var f=document.createElement(n);return t&&(f.id=t),u&&(ni.useXHR?MSApp.execUnsafeLocalFunction(function(){f.innerHTML=u}):f.innerHTML=u),i&&(f.className=i),r&&(ni.useXHR?MSApp.execUnsafeLocalFunction(function(){r.appendChild(f)}):r.appendChild(f)),f},e=t.addDivElement=function(n,t,i){var r=document.createElement("div");return n&&(r.id=n),t&&(r.className=t),i&&i.appendChild(r),r},t._addHtmlEncodedDivElementWithText=function(n,i,r,u){var f=e(n,i,r);return f.innerHTML=t.htmlEncode(u),f},t._addInputElement=function(n,t,i,r,u,f){var e=null;if(ti(f))e=document.createElement("input");else try{e=document.createElement("<input name='"+f+"'>")}catch(o){e=document.createElement("input"),e.name=f}return e.id=n,e.className=t,e.type=u,e.value=r,k(i)||i.appendChild(e),e},t._addCheckBox=function(n,i,r,o,s){var l=e("","",i),c=f("span","","checkbox",l,""),h=t._addInputElement(n,"",c,"","checkbox",""),a=f("label","","",c,r);return n&&a.setAttribute("for",n),o&&u(h).set_attr("checked","checked"),u(h).add_event("click",s),l},t._getInlineImage=function(n,t){var r=t,u,i;return ni.isIE7OrEarlier||(u=t.substring(t.indexOf("?")+1).replace(/=/g,"").replace(/&/g,""),i=n.inlineImagesCache[u],i&&(r="data:image/png;base64,"+i)),r},t._reRenderDirectionsPanel=function(n){var i;if(ni.isIE8OrEarlier&&n){var r="0",f="0",t=null,e=u("#"+n+"_LPanel").element(),o=u("#"+n+"_RPanel").element();e&&(r=u(e).get_style("height"),t=e.parentElement),o&&(f=u(o).get_style("height"),t=o.parentElement),vi||(i=0,r&&r.indexOf("px")>0&&(i=parseInt(r.substring(0,r.indexOf("px")),10)),f&&f.indexOf("px")>0&&(i+=parseInt(f.substring(0,f.indexOf("px")),10)),t&&i>0&&u(t).set_style({height:i})),t&&(t.className=t.className)}},t.getInputDisplayText=function(n){var i,t=n.getBusinessDetails();return i=t&&t.businessName?t.businessName:n.getAddress()},t._getFormattedDistance=function(n,t){n=parseFloat(n);var r;return r=t===tt.miles?n<.1?(n*du).toFixed(0)+" "+i.getString("L_DistanceUnitFeetShort_Text"):n.toFixed(1)+" "+i.getString("L_DistanceUnitMilesShortText_Text"):n<.1?(n*tf).toFixed(0)+" "+i.getString("L_DistanceUnitMeters_Text"):n.toFixed(1)+" "+i.getString("L_DistanceUnitKm_Text"),c.RadixPointDecimal||(r=r.replace(".",",")),r},t._getDurationFormattedTime=function(n){var r="",t=Math.round(n/60),f,u;return t<1?r=i.getString("L_TimeLessThanOneMin_Text"):t<60?r=i.getString("L_TimeLessThanOneHr_Text").replace("{0}",t.toFixed(0)):t<60||(f=Math.floor(t/60).toFixed(0),u=Math.floor(t%60),r=u?i.getString("L_TimeMoreThanOneHr_Text").replace("{0}",f).replace("{1}",u.toFixed(0)):i.getString("L_TimeInHr_Text").replace("{0}",f)),r},t._parseCustomDateTime=function(n){var u=null,r,t,i;return n&&(r=n.split("T"),r&&r.length===2&&(t=r[0].split("-"),i=r[1].split(":"),t.length===3&&i.length===3&&(u=new Date(parseInt(t[0],10),parseInt(t[1],10)-1,parseInt(t[2],10),parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10))))),u},t._isTransitTrainLineAgencyId=function(n){return n>=-999&&n<=-500},t._addTransitTrainLineLinkElements=function(n,t,r){var e,u,s,o;return r=r||"",e=f("span","","dd_transitTrainLineText",n,""),u=i.getString("L_BuyTickets_Text").split("{0}"),u[0].length>0&&e.appendChild(document.createTextNode(u[0])),s=w.transitTrainLineComBuyTicketsUriFormat.replace("{0}",t),o=d(r,"",e,i.getString("L_TransitTrainLineCom_Text"),s),o.target="_blank",u.length>1&&u[1].length>0&&e.appendChild(document.createTextNode(u[1])),e},t._getTransitFormattedCost=function(n){return i.getString("L_TransitCostWithCurrency_Text").replace("{0}",t._formatCurrency(n))},t._formatCurrency=function(n){var e=n<0,t,i,u,f,r;for(n=Math.abs(n),n=Math.round(n*100)/100,t=n.toString(),i=t.indexOf("."),i<0&&(i=t.length+1),u=[],f=0,r=(i-1)%3;r<i;r+=3)r>0&&(u[u.length]=t.substring(f,r),f=r);return t=i<t.length?u.join(",")+t.substr(i):u.join(","),e&&(t="-"+t),t},t._getFormattedColor=function(n){var t="#{0}{1}{2}";return t.replace("{0}",(n.r<16?"0":"")+n.r.toString(16)).replace("{1}",(n.g<16?"0":"")+n.g.toString(16)).replace("{2}",(n.b<16?"0":"")+n.b.toString(16))},t._getFormattedTime=function(n){var i=n.getHours(),r="",u;return c.TransitTimeUse12Hour?(u=i>=12,i=t._convert24HourTo12Hour(i),r=i+":"+(n.getMinutes()<10?"0":"")+n.getMinutes()+(u?"PM":"AM")):r=i+":"+(n.getMinutes()<10?"0":"")+n.getMinutes(),r},t._convert24HourTo12Hour=function(n){return n<12||(n-=12),n||(n=12),n},t._convert12HourTo24Hour=function(n,t){return n===12&&(n=0),t&&(n+=12),n},t._getParentElementWithAttribute=function(n,t){var i=n.target,r;while(!k(i)){r=i.getAttribute(t);if(k(r))i=i.parentNode;else break}return i},t.isUndefined=function(n){return typeof n=="undefined"||typeof n=="unknown"},k=t.isNullOrUndefined=function(n){return t.isUndefined(n)||n===null},ti=t.isNullOrEmpty=function(n){return typeof n=="undefined"||typeof n=="unknown"||n===null||n===""},t.GetUniqueNetworkRequestId=function(n){var r="",t,i;return n.indexOf("{jsono}")===-1&&(t=n.indexOf("jsonso="),i=-1,t>-1&&(t=t+7,i=n.indexOf("&",t),r=i>-1?n.substr(t,i-t):n.substr(t))),r},t.convertPermalinkDictionaryToPermalink=function(n){var i="",r=!0,t;for(t in n)r||(i+="&"),i+=t+"=",t==="jsonso"?i+=n[t]:k(n[t])||(i+=encodeURIComponent(n[t].toString())),r=!1;return i},y=t.getElementById=function(n){return document.getElementById(n)},t.htmlEncode=function(n){var t=document.createElement("div"),i=document.createTextNode(n);return t.appendChild(i),t.innerHTML},t.parseQueryString=function(){var n,t;if(ti(window.location.search))return{};var u=window.location.search.substr(1),r=u.split("&"),i={},f=r.length;for(n=0;n<f;n++)t=r[n].split("="),i[t[0].toLowerCase()]=t[1];return i},r=t.createDelegate=function(n,t){return function(){if(t)return t.apply(n,arguments)}},t.extend=function(n,t){function i(){}i.prototype=t.prototype,n.prototype=new i,n.prototype.constructor=n,n.baseConstructor=t,n.superClass=t.prototype},t.getDateInSupportedFormat=function(n){var t=c.TransitDateFormat;return t.replace("m",n.getMonth()+1).replace("d",n.getDate()).replace("yyyy",n.getFullYear())},t.getDateFromStringInSupportedFormat=function(n,t){var f=null,r=null,u=null,e=t.replace(/[/-]/ig,""),i=n.split(/[/-]/ig);switch(e){case"dmyyyy":r=i[0],f=i[1],u=i[2];break;case"yyyymd":u=i[0],f=i[1],r=i[2];break;default:f=i[0],r=i[1],u=i[2]}return new Date(u,f-1,r)},t.getLuminance=function(n){var r=.212671,i=.71516,t=.072169;return n.r*r+n.g*i+n.b*t},fu.Helper=t,DirectionPublicNamespace.Helper=t,fu.PermalinkHelper=oi,ot._uniquePrefixId=0,si=new function(){var n=this;n.getRouteModeClass=function(n){var t="";switch(n){case o.driving:t="dd_routeModeCar";break;case o.transit:t="dd_routeModeTransit";break;case o.walking:t="dd_routeModeWalking"}return t},n.createDirectionPanel=function(t,i,r){var s=n.getRouteModeClass(r),f=u("#"+i+fi),o,h,c;typeof gi!="undefined"&&(o=u("#"+i+di),o.element()?(o.remove_class("dd_routeModeCar dd_routeModeTransit dd_routeModeWalking"),o.add_class(s)):(h=e(i+di,"MicrosoftMap dd_directionsPanel landing noprint "+s,null),f.element()?t.insertBefore(h,f.element()):t.appendChild(h))),c=u("#"+i+tr),c.element()||e(i+tr,"MicrosoftMap dd_directionsPanel schedule",t),f.element()?(f.remove_class("dd_routeModeCar dd_routeModeTransit dd_routeModeWalking"),f.add_class(s)):e(i+fi,"MicrosoftMap dd_directionsPanel dd_route "+s,t)},n.getDefaultWaypointOption=function(n,t){var f=n.getOptions(),u=n.cloneOptions(f.waypointPushpinOptions),r,i;if(!u.text)for(r=n.getAllWaypoints(),i=0;i<r.length;i++)if(r[i]._uniqueId===t._uniqueId){u.text=ki[i];break}return u}},pt=function(s,h,l,v){function ct(){var t=p._state.routes,n;if(t&&t.length>0&&t[0].routeLegs&&t[0].routeLegs.length>0){n=t[0].routeLegs[0];if(n.itineraryItems&&n.itineraryItems.length>0&&n.itineraryItems[0].transitLine)return n.itineraryItems[0].transitLine.providerInfo}return""}function nt(n){var e=t._getParentElementWithAttribute(n,"StepIndex"),i={};if(e){var s=e.getAttribute("StepIndex"),f=s.split(":"),o=parseInt(f[2]),r=parseInt(f[0]),h=parseInt(f[1]),u=p._state.currentRouteLegs[o].itineraryItems[r];i.stepNumber=r+h+1,i.routeLegIndex=o,i.stepIndex=r,i.routeIndex=p._state.getOptions().routeIndex,i.location=new a(u.coordinate.latitude,u.coordinate.longitude),i.step=u,i.handled=!1,i.originalEventArgs=n}return i}var p=this,lt,st,k,ot,tt,et,rt,it;p._map=s,lt=l,p._panTimer=-1,p._state=v,p._taskHostIdPrefix=v._getPrefixId();var vt=null,w=!1,at=null;p._disambiguationControl=null,p._pushpinManager=h,p._directionsPanel=null,p.createResultsPage=function(){w=!1;var n=p._state.getOptions(),i=p._state._getPrefixId(),t=n.itineraryContainer;si.createDirectionPanel(t,i,n.routeMode),p._directionsPanel=u("#"+i+fi,t).element(),p._directionsPanel&&(p._directionsPanel.innerHTML=""),p.createRouteSelectionSwitcher&&n.displayRouteSelector&&p.createRouteSelectionSwitcher(),p.createItinerary(),st()},st=function(){var n=e(p._taskHostIdPrefix+"ResultsFooter","clearFloat",p._directionsPanel);p._createSendTo&&p._createSendTo(n),e("","clearFloat",n),typeof k!="undefined"&&k()},p.updateReverseGeocodedText=function(n){var f=n.getAddress(),u=n.getShortAddress(),r,t;n.isViapoint()?(t=y(p._taskHostIdPrefix+"ViaText"+n._uniqueId),t&&(t.innerHTML=i.getString("L_ViaList_Text").replace("{0}",u))):(r=y(p._taskHostIdPrefix+"WaypointText"+n._uniqueId),r.innerHTML=f)},p._createNewWaypoint=function(n,r){var l,w,s,nt,tt,c,y,o,a,k,g;if(!n)return;l=n.getLocation(),l&&(r.setAttribute("lat",l.latitude.toFixed(6)),r.setAttribute("lon",l.longitude.toFixed(6))),w=n._uniqueId,s={},n.getPushpin()?(nt=n.getPushpin(),s.text=nt.getText()):p._pushpinManager?s=p._pushpinManager.getDefaultOptions(n):(tt=si.getDefaultWaypointOption(p._state,n),s.text=tt.text),c=e("","",r),ht?f("span","","dd_maneuver dd_MIconarriveFinish",c,""):f("span","","dd_directionStepLetter",c,s.text);var b=ft._isBusinessWaypoint(n),o=n.getBusinessDetails(),it=p._state.stoppoints[p._state.stoppoints.length-1]._uniqueId===w,v=o&&o.businessName?o.businessName:n.getAddress(),h=e("","dd_waypointDisplayText",c);b||u(h).add_class("dd_locationWaypoint"),y=null,o=n.getBusinessDetails(),y=o.entityId&&b&&typeof DirectionsShell!="undefined"?d("","",h,v,DirectionsShell.DirectionShellUtility.getSearchResultDetailsUrl(o.entityId)):t._addHtmlEncodedDivElementWithText(p._taskHostIdPrefix+"WaypointText"+w,"",h,v?v:""),b&&(n.getAddress()&&t._addHtmlEncodedDivElementWithText("","",h,n.getAddress()),a=e("","",h),o.phoneNumber&&(k=f("span","","",a,""),k.innerHTML=t.htmlEncode(o.phoneNumber)),o.website&&(g=d("","dd_ContactCardSeparator dd_Website noprint",a,i.getString("L_WebsiteLink_Text"),o.website),g.target="_blank"))},p._createWalkingWarning=function(){if(p._state.getOptions().displayWalkingWarning){var n=e(p._taskHostIdPrefix+"MessageContainer","dd_messageContainer dd_walkingWarning",p._directionsPanel),t=e("","dd_walkingWarningIcon",n);f("span","","dd_walkingWarningText",n,i.getString("L_WalkingDirectionsSidewalkWarning_Text"))}},k=function(){var t=p._state.getOptions(),r,n;t.displayDisclaimer&&(r=e("disclaimerDiv","clearFloat",p._directionsPanel),n="",n=b==="ja-jp"?i.getString("L_DirectionsDisclaimer_Text").replace("{0}",ct()):t.routeMode===o.transit?i.getString("L_TransitDisclaimer_Text"):i.getString("L_DirectionsDisclaimer_Text").replace("{0}",i.getString("L_TermsOfUse_Text")),n=n.replace(/{year}/,(new Date).getFullYear()),f("span",p._taskHostIdPrefix+"Disclaimer_disclaimerLabel","dd_directionsDisclaimer",r,n))},p.createViapoints=function(t,i){var f,r,o,e;if(p._state.getAllViaInLeg)for(f=p._state.getAllViaInLeg(t),r=0;r<f.length;r++)o=f[r],e=ot(o,i,p._taskHostIdPrefix,r===0),u(e).add_event("click",function(t){var i=t.target.getAttribute("UniqueId");t.preventDefault(),p._state.removeStoppoint(parseInt(i),!0),n.invoke(p,"updateDirections",null)})},ot=function(n,t,r,o){var h=e("","dd_viapointItemContainer",t),c,s;return o&&u(h).add_class("first"),c=f("span",r+"ViaText"+n._uniqueId,"dd_viapointText",h,""),n.getAddress()&&(c.innerHTML=i.getString("L_ViaList_Text").replace("{0}",n.getAddress())),s=d("","",h,i.getString("L_RemoveVia_Text"),"#"),s.setAttribute("UniqueId",n._uniqueId),s},p.createRouteSteps=function(t,i,r,u){var s=y(p._taskHostIdPrefix+"ItineraryContainer"+u._uniqueId),l,o,c,h;for(s?s.removeChild(s.children[0]):s=e(p._taskHostIdPrefix+"ItineraryContainer"+u._uniqueId,"dd_itinerary",p._directionsPanel),l=f("ul",p._taskHostIdPrefix+"StepItems","",s,""),o=0;o<t.itineraryItems.length;o++)c=this.itineraryStepSetup(o,r,i,l,t.itineraryItems),h={stepIndex:o,routeLegIndex:i,routeIndex:p._state.getOptions().routeIndex,containerElement:c,step:t.itineraryItems[o],prevStep:o===0?null:t.itineraryItems[o-1],lastStep:o===t.itineraryItems.length-1,handled:!1},n.invoke(p,"beforeStepRender",h)},p.itineraryStepSetup=function(n,t,i,e,o){var h=o[n],s=f("li",p._state._getPrefixId()+"StepListItem"+(n+t),"dd_singleStep",e,"");return s.setAttribute("StepIndex",n+":"+t+":"+i),s.setAttribute("lat",h.coordinate.latitude.toFixed(6)),s.setAttribute("lon",h.coordinate.longitude.toFixed(6)),u(s).add_event("mouseenter",r(p,et)),u(s).add_event("mouseleave",r(p,rt)),u(s).add_event("click",r(p,it)),s},p.addWarnings=function(n,t){var s,u,i,r,e,o;if(n.length>0&&p._state.getOptions().displayStepWarnings){for(s=f("ul",p._taskHostIdPrefix+"AnnotationList","dd_annotationList",t,""),u=0,i=0;i<n.length;i++)(n[i].style===ut.ccZoneEnter||n[i].style===ut.ccZoneExit)&&u++;for(i=0;i<n.length;i++){r="",e="dd_annotation ";switch(n[i].style){case ut.info:r="dd_info";break;case ut.minor:r="dd_minor";break;case ut.moderate:r="dd_moderate";break;case ut.major:r="dd_major";break;case ut.ccZoneEnter:u!==1||w||(e+="tollzone_ccz");break;case ut.ccZoneExit:u===1&&(e+="tollzone_ccz",w=!1)}u===1?n[i].style===ut.ccZoneEnter||n[i].style===ut.ccZoneExit?tt(n[i].style,e,s):(o=f("li","",e,s,""),f("span","",r,o,""),f("span","","",o,n[i].text)):(!u||u>1)&&n[i].style!==ut.ccZoneEnter&&n[i].style!==ut.ccZoneExit&&(o=f("li","",e,s,""),f("span","",r,o,""),f("span","","",o,n[i].text))}}},tt=function(n,t,e){var s,h,o;n===ut.ccZoneEnter?w||(o=f("li","",t,e,""),s=d("","",o,i.getString("L_CongestionChargeZoneEnter_Text"),"http://www.cclondon.com"),o.title=i.getString("L_CongestionChargeZoneTooltip_Text"),s.setAttribute("target","_blank"),u(s).add_event("click",r(p,function(n){n.stopPropagation()})),h=f("span","","",o,i.getString("L_CongestionChargeZoneEnterTwo_Text")),w=!0):n===ut.ccZoneExit&&(o=f("li","",t,e,i.getString("L_CongestionChargeZoneExit_Text")))},p._onTrafficBasedRouteClicked=function(t){t.preventDefault(),p._state.setOptions({avoidTraffic:!p._state.getOptions().avoidTraffic}),n.invoke(p,"updateDirections",null)},et=function(t){n.invoke(p,"mouseEnterStep",nt(t))},p._onMouseEnterStepUnhandled=function(n){for(var r=g("li.dd_singleStep"),i,t=0;t<r.length;t++)i=r[t],u(i).remove_class("dd_outFocus"),i!==n.originalEventArgs.currentTarget&&u(i).add_class("dd_outFocus")},rt=function(t){n.invoke(p,"mouseLeaveStep",nt(t))},p._onMouseLeaveStepUnhandled=function(){for(var r=g("li.dd_singleStep"),i,t=0;t<r.length;t++)i=r[t],u(i).remove_class("dd_outFocus")},it=function(t){n.invoke(p,"itineraryStepClicked",nt(t))},p.createRouteSummary=function(n,s,h){var a=s>=0?!1:!0,y,k,w,v;u(h).add_class("dd_routeSummary"),a&&u(h).add_class("dd_routeRootSummary");if(n){y=e("",a?"dd_tripSummary":"",h),a||(k=i.getString("L_RouteSummaryLink_Text").replace("{0}",ki[s]).replace("{1}",ki[s+1]),f("span","","directive",y,k));var l=p._state.getOptions(),b=l.routeMode,g=b===o.driving?"L_RouteOverviewDriving_Text":b===o.walking?"L_RouteOverviewWalking_Text":"L_RouteOverviewOther_Text",tt=t._getFormattedDistance(n.distance,l.distanceUnit),it=t._getDurationFormattedTime(n.time),nt=i.getString(g).replace("{0}",tt).replace("{1}",it);f("span","","",y,nt),l.displayTrafficAvoidanceOption&&a&&b===o.driving&&c.TrafficAwareDirections&&p._state.currentRouteLegs.length===1&&p._state.getViaCount()===0&&(w=e("","noprint dd_trafficTime",h),l.avoidTraffic||n.timeWithTraffic<n.time?l.avoidTraffic&&(w.innerHTML=i.getString("L_RerouteBasedOnTraffic_Text"),v=d(p._taskHostIdPrefix+"TrafficBasedRouteLink","noprint",h,i.getString("L_GoBackToThePreviousRoute_Text"),"#"),u(v).add_event("click",r(p,p._onTrafficBasedRouteClicked))):(w.innerHTML=i.getString("L_RouteTimeInCurrentTrafficCondition_Text").replace("{0}",t._getDurationFormattedTime(n.timeWithTraffic)),v=d(p._taskHostIdPrefix+"TrafficBasedRouteLink","noprint dd_avoidTraffic",h,i.getString("L_SeeTrafficBasedRoute_Text"),"#"),u(v).add_event("click",r(p,p._onTrafficBasedRouteClicked))))}},p.dispose=function(){p._disambiguationControl&&p._disambiguationControl.dispose();var n=y(p._state._getPrefixId()+fi);n&&(n.parentNode.removeChild(n),n=null)}},pt._currentHighConfidenceDisambiguationHighlightPin=null,pt.getNewResultsPage=function(n,t,i,r){var u=null;switch(r.getOptions().routeMode){case o.transit:u=new ct(n,t,i,r);break;default:u=new pt(n,t,i,r)}return u},pt._createViaEROContent=function(n){var r=f("div","","",null,"");return f("span","","dd_waypointPrefix",r,i.getString("L_WaypointViaEro_Text")),t._addHtmlEncodedDivElementWithText("","dd_waypointEroAddress",r,n.getAddress()),r},pt._getHtmlFormattedInstruction=function(n){return n&&(n=n.replace(new RegExp("(</ExitNumber>|</TurnDir>|</RoadName>|</Sign>|</WaypointName>)","gi"),"</span>"),n=n.replace(new RegExp("(<ExitNumber>|<TurnDir>|<RoadName>|<Sign>|<WaypointName>)","gi"),'<span class="instructionKeyword">'),n=n.replace(new RegExp("</(\\S*)>","gi"),""),n=n.replace(new RegExp("<(\\S*)>","gi"),"")),n},pt.prototype={createItinerary:function(){var u=this._state.getOptions(),c,t,h,f,i,s,l,r;for(u.routeMode===o.walking&&this._createWalkingWarning&&this._createWalkingWarning(),c=0,h=this._state.getAllWaypoints(),this._createHighConfidenceDisambiguation&&this._createHighConfidenceDisambiguation(this._directionsPanel),u.routeMode!==o.transit&&(i=e(this._taskHostIdPrefix+"SummaryContainer","",null),i.style.clear="both",r={summary:this._state.summary[u.routeIndex],containerElement:i,routeLegIndex:-1,handled:!1},n.invoke(this,"beforeSummaryRender",r)),t=0;t<this._state.currentRouteLegs.length;t++){f=this._state.currentRouteLegs[t],this._state.currentRouteLegs.length>1&&u.routeMode!==o.transit&&(i=e(this._taskHostIdPrefix+"SummaryContainer"+t,"",null),i.style.clear="both",r={summary:f.summary,containerElement:i,routeLegIndex:t,handled:!1},n.invoke(this,"beforeSummaryRender",r)),s=h[t];if(!ht){var v=t===0?"dd_waypoint firstWaypoint":"dd_waypoint dd_midWaypoint",a=e("",v,this._directionsPanel),y={waypoint:s,containerElement:a,handled:!1};n.invoke(this,"beforeWaypointRender",y),this.createViapoints&&this.createViapoints(s._uniqueId,a)}this.createRouteSteps(f,t,c,s),c+=f.itineraryItems.length}ht&&u.routeMode!==o.transit||(l=e("","dd_waypoint dd_lastWaypoint",this._directionsPanel),r={waypoint:h[t],containerElement:l,handled:!1},n.invoke(this,"beforeWaypointRender",r))},createSingleItineraryStep:function(n,i,r,u,o){var k=0,b=o.getAttribute("StepIndex"),v,a,c,w,l,p,y,h;b&&(v=b.split(":"),v&&v.length===3&&(k=parseInt(v[1]))),a=this._state.getOptions(),n.maneuverImageName!==""&&a.displayManeuverIcons&&(c="",i&&!vi&&(c=" dd_maneuverWithDistance"),n.isImageRoadShield?(w=f("img","","dd_maneuver"+c,o,""),w.src=n.maneuverImageName):n.maneuverImageName?f("span","","dd_maneuver dd_MIcon"+n.maneuverImageName+c,o,""):f("span","","dd_maneuver"+c,o,"")),l=e("","dd_iteneraryContainer",o),i&&(p=t._getFormattedDistance(i.distance,this._state.getOptions().distanceUnit),f("div",this._taskHostIdPrefix+"StepDistance","dd_distance",l,p)),y=f("div",this._taskHostIdPrefix+"StepInstruction","dd_instruction",l,""),f("div",this._taskHostIdPrefix+"StepInstructionMain","",y,n.formattedText),this.addWarnings(n.warnings,o);if(n.preIntersectionHints&&a.displayPreItineraryItemHints)for(h=0;h<n.preIntersectionHints.length;h++)f("span","","dd_intersectionHint",l,n.preIntersectionHints[h]);if(n.postIntersectionHints&&a.displayPostItineraryItemHints)for(h=0;h<n.postIntersectionHints.length;h++)f("span","","dd_intersectionHint",l,n.postIntersectionHints[h])}},ct=function(i,r,u,f){function o(n){var r=t._getParentElementWithAttribute(n,"RouteIndex"),i={},u;return r&&(u=parseInt(r.getAttribute("RouteIndex").toString()),i.routeIndex=u,i.containerElement=r,i.handled=!1),i}var e=this;e._state=f,e._map=i,e._routeOptionHoverTimeoutHandler=-1,e._taskHostIdPrefix=f._getPrefixId(),e._optionsControl=null,ct.baseConstructor.call(this,e._map,r,u,f),e._onRouteSelectOptionClick=function(t){n.invoke(e,"routeSelectorClicked",o(t))},e._onRouteSelectMouseEnter=function(t){n.invoke(e,"mouseEnterRouteSelector",o(t))},e._onRouteSelectMouseLeave=function(t){n.invoke(e,"mouseLeaveRouteSelector",o(t))}},t.extend(ct,pt),ct.prototype={_transitStepEROOpen:!1,createItinerary:function(){var r;if(b==="ja-jp"){r=e("","dd_transitItineraryTitle",this._directionsPanel),f("div","transitItineraryRouteIndex","dd_transitItineraryRouteIndex",r,i.getString("L_TransitItineraryTitle_Text").replace("{0}",this._state.getOptions().routeIndex+1));var o=e("transitItinerarySummary","dd_transitItinerarySummary",r),n=this._state.routes[this._state.getOptions().routeIndex].routeLegs[0],u=t._getDurationFormattedTime(n.summary.time);c.TransitShowRouteCost&&n.summary.monetaryCost>0&&(u+="&nbsp;&nbsp;"+t._getTransitFormattedCost(n.summary.monetaryCost)),o.innerHTML=u}ct.superClass.createItinerary.call(this)},createTransitActionInstruction:function(n,r,u,e){var o="",h,s;n.iconType==rt.walk&&b!=="ja-jp"?(h="{0} / {1}",s=h.replace("{0}",t._getFormattedDistance(n.distance,u)).replace("{1}",t._getDurationFormattedTime(n.durationInSeconds)),o=i.getString("L_WalkingDistanceFrom_Text").replace("{0}",s)):o=r==0?n.iconType===rt.bus?i.getString("L_TakeBus_Text"):n.iconType===rt.tube?i.getString("L_TakeTube_Text"):i.getString("L_TakeTrain_Text"):i.getString("L_RideAndExitAt_Text").replace("{0}",t._getDurationFormattedTime(n.durationInSeconds)),f("div","","dd_stepDistance",e,o)},getTextBetweenTag:function(n,t){var u="",i=t.indexOf("<"+n+">"),r=t.indexOf("</"+n+">");return i!==-1&&r!==-1&&(i+=n.length+2,i<r&&(u=t.substring(i,r))),u},createTransitInstruction:function(n,t,r){var o="",e,h,s;n&&(e=f("div","","dd_stepText",r),n.iconType!=rt.walk?t==0&&n.transitLine?(h=f("span","","dd_stepVerboseName",e,n.transitLine.verboseName),u(h).set_style({backgroundColor:"rgb("+n.transitLine.lineColor.r+","+n.transitLine.lineColor.g+","+n.transitLine.lineColor.b+")",color:"rgb("+n.transitLine.lineTextColor.r+","+n.transitLine.lineTextColor.g+","+n.transitLine.lineTextColor.b+")"}),f("span","","",e," "+n.transitTerminus)):t!=0&&n.transitLine&&(o=this.getTextBetweenTag("TransitStop",n.childItineraryItems[t].formattedText),f("span","","",e,o)):(s=this.getTextBetweenTag("EndLocation",n.formattedText),o=i.getString("L_WalkingInstruction_Text").replace("{0}",s),f("span","","",e,o)))},createTransitArrivalDepartureTimeInstruction:function(n,r,u){var s="",e,h,o;n&&(e=n.childItineraryItems[r],n&&e&&(h=t._getFormattedTime(t._parseCustomDateTime(e.time)),e.maneuver==li.transitDepart?s=i.getString("L_ScheduledDeparture_Text").replace("{0}",h):e.maneuver==li.transitArrive&&(s=i.getString("L_ScheduledArrival_Text").replace("{0}",h)),ht&&(o=RealTimeHelper.getRealTimeMetaData(n),o&&e.maneuver===li.transitDepart&&(u=d("dd_realTimeLink","",u,"",""),u.setAttribute("stopName",o.stopName),u.setAttribute("routeTag",o.routeTag),u.setAttribute("stopId",o.stopId),u.setAttribute("routes",o.routes))))),f("div","","dd_stepText",u,s)},createSingleItineraryStep:function(n,i,r,u,o){var v=this._state.getOptions(),p=f("img","","dd_TransitIcon",o,""),h,y,a,l;p.src=t._getInlineImage(this._state,n.maneuverImageName),h=null,n.childItineraryItems&&n.childItineraryItems.length!=0||(h=f("div","subStepContainer","dd_transitStepContainer",o),this.createTransitActionInstruction(n,0,v.distanceUnit,h),this.createTransitInstruction(n,0,h)),c.TransitShowRouteCost&&n.monetaryCost>0&&(y=t._getTransitFormattedCost(n.monetaryCost),f("span","","dd_stepCost",h,y)),this.addWarnings(n.warnings,o);if(n.preIntersectionHints&&v.displayPreItineraryItemHints)for(l=0;l<n.preIntersectionHints.length;l++)f("span","","dd_intersectionHint",h,n.preIntersectionHints[l]);if(n.childItineraryItems.length>0)for(h=e("subStepContainer","dd_transitStepContainer",o),a=0;a<n.childItineraryItems.length;a++){this.createTransitActionInstruction(n,a,v.distanceUnit,h),this.createTransitInstruction(n,a,h),this.createTransitArrivalDepartureTimeInstruction(n,a,h);if(a!==n.childItineraryItems.length-1)e("","dd_substepContainer",h);else if(n.postIntersectionHints&&v.displayPostItineraryItemHints)for(l=0;l<n.postIntersectionHints.length;l++)f("span","","dd_intersectionHint",h,n.postIntersectionHints[l])}n.transitLine&&t._isTransitTrainLineAgencyId(n.transitLine.agencyId)&&t._addTransitTrainLineLinkElements(h,"MSAF","dd_itineraryBuyTickets")},createRouteSelectionSwitcher:function(){var l=e(this._taskHostIdPrefix+"routeSelectionContainer","dd_routeSelectionContainer",this._directionsPanel),c,t,h,o,s;for(f("span",this._taskHostIdPrefix+"selectorTitleBar","dd_selectorTitleBar noprint",l,i.getString("L_TransitOptionsTitle_Text")),c=this._state.routes.length,t=0;t<c;t++)h=this._state.routes[t].routeLegs[0],o=e(this._taskHostIdPrefix+"routeOption"+t,"dd_routeSelectOption",l),t===this._state.getOptions().routeIndex&&(o.className+=" dd_routeSelectOptionSelected"),o.setAttribute("RouteIndex",t),s={containerElement:o,routeLeg:h,routeIndex:t,handled:!1},n.invoke(this,"beforeRouteSelectorRender",s),u(o).add_event("click",r(this,this._onRouteSelectOptionClick)),u(o).add_event("mouseenter",r(this,this._onRouteSelectMouseEnter)),u(o).add_event("mouseleave",r(this,this._onRouteSelectMouseLeave))},createRouteSelectorItem:function(n,r,o){var nt=o===this._state.getOptions().routeIndex?"dd_optionTextContainerSelected":"dd_optionTextContainer",k=e("",nt,n),it=t._parseCustomDateTime(r.startTime),tt=t._parseCustomDateTime(r.endTime),a,s,h,p,w,g,v;k.innerHTML+=t._getDurationFormattedTime(r.summary.time),k.innerHTML+=",&nbsp;"+i.getString("L_TransitSummaryStartEndTime_Text").replace("{0}",t._getFormattedTime(it)).replace("{1}",t._getFormattedTime(tt)),c.TransitShowRouteCost&&r.summary.monetaryCost>0&&(k.innerHTML+="&nbsp;&nbsp;"+t._getTransitFormattedCost(r.summary.monetaryCost));var d=e("","dd_optionIconContainer",n),y=r.itineraryItems.length,l=0;for(a=0;a<y;a++)s=r.itineraryItems[a],h="",s.transitLine&&(h=s.transitLine.abbreviatedName,h||(h=s.transitLine.verboseName)),p=f("img","","dd_TransitRouteSelectionIcon "+(a===0?"first":""),null,""),p.src=t._getInlineImage(this._state,s.maneuverImageName),d.appendChild(p),s.circularImageName?(w=f("img","","dd_CircleIcon ",null,""),w.src=t._getInlineImage(this._state,s.circularImageName),d.appendChild(w)):h&&(g=f("span","","dd_TransitRouteSelectionIconText",d,h),u(g).set_style({backgroundColor:"rgb("+s.transitLine.lineColor.r+","+s.transitLine.lineColor.g+","+s.transitLine.lineColor.b+")",color:"rgb("+s.transitLine.lineTextColor.r+","+s.transitLine.lineTextColor.g+","+s.transitLine.lineTextColor.b+")"})),s.iconType===rt.walk&&l++;b==="ja-jp"&&(v="",l>0&&(v=i.getString("L_TransitRouteToolTipWalking_Text").replace("{0}",l)+" "),y-1>l&&(v+=i.getString("L_TransitRouteToolTipTransfer_Text").replace("{0}",y-l-1)),n.title=v),e("","dd_routeStepClearBoth",n)},dispose:function(){ct.superClass.dispose.call(this),this._optionsControl&&(this._optionsControl.dispose(),this._optionsControl=null)}},ct._getHtmlFormattedInstruction=function(n){return n&&(n=n.replace(new RegExp("(</TransportType>|</TransitLineName>|</TransitLineTerminus>|</TransitStop>|</StartLocation>|</EndLocation>|</ServiceProvider>|</Phone>|</Action>)","gi"),"</span>"),n=n.replace(new RegExp("(<TransportType>|<TransitLineName>|<TransitLineTerminus>|<TransitStop>|<StartLocation>|<EndLocation>|<ServiceProvider>|<Phone>|<Action>)","gi"),'<span class="instructionKeyword">'),n=n.replace(new RegExp("</(\\S*)>","gi"),""),n=n.replace(new RegExp("<(\\S*)>","gi"),"")),n},ri=new function(){function f(n,t){var u=t.userData,f,i,r;t&&t.success&&n&&n[ur]&&n[ur].length===1?(f=n[ur][0],i=u[0],i&&i(f,u[2])):(r=u[1],r&&r())}function u(n,t){var i=t.userData,f=i[0],e=i[1],r=i[2],u="";t&&t.success&&n?(n[lu]&&(u=n[lu][0]),f&&f(u,e)):r&&r(null,e)}function i(n,t){var i;if(t&&t.success&&n){var r=t.userData,u=r[0],f=r[1],e=r[2];n[bi]&&(i=n[bi][0],i&&i.length==1&&u._updateWaypoint(i[0])),f&&f(u,e)}}var n=this;n.resolveWaypoint=function(u,f,e,o,s,h){var c=[];c[0]=f,c[1]=e,c[2]=s,t.getCredentials(u,r(n,function(u){var s=h.generateResolveWaypointLink(f,null,!1,o,u),l=t.convertPermalinkDictionaryToPermalink(s),e=w.directionsService+l;nt.getObjectAsync(e,r(n,i),c,-1,t.GetUniqueNetworkRequestId(e))}))},n.reverseGeocode=function(i,f,e,o,s,h){if(f){var c=[];c[0]=e,c[1]=s,c[2]=o,t.getCredentials(i,r(n,function(n){var e=h.generateReverseGeocodeLink(f,n),o=t.convertPermalinkDictionaryToPermalink(e),i=w.directionsService+o;nt.getObjectAsync(i,r(null,u),c,-1,t.GetUniqueNetworkRequestId(i))}))}},n.getNearbyArterialsResults=function(i,u,e,o,s,h){var c=[];c[0]=e,c[1]=o,c[2]=s,t.getCredentials(i,r(n,function(i){var o=h.generateNearbyArterialsLink(u,i),s=t.convertPermalinkDictionaryToPermalink(o),e=w.directionsService+s;nt.getObjectAsync(e,r(n,f),c,-1,t.GetUniqueNetworkRequestId(e))}))}},p=function(){},p._encodedCoordinateLength=2,p._encodedFullCoordinateLength=4,p._encodedCoordinateBase=1e6,p.decodeRoute=function(n,t){ti(n.latitudes)||(n.decodedLatitudes=p._decodeCoordinates(n.latitudes,!0),n.latitudes=""),ti(n.longitudes)||(n.decodedLongitudes=p._decodeCoordinates(n.longitudes,!0),n.longitudes="");if(!ti(n.compressedPathIndexes)&&t){var i=n.zoomLevels.split(",").length,r=p.decodePathIndexes(n.compressedPathIndexes,n.decodedLongitudes,i);n.compressedPathIndexes="",n.decodedRegions=p.createLineRegions(i,n.decodedLatitudes,n.decodedLongitudes,r)}},p.decodePathIndexes=function(n,t,i){var c=t.length,s=8,e=0,a=n.charCodeAt(0),f=new Array(0),v=1,h=0,o,r,u,l;if(i>a){for(o=new Array(0),r=0;r<c;r++)o[r]=r;f[0]=o,h=1}for(r=0;r<c;r++){u=h;while(u<i){s===8&&(e=n.charCodeAt(v++),s=0),s++;if(e&128){e=e<<1&255;break}else(f[u]===null||f[u]===undefined)&&(f[u]=new Array(0)),l=f[u].length,f[u][l]=r,e=e<<1,u++}}return f},p.createLineRegions=function(n,t,i,r){for(var f=new Array(n),u=0;u<n;u++)f[u]=p._addRegionsForZoomLevel(t,i,r[u]);return f},p._addRegionsForZoomLevel=function(n,t,i){for(var f=null,v=new Array(0),w=i.length,p=100,o=p,y=0,e=[],r,u=0;u<w;u++){o<p||(u>0&&(v[y++]=new ci(f,e,null),e=[]),f=hi.fromCorners(new a(n[u],t[u]),new a(n[u],t[u])),o=0),r=i[u],e[o]=r;var s=f.getNorth(),h=f.getSouth(),c=f.getEast(),l=f.getWest();n[r]>s?s=n[r]:n[r]<h&&(h=n[r]),t[r]>c?c=t[r]:t[r]<l&&(l=t[r]),f=hi.fromEdges(s,l,h,c),o++}return v[y]=new ci(f,e,null),v},p._decodeCoordinates=function(n,t){for(var l=[],b=0,s=!0,h=1,u=-1,i=0,y=0,o=p._encodedFullCoordinateLength,v,k=n.length,w=p._encodedCoordinateBase,c=p._encodedCoordinateLength,f,a,e,r=0;r<k;r++)v=o-1,f=n.charCodeAt(r)^255,u++,t&&!u&&(h=f&128?-1:1,f&=127),i|=f,u===v?(s||i!==32767?(a=i/w,e=h*a+y,l[b++]=e,y=e,s=!1,o=c):(s=!0,o=c+2),i=0,u=-1,h=1):i<<=8;return l},ui=function(){},ui._isLastPointAdded=function(n,t){if(n.length<1)return!1;var i=n[n.length-1];return i.latitude===t.latitude&&i.longitude===t.longitude},ui.prototype={_id:null,_regions:null,_generalizedZooms:null,_regionHeap:null,_polyline:null,_locations:null,_northLat:0,_southLat:0,_westLong:0,_eastLong:0,_map:null,_mapViewChangedHandler:null,get_polyline:function(){return this._polyline},init:function(t,i,u,f,e){var s,o;this._map=t,this._polyline=i,this._locations=u,this._regions=f,this._generalizedZooms=e,this._id=i.getId();if(this._regions)for(this._regionHeap=[],s=this._regions.length,o=0;o<s;o++)this._regionHeap[this._regionHeap.length]=this._buildRegionHeap(this._regions[o],0,this._regions[o].length-1);this._mapViewChangedHandler=r(this,this.map_ViewChanged),n.addHandler(this._map,"viewchangeend",this._mapViewChangedHandler),this._draw(),this._polyline.setOptions({visible:!0}),this._map.entities.push(this._polyline)},dispose:function(){this._map&&n.removeHandler(this._map,"viewchangeend",this._mapViewChangedHandler)},remove:function(){this._map&&this._polyline&&this._map.entities.remove(this._polyline)},map_ViewChanged:function(){this._draw()},_draw:function(){this._computeBoundaries(),this._buildLine()},_computeBoundaries:function(){var t=this._map.getHeight(),i=this._map.getWidth(),r=t<900?900:t,u=i<900?900:i,n=this._map.getBounds();this._northLat=n.getNorth(),this._southLat=n.getSouth(),this._map.getZoom()>5?(this._westLong=n.getWest(),this._eastLong=n.getEast()):(this._westLong=-180,this._eastLong=180),this._westLong>this._eastLong&&(this._eastLong+=360)},_buildLine:function(){var t=null,n,r,u,i;if(this._generalizedZooms){n=this._generalizedZooms.length-1,r=this._map.getZoom();while(parseInt(this._generalizedZooms[n])<r&&n>=0)n--;this._regionHeap&&this._regionHeap[n]&&(t=this._getVisiblePointsFromRegion(this._regionHeap[n]))}if(!t)for(t=[],u=this._locations.length,i=0;i<u;i++)t[t.length]=this._locations[i];this._setPolyline(t)},_setPolyline:function(n){var t=n.length;if(t<2)return;this._polyline.setLocations(n)},_buildRegionHeap:function(n,t,i){var o=i-t+1,e,r,s;if(o<1)return null;if(o===1)return n[t];e=null,r=null,o===2?(e=n[t],r=n[i]):(s=Math.round((t+i)/2),e=this._buildRegionHeap(n,t,s),r=this._buildRegionHeap(n,s+1,i));if(e&&r){var u=e.boundingRectangle,f=r.boundingRectangle,a=u.getNorth()>f.getNorth()?u.getNorth():f.getNorth(),v=u.getEast()>f.getEast()?u.getEast():f.getEast(),l=u.getSouth()<f.getSouth()?u.getSouth():f.getSouth(),h=u.getWest()<f.getWest()?u.getWest():f.getWest(),c=hi.fromEdges(a,h,l,v);return new ci(c,null,[e,r])}return e?e:r?r:null},_getVisiblePointsFromRegion:function(n){var t=[],c=new a(n.boundingRectangle.getNorth(),n.boundingRectangle.getEast()),l=new a(n.boundingRectangle.getSouth(),n.boundingRectangle.getWest()),s,e,h,i,r,u,o,f;if(this._rectangleDoesNotOverlapViewport(c,l))return t;if(n.childRegions)for(s=n.childRegions.length,e=0;e<s;e++)h=this._getVisiblePointsFromRegion(n.childRegions[e]),t=t.concat(h);else for(i=this._locations[n.indexes[0]],u=!1,this._isVisible(i.latitude,i.longitude)&&(t[t.length]=i,u=!0),o=n.indexes.length,f=1;f<o;f++)r=this._locations[n.indexes[f]],this._isVisible(r.latitude,r.longitude)?(u||ui._isLastPointAdded(t,i)||(t[t.length]=i),u=!0,t[t.length]=r):u?(u=!1,t[t.length]=r):this._rectangleDoesNotOverlapViewport(i,r)||(ui._isLastPointAdded(t,i)||(t[t.length]=i),t[t.length]=r),i=r;return t},_isVisible:function(n,t){return n>=this._southLat&&n<=this._northLat&&t>=this._westLong&&t<=this._eastLong},_rectangleDoesNotOverlapViewport:function(n,t){return n.latitude>this._northLat&&t.latitude>this._northLat||n.latitude<this._southLat&&t.latitude<this._southLat||n.longitude>this._eastLong&&t.longitude>this._eastLong||n.longitude<this._westLong&&t.longitude<this._westLong}},wt=function(){},wt._splitTransitRoutes=function(n,t){var f=[],r,e,u,i,s;if(!n)return f;var o=t.decodedLatitudes.length,c=p.decodePathIndexes(t.compressedPathIndexes,t.decodedLongitudes,t.zoomLevels.split(",").length),h=t.zoomLevels.split(",").length;for(r=0;r<n.length;r++){e=n[r].startPathIndex,u=n[r].endPathIndex;if(n[r].startPathIndex<0||u<0||n[r].startPathIndex>o-1||u>o-1)continue;i={},i.zoomLevels=t.zoomLevels,i.decodedLatitudes=wt._getCoordinates(e,u,t.decodedLatitudes),i.decodedLongitudes=wt._getCoordinates(e,u,t.decodedLongitudes),s=wt._getPathIndexesSubset(e,u,c),i.decodedRegions=p.createLineRegions(h,i.decodedLatitudes,i.decodedLongitudes,s),n[r].coordinate=new a(i.decodedLatitudes[0],i.decodedLongitudes[0]),f[f.length]=i}return f},wt._getCoordinates=function(n,t,i){for(var u=[],f=0,r=n;r<=t;r++)u[f++]=i[r];return u},wt._getPathIndexesSubset=function(n,t,i){for(var o=new Array(i.length),r,f,u,e=0;e<i.length;e++){for(r=new Array(0),f=i[e],r[0]=0,u=0;u<f.length;u++){if(f[u]<=n)continue;if(f[u]>t)break;r[r.length]=f[u]-n}r[r.length-1]<t-n&&(r[r.length]=t-n),o[e]=r}return o},wf={info:0,warning:1,error:2},tu.getDisambiguationCoordinates=function(n){for(var r=n.getDisambiguationResult(),f=r.locationSuggestions.length>0,u=f?r.locationSuggestions:r.businessSuggestions,e=u.length,i=[],t=0;t<e;t++)i[i.length]=new a(u[t].location.latitude,u[t].location.longitude);return i},DirectionPublicNamespace.DirectionsTask=function(){function s(n,i){t&&n==r||(r=n,t&&t.resetDirections(),t=new wr(r),t.setRenderOptions({itineraryContainer:f,displayLandingPage:!0})),u(i[bf],0),u(i[df],Math.max(1,t.getAllWaypoints().length)),t.calculateDirections()}function u(n,i){if(n){var r=null,u=DirectionPublicNamespace.Waypoint;n instanceof u?r=n:typeof n=="string"?r=new u({address:n}):(n.address||n.location)&&(r=new u(n));if(r){t.removeWaypoint(i);while(t.getAllWaypoints().length<i)t.addWaypoint(new u(null));t.addWaypoint(r,i)}}}function e(){t.clearDisplay()}var o=this,t=null,r=null,f=document.createElement("div");n.addHandler(o,"remove",e),this.init=s,this.getTitle=function(){return i.getString("L_DirectionsTaskTitle_Text")},this.getPanel=function(){return f}},ai.prototype.createDisambiguationPushpin=function(t){function rt(i){var h=i.target,o=h._disambiguationMetaData,s,e;u===null&&(e={id:f._state.DisambiguationPinPrefixId+t._uniqueId+"_DisInfobox",visible:!1},u=new ei(new a(o.location.latitude,o.location.longitude),e),f._handlers.push(n.addHandler(u,"mouseenter",r(u,function(){window.clearTimeout(this._timeOutHandler),this._timeOutHandler=null}))),f._handlers.push(n.addHandler(u,"mouseleave",r(u,function(){this.setOptions({visible:!1})}))),f._map.entities.push(u)),window.clearTimeout(u._timeOutHandler),u._timeOutHandler=null,u._waypointUniqueId=h._waypointUniqueId,u._disambiguationIndex=h._disambiguationIndex,s=o.entityId?!0:!1,e=w(this,o,s),e.visible=!0,vi?s||(e.height=90):e.typeName=f._isLightColorPopupRequired()?"lightInfobox":"darkInfobox",u.setLocation(new a(o.location.latitude,o.location.longitude)),u.setOptions(e)}function w(n,t,u){var f;return u?(f={title:t.name,description:t.address,actions:[{label:i.getString("L_SelectDisambiguation_Text"),eventHandler:r(n,b)}]},t.website&&f.actions.push({label:i.getString("L_WebsiteLink_Text"),eventHandler:r(t,tt)})):f={title:t.suggestion,actions:[{label:i.getString("L_SelectDisambiguation_Text"),eventHandler:r(n,b)}]},f}function ut(n){n.target instanceof lt,u=n.target._infobox}function nt(){if(u){var t=window.setTimeout(r(u,function(){this._timeOutHandler&&this.setOptions({visible:!1})}),500);u._timeOutHandler=t}}function b(t){t.preventDefault(),n.invoke(this,"selected",{waypointId:u._waypointUniqueId,suggestionsIndex:u._disambiguationIndex})}function tt(n){n.preventDefault(),this.website&&window.open(this.website)}for(var f=this,v=t.getDisambiguationResult(),p=v.locationSuggestions.length>0,s=p?v.locationSuggestions:v.businessSuggestions,y=s.length,it=p||y===0?0:s[0].index,d=[],u=null,g=f._map.getTheme(),c,h,e,k,l,o=y-1;o>=0;o--)c=new a(s[o].location.latitude,s[o].location.longitude),d.push(c),h=g===null?f._state.getOptions().disambiguationPushpinOptions:{},h.text=(o+1+it).toString(),h.id=f._state.DisambiguationPinPrefixId+t._uniqueId+"_DisInfobox",e=new lt(c,h),g===null?(h.hoverIcon&&(e._hoverIcon=h.hoverIcon,f._attachHoverBehavior(e)),f._handlers.push(n.addHandler(e,"mouseover",r(f,rt))),f._handlers.push(n.addHandler(e,"mouseout",r(f,nt)))):(k=s[o].entityId?!0:!1,l=w(this,s[o],k),l.id=f._state.DisambiguationPinPrefixId+t._uniqueId+"_"+o,l.pushpin=e,u=new ei(c,l),f._handlers.push(n.addHandler(e,"click",r(e,ut))),u._waypointUniqueId=t._uniqueId,u._disambiguationIndex=o,f._map.entities.push(u)),f._map.entities.push(e),e._disambiguationMetaData=s[o],e._waypointUniqueId=t._uniqueId,e._disambiguationIndex=o;y>0&&n.invoke(f,"disambiguationPushpinsAdded",{cordinates:d})},ai.prototype.removeDisambiguationPushpins=function(n){var t=n?n._uniqueId:"";this._removePushpins(this._state.DisambiguationPinPrefixId+t)},ai.prototype.createTransitStepPushpins=function(i){function et(n){if(u){window.clearTimeout(u._timeOutHandler),u._timeOutHandler=null;var t=n.target,r=t._stepMetadata,i={visible:!0,offset:new it(14,16)};u.setOptions(i),u.setLocation(t.getLocation()),u.setHtmlContent(d(r).innerHTML)}}function ft(){if(u){var t=window.setTimeout(r(u,function(){this._timeOutHandler&&this.setOptions({visible:!1})}),500);u._timeOutHandler=t}}function d(n){var h=e("","",null),r,i,a,l,u,s,c;r=n.childItineraryItems.length>0?e("","dd_transitStepPopup "+(o._isLightColorPopupRequired()?"dd_lightTransitPopup":""),h):e("","dd_walkingStepPopup "+(o._isLightColorPopupRequired()?"dd_lightTransitPopup":""),h),i=n.formattedText,n.iconType!==rt.tube||ti(i)||(i=i.replace(new RegExp("<TransportType>(.+?)</TransportType>","gi"),"<TransportType>Tube</TransportType>")),a=e("",g(n.iconType)+" dd_directionIcon",r),l=n.childItineraryItems.length>0?f("div","","dd_popupText dd_popupTextHeader",r,ct._getHtmlFormattedInstruction(i)):f("div","","dd_popupText",r,ct._getHtmlFormattedInstruction(i));if(n.childItineraryItems){for(u=0;u<n.childItineraryItems.length;u++)s=e("","dd_popupText",r),c=t._parseCustomDateTime(n.childItineraryItems[u].time),f("span","","dd_eroStepTime",s,t._getFormattedTime(c)),f("span","","",s,ct._getHtmlFormattedInstruction(n.childItineraryItems[u].formattedText));n.transitLine&&t._isTransitTrainLineAgencyId(n.transitLine.agencyId)&&t._addTransitTrainLineLinkElements(s,"MSAF","dd_transitHoverBuyTickets")}return h}function k(n,t){for(var i in n)if(n.hasOwnProperty(i))if(n[i]==t)return i;return undefined}function g(n){var r=o._isLightColorPopupRequired(),t=k(rt,n);return r?"dd_"+t+"DarkIcon":"dd_"+t+"LightIcon"}function nt(n,t){var i=null;return i={height:48,width:null,anchor:new it(6,41),icon:n.transitStepIcon},i.id=o._state.TransitStepPinPrefixId+t,i}var o=this,v,b,c,p,y,h,w,u;for(o._removePushpins(o._state.TransitStepPinPrefixId),v=0,b=i.length,c=0;c<b;c++){for(p=i[c],y=p.itineraryItems.length,h=0;h<y;h++){var l=p.itineraryItems[h],c=v+h,ut=new a(l.coordinate.latitude,l.coordinate.longitude),s,tt=nt(l,c);s=new lt(ut,tt),o._map.entities.push(s),s._stepMetadata=l,o._handlers.push(n.addHandler(s,s instanceof lt?"mouseover":"mouseenter",r(o,et))),o._handlers.push(n.addHandler(s,s instanceof lt?"mouseout":"mouseleave",r(o,ft)))}v+=y}w={id:o._state.TransitStepPinPrefixId+"_Infobox",visible:!1},u=new ei(new a(0,0),w),o._handlers.push(n.addHandler(u,"mouseenter",r(u,function(){window.clearTimeout(this._timeOutHandler),this._timeOutHandler=null}))),o._handlers.push(n.addHandler(u,"mouseleave",r(u,function(){this.setOptions({visible:!1})}))),o._map.entities.push(u)},oi.prototype.generateDragAndDropStopPointLink=function(n,t,i,r,u,f,e){var o={},h="",tt=!n,b=tt||n.isViapoint(),v,d,k,p,s,nt;u||(h+=r.latitude.toFixed(l)+","+r.longitude.toFixed(l),o.dw=h,h="",f&&(h+=f.latitude.toFixed(l)+","+f.longitude.toFixed(l),o.lsdw=h,h="")),o.z=this._map.getZoom(),u||b||this._state.stoppoints[0]._uniqueId!==n._uniqueId||(o.start="1");var c=[],w=null,a=null,g=this._state.getOptions();b?(w=t.isViapoint()?this._state.getPreviousWaypoint(t._uniqueId):t,a=i.isViapoint()?this._state.getNextWaypoint(i._uniqueId):i):(w=this._state.getPreviousWaypoint(n._uniqueId),a=this._state.getNextWaypoint(n._uniqueId)),b?(v=this._state.getRouteLegByLegKey(g.routeIndex+"~"+w._uniqueId+"~"+a._uniqueId),c[c.length]=v.legId):(w&&(v=this._state.getRouteLegByLegKey(g.routeIndex+"~"+w._uniqueId+"~"+n._uniqueId),c[c.length]=v.legId),a&&(v=this._state.getRouteLegByLegKey(g.routeIndex+"~"+n._uniqueId+"~"+a._uniqueId),c[c.length]=v.legId)),tt&!u&&(o["new"]="1");if(b){for(d=0,k=!1,s=0;s<this._state.stoppoints.length;s++){k||this._state.stoppoints[s]._uniqueId!==w._uniqueId||(k=!0);if(k)if(this._state.stoppoints[s]._uniqueId===t._uniqueId)break;else d++}o.sli=d.toString()}o.m=u?"1":c.length===2?"5":b?"6":"4";var rt=t?t._uniqueId:n._uniqueId,it=a?a._uniqueId:n._uniqueId,y=0;for(s=0;s<this._state.stoppoints.length;s++){if(!u&&y>=2)break;y>0&&(h+="~"),p=this._state.stoppoints[s],(y>0||p._uniqueId===rt)&&(n||y!==1||(h+="v."+r.latitude.toFixed(l)+","+r.longitude.toFixed(l)+"~",y++),n&&p._uniqueId===n._uniqueId?(p.isViapoint()&&(h+="v."),h+=r.latitude.toFixed(l)+","+r.longitude.toFixed(l)):h+=this._getStopPointParam(p),y++);if(p._uniqueId===it)break}o.w=h,h="";if(!u)for(s=0;s<c.length;s++)o["lid"+s]=c[s];return this._addRouteOptionsLink(o,!0),u&&(o.bb=this._generateMapBoundingBoxLink()),typeof VEShell!="undefined"&&(nt=this._getQueryParam(n,r),nt&&!b&&(o.q=nt)),this._addPermalinkAdditionalParams(o,e),o},ot.prototype.addNewViapoint=function(t){for(var u=this.stoppoints,f={isViapoint:!0},r=new ft(f),i=0;i<u.length;i++)u[i]._uniqueId===t&&u.splice(i+1,0,r);return n.invoke(this,"waypointAdded",{waypoint:r}),r},ot.prototype.removeAllViaPoint=function(){for(var r=this.stoppoints,i,t=0;t<r.length;t++)i=r[t],i.isViapoint()&&(r.splice(t,1),n.invoke(this,"waypointRemoved",{waypoint:i}),t--)},ot.prototype.removeAllViaInLeg=function(t){for(var f=this.stoppoints,u=!1,r,i=0;i<f.length;i++){r=f[i];if(u)if(r.isViapoint())f.splice(i,1),n.invoke(this,"waypointRemoved",{waypoint:r}),i--;else break;u||r._uniqueId!==t||(u=!0)}},ot.prototype.getViapointCountInLeg=function(n){return k(n)?0:(n.isViapoint()&&(n=this.getPreviousWaypoint(n._uniqueId)),this.getAllViaInLeg(n._uniqueId).length)},ot.prototype.getAllViaInLeg=function(n){for(var u=[],r=!1,f=this.stoppoints,i,t=0;t<f.length;t++){i=f[t];if(r)if(i.isViapoint())u[u.length]=i;else break;r||i._uniqueId!==n||(r=!0)}return u},bt=function(t,u,f,e){function wt(){var t=tt.cloneOptions(tt.getOptions().viapointPushpinOptions);o=new lt(s.getCenter(),t),s.entities.push(o),ot=n.addHandler(o,"dragstart",r(h,vt)),ht=n.addThrottledHandler(o,"drag",r(h,pt),250),st=n.addHandler(o,"dragend",r(h,kt))}function vt(){v=!0,ut=n.addHandler(s,"mousemove",r(h,at)),k=s.getWidth(),d=s.getHeight()}function pt(t){if(v){var i=t.entity;b.setLocation(i.getLocation()),n.invoke(h,"dragMove",{location:o.getLocation(),polyline:p})}}function kt(){v=!1,n.removeHandler(ut),rt(!1),n.invoke(h,"dragEnd",{location:o.getLocation(),polyline:p})}function ni(t){var f,u,i,c,e;if(g)return;if(tt.stoppoints.length>=gt)return;for(f=t,o||wt(),g=!0,w=-1,u=s.tryLocationToPixel(p.getLocations()),l=[],y=[],i=0;i<u.length;i++)l[i]=u[i].x,y[i]=u[i].y;nt=n.addHandler(s,"mousemove",r(h,dt)),c=f.pageY-s.getPageY(),e=f.pageX-s.getPageX(),et(e,c)}function dt(t){if(!g||!l||!y)return;var r=t.getX(),i=t.getY();et(r,i)||(l=null,y=null,v||rt(!1),n.removeHandler(nt),g=!1,b.setVisibility(!1))}function at(n){if(v){var u=n.getX()+k/2,f=n.getY()+d/2,t=0,i=0;u<50?t=Math.min(50-u,25):u>k-50&&(t=Math.max(k-50-u,-25)),f<50?i=Math.min(50-f,25):f>d-50&&(i=Math.max(d-50-f,-25)),t||i?(c=new it(t,i),a===-1&&(a=window.setInterval(r(h,yt),250))):(c=new it(0,0),window.clearInterval(a),a=-1)}}function et(n,t){var u=l.length,r,f,i;if(w>-1)for(r=Math.max(0,w-1),f=Math.min(r+1,u-1),i=r;i<=f;i++)if(ft(n,t,i))return w=i,!0;for(i=0;i<u-1;i++)if(ft(n,t,i))return w=i,!0;return!1}function yt(){var n,i,t;v&&o&&(c.x||c.y)?(n=s.tryLocationToPixel(o.getLocation()),n&&(i=s.tryPixelToLocation(new it(n.x-c.x,n.y-c.y)),o.setLocation(i),t={center:s.getCenter(),centerOffset:c,animate:!1},s.setView(t))):a!==-1&&(window.clearInterval(a),a=-1)}function rt(n){o.setOptions({visible:n})}function ft(n,t,r){var e=l[r],h=y[r],v=l[r+1],a=y[r+1],u=bt._calculateIntersectionLineConstant(n,t,e,h,v,a);if(u<0||u>1)return!1;var p=Math.round(e+u*(v-e)),c=Math.round(h+u*(a-h)),d=bt._calculateDistanceBetweenPoints(n,t,p,c);if(d<10){var w=c,k=p,f=s.tryPixelToLocation(new it(k,w));return f&&(o.setLocation(f),rt(!0)),b.setToolTip(i.getString("L_DragToolTip_Text")),b.setLocation(f),!0}return!1}var h=this,tt=e,s=t,w=-1,a=-1,p=u,o=null,ot=null,ht=null,st=null,nt=null,ut=null,ct=null,l=null,y=null,g=!1,v=!1,c=null,k=0,d=0,b=f;h.getPolyline=function(){p},ct=n.addHandler(p,"mouseover",r(h,ni)),h.dispose=function(){n.removeHandler(ot),n.removeHandler(ht),n.removeHandler(st),n.removeHandler(ct),n.removeHandler(nt),n.removeHandler(ut),p=null,o&&(s.entities.remove(o),o=null)}},bt._calculateDistanceBetweenPoints=function(n,t,i,r){var f=i-n,u=r-t;return Math.sqrt(f*f+u*u)},bt._calculateIntersectionLineConstant=function(n,t,i,r,u,f){var e=bt._calculateDistanceBetweenPoints(u,f,i,r);return((n-i)*(u-i)+(t-r)*(f-r))/(e*e)},cc_sb_ie=!!window.ActiveXObject,cc_sb_i6=ni.isIE6,nr.InitCalendar=function(n,t,r,u){var s=new Date,e,f,o;s.setTime(t.valueOf()),e=new Date,f=new Date,f.setUTCDate(f.getUTCDate()+730),e.setUTCDate(e.getUTCDate()-730),o=[{id:n,lowDate:function(){return e},highDate:function(){return f},highlightDate:function(){return s},onChange:u}],nr.fc_cal({els:o,daysAbvr:i.getString("L_CalendarDays_Text").split(","),monthsAbvr:i.getString("L_CalendarMonths_Text").split(","),yearUnit:"",monthUnit:"",displayYearFirst:r?1:0})},nr.fc_cal=function(n){function b(n){for(var t=0;t<i.els.length;t++)if(i.els[t].id===n)return i.els[t];return{}}function y(n){if(n&&n.setHours)return n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0),n}function l(n,t){var u,r;try{u=document.getElementById(n);if(u){r=i.parseDate(u.innerHTML.replace(/\<.*\>/ig,""));if(!isNaN(r.valueOf()))return r;throw"not a date";}}catch(f){if(t)return new Date}return undefined}function ot(){e.style.display="block",document.getElementById(e.id)||document.getElementById(i.els[0].id).appendChild(e),cc_sb_i6&&k()}function a(){try{e[o].display="none",u.curMonth=null}catch(n){}}function nt(n,t){var s,u,c,h;if(n.changeOther)try{for(s=0;s<n.changeOther.length;s++){var o=n.changeOther[s],a=o.id,e=o.amt,r=l(a),f=new Date(t.getTime());o.offset&&f.setDate(f.getDate()+o.offset);if(e>0&&r<f||e<0&&r>f||e==0){u=b(a),r=new Date(t.getTime()),r.setDate(r.getDate()+e);try{c=tt(u),h=it(u),r<c&&(r=c),r>h&&(r=h)}catch(v){}document.getElementById(a).value=i.formatDate(r),u.setCurMonth(r)}}}catch(v){}}function tt(n){var i,t;n.lowDate&&(i=n.lowDate());if(n.lowId){t=l(n.lowId);if(n.lowIdOffset)try{t.setUTCDate(t.getUTCDate()+n.lowIdOffset)}catch(r){}(!i||t>i)&&(i=t)}return i}function it(n){var i,t;n.highDate&&(i=n.highDate());if(n.highId){t=l(n.highId);if(n.highIdOffset)try{t.setUTCDate(t.getUTCDate()+n.highIdOffset)}catch(r){}(!i||t<i)&&(i=t)}return i}function p(){var p=tt(u),v=it(u),y,o,w,b,n,f,t,s,c,r,a;for(v&&(y=new Date(v.getTime()),y.setMonth(y.getMonth()-1)),o=l(u.id,!0),o<p&&(o=p),o>v&&(o=v),u.highlightDate&&(w=u.highlightDate()),u.highlightId&&(b=l(u.highlightId)),n=[],cc_sb_i6&&n.push('<iframe id="fc_cal_shield" src="" style="position:absolute;z-index:1;top:-',h,";left:-",h,';margin:0;padding:0" frameborder="0"></iframe>','<div id="fc_cal_ie6Border" class="fc_cal_holder" style="position:absolute;z-index:2;top:-',h,";left:-",h,';"></div>'),u.curMonth||u.setCurMonth(o),f=new Date(u.curMonth.getTime()),t=new Date(f.getTime()),t.setDate(1),s=1;s<=i.calCnt;s++){for(n.push('<div style="z-index:1001" class="fc_cal_monthHolder',s==1?" fc_cal_month_first":"",s==i.calCnt?" fc_cal_month_last":"",f>p||!p?"":" fc_cal_month_lowLimit",f<y||!y?"":" fc_cal_month_highLimit",'"><table><tr><th colspan="7">'),s==1&&n.push('<a href="#" id="fc_cal_monthDec" class="fc_cal_monthDec fc_cal_monthChange" onclick="return false">',i.decStr,"</a>"),s==i.calCnt&&n.push('<a href="#" id="fc_cal_monthInc" class="fc_cal_monthInc fc_cal_monthChange" onclick="return false">',i.incStr,"</a>"),n.push("<div>",i.formatMonth(f),"</div>"),n.push('</th></tr><tr class="fc_cal_days">'),c=0;c<i.daysAbvr.length;c++)n.push("<td>",i.daysAbvr[c],"</td>");for(r=0,n.push("</tr><tr>"),a=t.getDay(),a<i.firstDay&&(a=a+7),c=i.firstDay;c<a;c++)n.push('<td class="fc_cal_blank fc_cal_disabled">&nbsp;</td>'),r++;while(t.getMonth()==f.getMonth())r===0&&n.push("<tr>"),t<p||t>v?n.push('<td class="',t==o?"fc_cal_selected ":"",'fc_cal_disabled">',i.formatDay(t),"</td>"):n.push('<td class="',t.getTime()==o.getTime()?" fc_cal_current":"",w&&t.getTime()==w.getTime()?" fc_cal_highlight":"",b&&t.getTime()==b.getTime()?" fc_cal_highlight":"",'"><a href="#" id="fc_cal_day_',t.getTime(),'" onclick="return false">',i.formatDay(t),"</a></td>"),t.setDate(t.getDate()+1),r<6?r++:(n.push("</tr>"),r=0);while(r<7&&r>0)n.push('<td class="blank">&nbsp;</td>'),r<6||n.push("</tr>"),r++;n.push("</tbody></table></div>"),f.setMonth(f.getMonth()+1)}e.innerHTML=n.join(""),cc_sb_i6&&k()}function k(){var t,n;try{t=document.getElementById("fc_cal_shield"),t[o].height=e.offsetHeight+"px",t[o].width=e.offsetWidth+"px",n=document.getElementById("fc_cal_ie6Border"),n[o].height=e.offsetHeight-w*2+"px",n[o].width=e.offsetWidth-w*2+"px"}catch(i){}}function et(n){var f=cu(n),t=f.id,r;t.indexOf("fc_cal_day_")===0?(r=new Date(parseInt(t.substring(11),10)),document.getElementById(u.id).innerHTML=i.formatDate(r),u.setCurMonth(r),nt(u,r),u.onChange&&u.onChange(),a(),er(n)):(t=="fc_cal_monthDec"&&(u.curMonth.setMonth(u.curMonth.getMonth()-1),p()),t=="fc_cal_monthInc"&&(u.curMonth.setMonth(u.curMonth.getMonth()+1),p()),er(n),au(n))}function d(n){var t=cu(n);u=b(t.id),er(n),au(n),p(),ot(t)}function rt(n){n.keyCode==9&&a()}var i=n,u,ft,e,h,w,ut,o="style",g={holderId:"fc_cal_holder",holderClass:"fc_cal_holder",firstDay:0,curMonth:undefined,incStr:"&#187;",decStr:"&#171;",calCnt:1,parseDate:function(n){try{var i=t.getDateFromStringInSupportedFormat(n,c.TransitDateFormat);if(isNaN(i.valueOf()))throw"NaN";return i}catch(r){return undefined}},formatDate:function(n){return t.getDateInSupportedFormat(n)},formatDay:function(n){return n.getDate()},formatMonth:function(n){var t=[];return i.displayYearFirst===1?t.push(n.getFullYear(),i.yearUnit," ",i.monthsAbvr[n.getMonth()],i.monthUnit):t.push(i.monthsAbvr[n.getMonth()],i.monthUnit," ",n.getFullYear(),i.yearUnit),t.join("")}},v,f,r,s;try{ft=y(new Date);for(v in g)i[v]===undefined&&(i[v]=g[v]);for(r=0;r<i.firstDay;r++)i.daysAbvr.push(i.daysAbvr.shift());for(e=document.createElement("div"),e.id=i.holderId,e.className=i.holderClass,e[o].display="none",e[o].position="absolute",e[o].zIndex="1000",document.getElementById(i.els[0].id).appendChild(e),cc_sb_i6&&(h=e.currentStyle.borderWidth,w=parseInt(h.substring(0,h.length-2),10),ut=e.currentStyle.borderColor),at(e,"click",et,!1),f=i.els,r=0;r<f.length;r++)f[r].setCurMonth=function(n){try{this.curMonth=new Date(n.getTime()),this.curMonth.setDate(1)}catch(t){}},s=document.getElementById(f[r].id),f[r].lowDate&&(f[r].lowDateSaver=f[r].lowDate,f[r].lowDate=function(){return y(this.lowDateSaver())}),f[r].highDate&&(f[r].highDateSaver=f[r].highDate,f[r].highDate=function(){return y(this.highDateSaver())}),f[r].highlightDate&&(f[r].highlightDateSaver=f[r].highlightDate,f[r].highlightDate=function(){return y(this.highlightDateSaver())}),at(s,"click",d),at(s,"focus",d),at(s,"keydown",rt),at(s,"change",a),f[r].onChange&&at(s,"change",f[r].onChange),f[r].changeOther&&at(s,"change",function(){var t=b(this.id),n=l(this.id);nt(t,n)});at(document,"click",a),at(window,"resize",a)}catch(st){}},ot.prototype.moveWaypoint=function(n,t){for(var f=null,r=this.stoppoints,u,i=0;i<r.length;i++){u=r[i];if(u._uniqueId===n){f=u,this.removeStoppoint(n,!0);break}}if(!f)return;if(t)for(this.removeAllViaInLeg&&this.removeAllViaInLeg(t),i=0;i<r.length;i++){u=r[i];if(u._uniqueId===t){r.splice(i+1,0,f);break}}else r.splice(0,0,f)},ot.prototype.addRoundTripWapoint=function(){var u=this.stoppoints,t=u[0],f;if(t.getAddress()){f=null,t.getLocation()&&(f=t.getLocation());var i=t.getBusinessDetails(),e={address:t.getAddress(),location:f,isViapoint:!1,exactLocation:t.isExactLocation(),businessDetails:{businessName:i.businessName,phoneNumber:i.phoneNumber,entityId:i.entityId,website:i.website}},r=new ft(e);return u[u.length]=r,n.invoke(this,"waypointAdded",{waypoint:r}),r}return null},ot.prototype.isRoutableLatLongAvailableForAllStopPoints=function(){var t=this.stoppoints,n,i;if(t.length<2)return!1;for(n=0;n<t.length;n++){i=t[n];if(!i.getLocation())return!1}return!0},gi=function(s,c,l,v){function wi(){var t=p.getOptions(),r=p._getPrefixId(),i=t.itineraryContainer,n;return si.createDirectionPanel(i,r,t.routeMode),n=u("#"+r+di,i).element(),n.innerHTML="",n}function tr(n,t){var o,c,l,a,v,s,h;if(n)return o=e(k+"WaypointContainer"+n._uniqueId,"waypointContainer firstWaypoint",null),o.setAttribute("WaypointUniqueId",n._uniqueId),t&&(w._ddInputZIndex=400),o.style.zIndex=w._ddInputZIndex,w._ddInputZIndex--,c=y(k+"AddStopDiv"),g.insertBefore(o,c),l=f("span",k+"LandingLetter"+n._uniqueId,"dd_directionStepLetter",o,""),o.appendChild(document.createTextNode("")),a=oi(o,n,t,"sw_b ddInput","sw_qbox ddInputBox"),v=u(l),v.add_event("mousedown",r(w,ni)),s=d(k+"WaypointClose"+n._uniqueId,"closeWaypoint closeWaypointLanding",a,"","#"),u(s).set_attr("WaypointUniqueId",n._uniqueId),u(s).add_event("click",r(w,ti)),t&&(h=d(k+"WaypointReverse","dd_reverseDirections",o,"","#"),h.title=i.getString("L_DirectionsMenuReverse_Text"),u(h).add_event("click",r(w,ai))),dt(n,o),o}function vi(n){var t=e(k+"AddStopDiv","addStopContainer",n),f=d(k+"AddStop","addStop",t,i.getString("L_AddStop_Text"),"#");return u(f).add_event("click",r(w,li)),wt(t),t}function ai(t){t.preventDefault(),p.reverseWaypoints(),n.invoke(w,"optionsChanged",{refreshLandingPage:!0})}function li(t){t.preventDefault();var i=new ft({});p.addStoppoint(i),n.invoke(w,"optionsChanged",{refreshLandingPage:!0})}function ht(){var t=p.stoppoints[0],i=p.stoppoints[p.stoppoints.length-1],r=u("#"+k+"RoundTrip"),n=r.element();n&&(n.checked=t.getAddress()&&t.getAddress()===i.getAddress())}function ut(){t.RemoveDomElement(k+"OneClickDirectionsContainer")}function oi(n,i,f,o,s){var c=e(k+"basicWrapper"+i._uniqueId,o,n),h;return u(c).set_style({position:"static"}),h=t._addInputElement(k+"WaypointInput"+i._uniqueId,s,c,t.getInputDisplayText(i),"text",""),h.setAttribute("WaypointUniqueId",i._uniqueId),h.onChange=r(w,ct),u(h).add_event("change",r(w,pi)),u(h).add_event("keydown",r(w,gi)),c}function hi(){var i=0,t;for(count=p.stoppoints.length,t=0;t<count;t++)!p.stoppoints[t].isViapoint()&&(p.stoppoints[t].getAddress()||p.stoppoints[t].getLocation())&&i++;typeof VEShell!="undefined"&&VEShell.Logging.get_instance().logSubmit(k+"ShowDirections"),i<2||(p.removeEmptyWaypoints(),n.invoke(w,"updateDirections",null))}function ci(n){n.preventDefault()}function gi(n){var i=parseInt(n.target.getAttribute("WaypointUniqueId")),r=p.getStoppointIndex(i);r&&r!==1||ut(),st(i),t.RemoveDomElement(k+"MessageContainer"),ii(i)}function nr(n){var e=t._addInputElement(k+"WaypointClear","button higButton secondary",n,i.getString("L_Clear_Text"),"button",""),f;u(e).add_event("click",r(w,yt)),f=t._addInputElement(k+"ShowDirections","button goButton",n,i.getString("L_DirectionsGetDirections_Text"),"Submit",""),f.onclick=r(w,hi),u(f).add_event("click",r(w,ci))}function pi(n){ct(n.target)}function ct(t){var s=u(t).get_val().trim(),v=t.getAttribute("WaypointUniqueId").toString(),o,h,l,r,b,c;s===i.getString("L_DirectionsAddressCityLocation_Text")&&(s=""),o=p.getStoppointById(parseInt(v));if(o){var f=null,y=t.getAttribute("serializedWaypointAddress"),e="";y&&(e=y.toString(),t.removeAttribute("serializedWaypointAddress"),e&&(h=e.indexOf(";"),h>0&&(l=e.substring(0,h),r=l.split(","),r.length===4&&(r[0]&&r[1]?f=new a(parseFloat(r[0]),parseFloat(r[1])):r[2]&&r[3]&&(f=new a(parseFloat(r[2]),parseFloat(r[3]))))))),o.clear(),b=bi(parseInt(v)),c=f?new a(f.latitude,f.longitude):null,o.setOptions({address:s,location:f,geoLocation:c}),n.invoke(w,"optionsChanged",{refreshLandingPage:!1,clearResultsPage:!0}),window.setTimeout(w._setFocus,1)}}function bi(n){var o=!1;if(p&&p.stoppoints){var e=p.getPreviousWaypoint(n),h=p.getNextWaypoint(n),s=p.getStoppointById(n),r=e?e:s,i=h?h:s;if(p.stoppoints.length>0&&r&&i&&r!==i){var u=0,t=p.stoppoints[u],f=!0;while(t&&t!==i){if(f)t===r&&(f=!1);else if(t.isViapoint()){p.removeStoppoint(t._uniqueId,!1),o=!0,t=p.stoppoints[u];continue}t=p.stoppoints[u++]}}}return o}function bt(){var n=e(k+"ButtonPanel","buttonPanel",g);return nr(n),n}function vt(){var i=p.getOptions().itineraryContainer,t=u("div[id*="+k+"WaypointContainer]",i),r=t.length,l=r>2?"inline":"none",w=u("a[id*="+k+"WaypointClose]",i),a,v,s,c,n,e,f,h;for(w.set_style({display:l}),a=u("#"+k+"ReverseRoute",i),a.set_style({display:l}),v=u("#"+k+"WaypointReverse",i),v.set_style({display:r===2?"inline":"none"}),s=u("div[id*="+k+"basicWrapper]",i),s.remove_class("waypointCloseMargin"),r>2&&s.add_class("waypointCloseMargin"),c=u("span[id*="+k+"LandingLetter]",i),t.remove_class("firstWaypoint"),t.remove_class("dd_midWaypoint"),t.remove_class("dd_lastWaypoint"),n=0;n<r;n++)e=c.element(n),e&&(e.innerHTML=ki[n]),n?n===r-1?u(t.element(n)).add_class("dd_lastWaypoint"):u(t.element(n)).add_class("dd_midWaypoint"):u(t.element(n)).add_class("firstWaypoint");f=y(k+"AddStop"),f&&(t=p.getAllWaypoints(),h=p.getOptions().routeMode===o.transit?lr:gt,f.style.display=t.length<h?"inline":"none"),ht()}function dt(){}function wt(s){var y=null,h;p.getOptions().routeMode===o.transit&&(y=e(k+"TransitOptionsDiv","collapsibleRouteOptions routeOptionsContainer",g));var et=e(k+"RouteSettingsDiv","optionsContainer",s),v=f("fieldset",k+"RouteSettings","routeOptions",s,""),a=f("span",k+"DistanceUnit","distanceUnit",v,"");b==="ja-jp"&&(a.style.display="none");var d=f("span","","radio",a,""),c=t._addInputElement(k+"mi","",d,"mi","radio","routeDistanceUnit"),ft=f("label",k+"miLabel","",d,i.getString("L_MilesSettings_Text"));ft.setAttribute("for",c.id),u(c).add_event("click",r(w,at));var it=f("span","","radio",a,""),l=t._addInputElement(k+"km","",it,"km","radio","routeDistanceUnit"),ut=f("label",k+"kmLabel","",it,i.getString("L_KmSettings_Text"));ut.setAttribute("for",l.id),u(l).add_event("click",r(w,at)),p.getOptions().distanceUnit===tt.miles?u(c).set_attr("checked","checked"):u(l).set_attr("checked","checked"),nt||(nt=new sf(p,!0)),nt.addCollapsibleHeader(null,i.getString("L_ShowOptions_Text"),v,!0),h=nt.showRouteOptionsForCurrentMode(v,y),rt.push(n.addHandler(nt,"optionsChanged",function(t){t.updateDirections?n.invoke(w,"optionsChanged",{refreshLandingPage:!1}):n.invoke(w,"optionsChanged",{clearResultsPage:!0,refreshLandingPage:!1})})),u("label",h).add_class("optionsLabel"),u("#SaveDestinationHistory",h).add_class("dd_checkboxInput")}function at(t){p.setOptions({distanceUnit:yi===u(t.target).get_val()?tt.miles:tt.kilometers}),n.invoke(w,"optionsChanged",{refreshLandingPage:!1}),VEShell.Cookie.create(ff,p.getOptions().distanceUnit===tt.miles?yi:uf,1)}function ni(n){var t,i,f;n.stopPropagation(),w._isDragging=!0,t=n.target.parentNode,w._moveTarget=t,i=u(t),u("#"+k+"WaypointReverse").set_style({display:"none"}),u("a[id*="+k+"WaypointClose]").set_style({display:"none"}),u("#"+p._getPrefixId()).add_class("disableSelection"),ut(),i.add_class("waypointDragging"),w._waypointMeasuredHeight=i.has_class("dd_lastWaypoint")?t.offsetTop-t.previousSibling.offsetTop:t.nextSibling.offsetTop-t.offsetTop,f=u.Screen.get_mouse_pos(n).y,ot=f,w._waypointDragMouseUpHandler=r(w,ei),u(document.documentElement).add_event("mouseup",w._waypointDragMouseUpHandler,!1),w._waypointDragMouseMoveHandler=r(w,fi),u(document.documentElement).add_event("mousemove",w._waypointDragMouseMoveHandler,!1),u.Events.capture_mouse(document.documentElement)}function fi(n){if(w._isDragging){var t=w._moveTarget,o=u.Screen.get_mouse_pos(n).y,e=u(t),i=o-ot,r=w._waypointMeasuredHeight,f=!1;!e.has_class("firstWaypoint")&&i<-.5*r?(t.parentNode.insertBefore(t,t.previousSibling),f=!0,i=r/2):!e.has_class("dd_lastWaypoint")&&i>.5*r&&(t.parentNode.insertBefore(t,t.nextSibling.nextSibling),f=!0,i=-r/2),f&&(vt(),u("#"+k+"WaypointReverse").set_style({display:"none"}),u("a[id*="+k+"WaypointClose]").set_style({display:"none"}),ot=o-i),e.set_style({top:i+"px"})}}function ei(){var r;u.Events.release_mouse(),u(document.documentElement).remove_event("mouseup",w._waypointDragMouseUpHandler,!1),u(document.documentElement).remove_event("mousemove",w._waypointDragMouseMoveHandler,!1),w._isDragging=!1;var f=u(w._moveTarget),e=parseInt(f.get_attr("WaypointUniqueId")),i="";f.has_class("firstWaypoint")||(r=u(w._moveTarget.previousSibling),i=parseInt(r.get_attr("WaypointUniqueId"))),p.moveWaypoint(e,i),n.invoke(w,"optionsChanged",{refreshLandingPage:!0}),u("#"+p._getPrefixId()).remove_class("disableSelection"),u(".waypointDragging").set_style({top:"0px"}).remove_class("waypointDragging")}function lt(){if(p.stoppoints.length<=1)return;var t=p.stoppoints[0],n=p.stoppoints[1].getLocation();t.getAddress()||t.getLocation()||!n||ri.getNearbyArterialsResults(kt,n,r(w,ui),null,null,pt)}function ui(t){var l,s,v,c;ut(),l=p.getOptions();if(!t.length||l&&l.routeMode!==o.driving)return;var h=p.stoppoints[0],g=y(k+"WaypointContainer"+h._uniqueId),b=e(k+"OneClickDirectionsContainer","ddOneClickDirectionsContainer",g);for(f("span",k+"OneClickDirectionsMessage","ddOneClickDirectionsHeader",b,i.getString("L_OneClickDirectionsHeader_Text")),s=0;s<t.length;s++)v=e("","ddOneClickDirectionsArterials",b),c=d(k+"OneClickDirectionsOption"+s,"",v,t[s].address.formattedAddress,"#"),u(c).set_attr("OptionNumber",s.toString()),u(c).add_event("click",r(w,function(i){i.preventDefault();var r=parseInt(u(i.target).get_attr("OptionNumber")),f={address:t[r].address.formattedAddress,location:new a(t[r].latitude,t[r].longitude)};h.clear(),h._locationIdentifier=t[r].locationIdentifier,h.setOptions(f),n.invoke(w,"updateDirections",null)}));w._setFocus(!0)}function ti(i){i.preventDefault();var r=i.target.getAttribute("WaypointUniqueId").toString(),u=y(k+"WaypointInput"+r);t.removeBehavior(u),p.removeStoppoint(parseInt(r),!0),typeof VEShell!="undefined"&&VEShell.Logging.get_instance().logSubmit(i.currentTarget.id),n.invoke(w,"optionsChanged",{refreshLandingPage:!0})}function ii(n){t.RemoveDomElement(k+"DisambiguationOuterContainer"+n)}function st(n){var i=y(k+"WaypointContainer"+n),t=y(k+"WaypointBizDataContainer_"+n);t&&i.removeChild(t)}var w=this,ot=-1,et=c,pt=l,it=null,nt=null,g=null,p=v,ir=null,rt=[],k=p._getPrefixId(),kt=s,yt;w._createWaypointDisambiguation=function(n){var t=n.waypoint,r=y(k+"WaypointContainer"+t._uniqueId),i=e(k+"DisambiguationOuterContainer"+t._uniqueId,"",r);n.containerElement=i,e(k+"DisambiguationContainerBeak"+t._uniqueId,"disambgContainerBeak",i)},w._waypointChanged=function(n){n&&!n.getDisambiguationResult()&&(p.getStoppointIndex(n._uniqueId)===1&&lt(),ht(),st(n._uniqueId),t.RemoveDomElement(k+"MessageContainer"))},w._createLandingPage=function(t,r){var e,l,s,a,u,c;g=wi(),it||(it=new lf(p)),it.createModeSwitchingIcons(g),rt.push(n.addHandler(it,"modeChanged",function(){n.invoke(w,"optionsChanged",{refreshLandingPage:!0})}));while(p.stoppoints.length<2)e=new ft({}),p.addStoppoint(e);for(p.stoppoints[p.stoppoints.length-1].isViapoint()&&(e=new ft({}),p.addStoppoint(e)),p.stoppoints[0].isViapoint()&&(e=new ft({}),p.addStoppoint(e,0)),l=p.getOptions().routeMode===o.transit?lr:gt,p.stoppoints.length>l&&(t=i.getString("L_ExceedMaxWaypointLimitError_Text").replace("{0}",gt),r=h.exceedMaxWaypointLimit),t&&r!==h.waypointDisambiguation&&r!==h.emptyWaypoint&&r!==h.atleastTwoWaypointsRequired&&f("span",k+"MessageContainer","dd_messageContainer",g,t),s=p.stoppoints,a=null,u=0;u<s.length;u++)c=s[u],c.isViapoint()||(a=tr(c,!u),u||lt());vi(g),bt(),vt()},w.updateReverseGeocodedText=function(n){var i=n.getAddress(),t=y(k+"WaypointInput"+n._uniqueId);t&&(t.value=i,u(t).remove_class("Watermark"))},w.createLandingPushpins=function(){et&&(et.removeAllPushpins(),et.createPushpins(p.getAllWaypoints()))},w._setFocus=function(n){var e=!1,t=u("a[id^="+k+"DisambiguationAddressLink]"),r,i,f;if(t.length>0)t=t[0];else{for(t=null,r=p.getAllWaypoints(),i=0;i<r.length;i++)if(!r[i].getAddress()&&!r[i].getLocation()){t=y(k+"WaypointInput"+r[i]._uniqueId),e=!0;break}t||(t=y(k+"ShowDirections"))}if(t){try{t.focus()}catch(o){}n&&e&&window.Sys&&window.Sys.UI&&window.Sys.UI.Behavior&&(f=Sys.UI.Behavior.getBehaviorByName(t,"PersonalizationBehavior"),f&&f.hideList())}},yt=function(){var i=p.getOptions(),r=i.distanceUnit;p.resetDirectionState({removeAllWaypoints:!0,resetRequestOptions:!0}),p.setOptions({distanceUnit:r,routeMode:i.routeMode}),n.invoke(w,"optionsChanged",{refreshLandingPage:!0})},w.dispose=function(){var f,i;it&&it.dispose(),nt&&nt.dispose(),g&&(f=u("input[id*="+k+"WaypointInput]").for_each(r(w,function(n){t.removeBehavior(n)})),g.parentNode.removeChild(g),g=null),i=rt.length;while(i--)n.removeHandler(rt[i]);rt=[]}},oi.prototype.addDirectionsPermalinkParameters=function(n,t){var i,e,u,r,o,f;if(this._state.stoppoints&&this._state.stoppoints.length>=2){for(i=new Sys.StringBuilder,e=this._state.stoppoints.length,u=0;u<e;u++)r=this._state.stoppoints[u],k(r.getLocation())?(i.append("adr."),i.append(IOSec.DecodeHtml(r.getAddress()))):(r.isViapoint()?i.append("v."):i.append("pos."),o=r._geoLocation?r._geoLocation:r.getLocation(),i.append(o.latitude.toFixed(l)),i.append("_"),i.append(o.longitude.toFixed(l)),i.append("_"),i.append(IOSec.DecodeHtml(r.getAddress())),r.isViapoint()||(f=r.getBusinessDetails(),i.append("_"),i.append(IOSec.DecodeHtml(f.businessName)),i.append("_"),i.append(IOSec.DecodeHtml(f.phoneNumber)),i.append("_"),i.append(IOSec.DecodeHtml(r.isExactLocation()?"e":"a")),i.append("_"),i.append(IOSec.DecodeHtml(f.entityId))),t&&(i.append("_"),i.append(r._locationIdentifier))),u!==e-1&&i.append("~");n.rtp=i,i="",this._addRouteOptionsLink(n,!1)}},oi.prototype.getDummyRequestPermalink=function(n,t){var i={},r;return i.m="2",n&&t?(k(t.query)||(i.q=t.query),k(t.queryType)||(i.t=t.queryType),i.rt="s"):(r=this._getQueryParam(null,null),k(r)||(i.q=r),i.rt="d"),this._addPermalinkAdditionalParams(i,null),i},oi.prototype.getPrintPageUrl=function(){var u="&pt=pb",n,r;if(VEShell.TaskHost.isTaskActive(y(TaskIds.DD))&&this._state.stoppoints&&this._state.stoppoints.length>=2&&this._state.summary){var e=this._state.stoppoints[0],f=this._state.stoppoints[this._state.stoppoints.length-1],i={};return this.addDirectionsPermalinkParameters(i,!0),n=new Sys.StringBuilder,this._state.getOptions().routeMode===o.transit?(i.sri=this._state.routes[this._state.getOptions().routeIndex].routeLegs[0].originalRouteIndex,n.append("&pt=pr")):n.append("&pt=pf"),r=t.convertPermalinkDictionaryToPermalink(i),n.append("&"),n.append(r),n.append("&cmw="),n.append(this._map.getWidth().toString()),n.append("&cmh="),n.append(this._map.getHeight().toString()),n.append("&u="),n.append(this._state.getOptions().distanceUnit===tt.miles?"0":"1"),n.toString()}return u},ii.prototype.addDirectionsPermalinkParameters=function(n,t){this._permalinkHelper.addDirectionsPermalinkParameters(n,t)},ii.prototype.getPrintPageUrl=function(){return this._permalinkHelper.getPrintPageUrl()},ii.makeDummyRequest=function(n,i,u){var e=n.getDummyRequestPermalink(i,u),o=t.convertPermalinkDictionaryToPermalink(e),f=w.directionsService+o;nt.getObjectAsync(f,r(this,null),null,-1,t.GetUniqueNetworkRequestId(f))},rr=DirectionPublicNamespace.DirectionsManager.prototype,rr.addDirectionsPermalinkParameters=function(n,t){this._getTask().addDirectionsPermalinkParameters(n,t)},rr.getPrintPageUrl=function(){return this._getTask()._permalinkHelper.getPrintPageUrl()},delete window.Microsoft.Maps.initDirectionsCode,vt.Dynamic&&vt.Dynamic.done("Microsoft.Maps.Directions"),dt.end("Module initialized","Microsoft.Maps.Directions",{module:"Directions"})},Microsoft.Maps.Map&&Microsoft.Maps.initDirectionsCode&&window.Microsoft.Maps.initDirectionsCode(),window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},window.Microsoft.Maps.initSearch=function(){function b(n){var t=this;t._task=null,t._map=n}var n=window.Microsoft.Maps,f=n.Search=n.Search||{},lt=n.Gimme,o=n.Globals,at=n.Events,t=n.InternalNamespaceForDelay,ot=t.Network,v=t.Quirks,p=t.PRF,a=n.Location,ht=n.LocationRect,yt=6,tt=10,u=20,et=function(n){return typeof n=="undefined"||typeof n=="unknown"},rt=function(n){return et(n)||n===null},vt=function(n){return typeof n=="undefined"||typeof n=="unknown"||n===null||n===""},s=function(n,t,i,r,u){p.start(u),ot.getObjectAsync(i,st,[n,r,u],n.timeout||-1)},st=function(n,t){var u=t.userData,i=u[0],o=i.errorCallback,f=u[1],e=u[2],r;e&&p.end(e),t&&t.success&&n?(r=v.useXHR?n:n.response,r&&f&&f(r,i,i.callback,i.userData)):o&&o({request:i})},l=function(n,t,i,r){return v.useXHR?n.format="json":(n.jsonso="{jsono}",n.jsonp="microsoftMapsNetworkCallback"),n.culture='"'+o.locale+'"',n.token=t?t:"",i+(r?"/"+r:"")+"?"+ut(n)},ut=function(n){var i="",r=!0,t;for(t in n)r||(i+="&"),i+=t+"=",t==="jsonso"?i+=n[t]:rt(n[t])||(i+=encodeURIComponent(n[t].toString())),r=!1;return i},it=function(n){var s="",f,e,r;if(n){f=n&&n.getNorthwest(),e=n&&n.getSoutheast();if(f&&e){var o=f.latitude,i=e.longitude,t=e.latitude,u=f.longitude;o<t&&(r=o,o=t,t=r),i<u&&(r=i,i=u,u=r),s=o+", "+i+", "+t+", "+u}}return s},w=function(n){if(n&&n.NorthEastCorner&&n.SouthWestCorner){var r=n.SouthWestCorner.Latitude,u=n.NorthEastCorner.Latitude,t=n.NorthEastCorner.Longitude,i=n.SouthWestCorner.Longitude;return new ht(new a((r+u)/2,(i+t)/2,null,null),t-i,u-r)}return null},i=function(n){return n?'"'+n+'"':""},h={none:0,good:1,ambiguous:2,upHierarchy:4,modified:8},r={high:0,medium:1,low:2,unknown:-1},y={interpolated:0,rooftop:1},c,k;f.MatchCode=h,f.MatchConfidence=r,f.LocationPrecision=y;var ct=function(n){var i=null,t;return n&&(t=ft(n.Results),t&&(i={parsedAddress:nt(n.ParsedAddress),parsedKeyword:n.parsedKeyword||"",parsedSeparator:n.parsedSeparator||"",results:t||[]})),i},e=function(n){var r=null,t,i;return n&&(t=n.Coordinates,t&&(i=n.Precision||y.Interpolated,r={location:new a(t.Latitude,t.Longitude),precision:i,name:n.Name})),r},g=function(n){var r=[],t,i;if(n)for(t=0;t<n.length;t++)i=e(n[t]),i&&r.push(i);return r},nt=function(n){var t=null;return n&&(t={addressLine:n.AddressLine||"",adminDistrict:n.AdminDistrict||"",countryRegion:n.CountryRegion||"",district:n.District||"",formattedAddress:n.FormattedAddress||"",locality:n.Locality||"",postalCode:n.PostalCode||"",postalTown:n.PostalTown||""}),t},d=function(n){var u=null;if(n&&n.Name&&n.BestLocation&&n.Locations&&n.BestView){var f=w(n.BestView),t=e(n.BestLocation),i=g(n.Locations);f&&t&&i&&(u={name:n.Name,location:t&&t.location,locations:i,bestView:f,matchConfidence:n.MatchConfidence||r.unknown,matchCode:n.MatchCode||h.none})}return u},ft=function(n){var r=[],t,i;if(n)for(t=0;t<n.length;t++)i=d(n[t]),i&&r.push(i);return r};f.SearchManager=b,searchManagerPrototype=b.prototype,searchManagerPrototype.search=function(n){var t=this._map;t&&(n.bounds||(n.bounds=t.getBounds()),k.search(n,t))},searchManagerPrototype.geocode=function(n){var t=this._map;t&&(n.bounds||(n.bounds=t.getBounds()),c.geocode(n,t))},searchManagerPrototype.reverseGeocode=function(n){var t=this._map;t&&c.reverseGeocode(n,t)},c=new function(){function c(n,t,i,r){i&&n&&i(ct(n),r)}function a(n,t,i,r){if(i&&n){var f=null,u=n.Results;u&&u.length>0&&(f=d(u[0])),i(f,r)}}function e(n,t){var e=n.count||tt,f,s;return e>u&&(e=u),f="",s={query:i(n.where),mapBounds:i(it(n.bounds)),count:e,landmark:f,addressLine:f,locality:f,postalTown:f,adminDistrict:f,district:f,postalCode:f,countryRegion:f,currentLocation:f,curLocAccuracy:f,entityTypes:f,rankBy:f},l(s,t,o.geocodingService,r)}function h(n,i){var r={};return r.latitude=n.latitude,r.longitude=n.longitude,l(r,i,o.geocodingService,t)}var f=this,r="Geocode",t="ReverseGeocode";f.geocode=function(n,t){t&&n&&t.getCredentials(function(i){var u=e(n,i);s(n,t,u,c,r)})},f.reverseGeocode=function(i,r){if(r&&i){var u=i.location;u instanceof n.Location&&r.getCredentials(function(n){var f=h(u,n);s(i,r,f,a,t)})}}},k=new function(){function ut(n,t,i,r){i&&n&&i(b(n,t),r)}function rt(t,r){var s=c,f=t.count||tt,e;return f>u&&(t.count=f=u),t.center instanceof n.Location&&(s=t.center.latitude+","+t.center.longitude),f+=1,e={count:f,startingIndex:t.startIndex||0,mapBounds:i(it(t.bounds)),locationcoordinates:i(s),entityType:i("Business"),sortorder:c,query:i(t.query),location:i(t.where),keyword:i(t.what)},l(e,r,o.searchService)}function b(n,i){var u=null,o,e,r;return n&&(o=t(n.SearchResults,y),e=i.count,u={searchRegion:f(n.SearchRegion),alternateSearchRegions:t(n.AlternateSearchRegions,f),parseResults:t(n.ParseResults,p),searchResults:o.splice(0,e),hasMore:o.length>e},r=n.ResponseSummary,r&&(u.responseSummary={copyright:r.Copyright||"",statusCode:r.StatusCode||0,authResultCode:r.AuthResultCode||0,errorMessage:r.ErrorMessage||null,traceId:r.TraceId||""})),u}function t(n,t){var u=[],i,r;if(n)for(i=0;i<n.length;i++)r=t(n[i]),r&&u.push(r);return u}function y(n){var i=null,t;return n&&(t=n.Location,i={entityType:n.EntityType||0,id:n.Id||"",name:n.Name||"",address:n.Address||"",city:n.City||"",state:n.State||"",postalCode:n.PostalCode||"",country:n.Country||"",phone:n.Phone||"",location:t&&new a(t.Latitude,t.Longitude),website:n.Website||"",hoursOfOperation:n.HoursOfOperation||null,userRating:n.UserRating||0,reviewCount:n.ReviewCount||0,birdsEyeSceneIndicator:n.BirdsEyeSceneIndicator||0,structuredDescription:n.StructuredDescription||null}),i}function p(n){var t=null;return n&&(t={keyword:n.Keyword||"",location:e(n.Location),matchConfidence:n.MatchConfidence||r.unknown}),t}function f(n){var i=null,t;return n&&(t=n.MapBounds,i={mapBounds:t?{locationRect:w(t),type:t.Type||0}:null,explicitLocation:e(n.ExplicitLocation),source:n.Source||"",matchConfidence:n.MatchConfidence||r.unknown,matchCode:n.MatchCode||h.none,address:nt(n.Address),geocodeLocations:g(n.GeocodeLocations)}),i}function v(n){return(n.where||n.what||n.query)&&n.count>0}var d=this,c="",ft=null,k="Search2";d.search=function(n,t){n&&(t&&v(n)?t.getCredentials(function(i){var r=rt(n,i);s(n,t,r,ut,k)}):n.errorCallback&&n.errorCallback({request:n}))}},delete window.Microsoft.Maps.initSearch,t&&t.Dynamic&&t.Dynamic.done("Microsoft.Maps.Search"),t&&t.PRF.end("Module initialized","Microsoft.Maps.Search",{module:"Search"})},Microsoft.Maps.Map&&Microsoft.Maps.initSearch&&window.Microsoft.Maps.initSearch()